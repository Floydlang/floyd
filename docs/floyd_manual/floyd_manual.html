<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><style>body {
  max-width: 980px;
  border: 1px solid #ddd;
  outline: 1300px solid #fff;
  margin: 16px auto;
}

body .markdown-body
{
  padding: 45px;
}

@font-face {
  font-family: fontawesome-mini;
  src: url(data:font/woff;charset=utf-8;base64,d09GRgABAAAAABE0AA8AAAAAHWwAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAABHU1VCAAABWAAAADsAAABUIIslek9TLzIAAAGUAAAAQwAAAFY3d1HZY21hcAAAAdgAAACqAAACOvWLi0FjdnQgAAAChAAAABMAAAAgBtX/BGZwZ20AAAKYAAAFkAAAC3CKkZBZZ2FzcAAACCgAAAAIAAAACAAAABBnbHlmAAAIMAAABdQAAAjkYT9TNWhlYWQAAA4EAAAAMwAAADYQ6WvNaGhlYQAADjgAAAAfAAAAJAc6A1pobXR4AAAOWAAAACAAAAA0Kmz/7mxvY2EAAA54AAAAHAAAABwQPBJubWF4cAAADpQAAAAgAAAAIAEHC/NuYW1lAAAOtAAAAYQAAALxhQT4h3Bvc3QAABA4AAAAfgAAAMS3SYh9cHJlcAAAELgAAAB6AAAAhuVBK7x4nGNgZGBg4GIwYLBjYHJx8wlh4MtJLMljkGJgYYAAkDwymzEnMz2RgQPGA8qxgGkOIGaDiAIAJjsFSAB4nGNgZHZmnMDAysDAVMW0h4GBoQdCMz5gMGRkAooysDIzYAUBaa4pDA4Pwz+yMwf9z2KIYg5imAYUZgTJAQDcoQvQAHic7ZHNDYJAFIRnBXf94cDRIiyCKkCpwFCPJ092RcKNDoYKcN4+EmMPvpdvk539zQyAPYBCXEUJhBcCrJ5SQ9YLnLJe4qF5rdb+uWPDngNHTkta101pNyWa8lMhn6xx2dqUnW4q9YOIhAOOeueMSgsR/6ry+P7O5s6xVNg4chBsHUuFnWNJ8uZYwrw7chrsHXkODo7cB0dHOYCTY8kv0VE2WJKD6gOlWjsxAAB4nGNgQAMSEMgc9D8LhAESbAPdAHicrVZpd9NGFB15SZyELCULLWphxMRpsEYmbMGACUGyYyBdnK2VoIsUO+m+8Ynf4F/zZNpz6Dd+Wu8bLySQtOdwmpOjd+fN1czbZRJaktgL65GUmy/F1NYmjew8CemGTctRfCg7eyFlisnfBVEQrZbatx2HREQiULWusEQQ+x5ZmmR86FFGy7akV03KLT3pLlvjQb1V334aOsqxO6GkZjN0aD2yJVUYVaJIpj1S0qZlqPorSSu8v8LMV81QwohOImm8GcbQSN4bZ7TKaDW24yiKbLLcKFIkmuFBFHmU1RLn5IoJDMoHzZDyyqcR5cP8iKzYo5xWsEu20/y+L3mndzk/sV9vUbbkQB/Ijuzg7HQlX4RbW2HctJPtKFQRdtd3QmzZ7FT/Zo/ymkYDtysyvdCMYKl8hRArP6HM/iFZLZxP+ZJHo1qykRNB62VO7Es+gdbjiClxzRhZ0N3RCRHU/ZIzDPaYPh788d4plgsTAngcy3pHJZwIEylhczRJ2jByYCVliyqp9a6YOOV1WsRbwn7t2tGXzmjjUHdiPFsPHVs5UcnxaFKnmUyd2knNoykNopR0JnjMrwMoP6JJXm1jNYmVR9M4ZsaERCICLdxLU0EsO7GkKQTNoxm9uRumuXYtWqTJA/Xco/f05la4udNT2g70s0Z/VqdiOtgL0+lp5C/xadrlIkXp+ukZfkziQdYCMpEtNsOUgwdv/Q7Sy9eWHIXXBtju7fMrqH3WRPCkAfsb0B5P1SkJTIWYVYhWQGKta1mWydWsFqnI1HdDmla+rNMEinIcF8e+jHH9XzMzlpgSvt+J07MjLj1z7UsI0xx8m3U9mtepxXIBcWZ5TqdZlu/rNMfyA53mWZ7X6QhLW6ejLD/UaYHlRzodY3lBC5p038GQizDkAg6QMISlA0NYXoIhLBUMYbkIQ1gWYQjLJRjC8mMYwnIZhrC8rGXV1FNJ49qZWAZsQmBijh65zEXlaiq5VEK7aFRqQ54SbpVUFM+qf2WgXjzyhjmwFkiXyJpfMc6Vj0bl+NYVLW8aO1fAsepvH472OfFS1ouFPwX/1dZUJb1izcOTq/Abhp5sJ6o2qXh0TZfPVT26/l9UVFgL9BtIhVgoyrJscGcihI86nYZqoJVDzGzMPLTrdcuan8P9NzFCFlD9+DcUGgvcg05ZSVnt4KzV19uy3DuDcjgTLEkxN/P6VvgiI7PSfpFZyp6PfB5wBYxKZdhqA60VvNknMQ+Z3iTPBHFbUTZI2tjOBIkNHPOAefOdBCZh6qoN5E7hhg34BWFuwXknXKJ6oyyH7kXs8yik/Fun4kT2qGiMwLPZG2Gv70LKb3EMJDT5pX4MVBWhqRg1FdA0Um6oBl/G2bptQsYO9CMqdsOyrOLDxxb3lZJtGYR8pIjVo6Of1l6iTqrcfmYUl++dvgXBIDUxf3vfdHGQyrtayTJHbQNTtxqVU9eaQ+NVh+rmUfW94+wTOWuabronHnpf06rbwcVcLLD2bQ7SUiYX1PVhhQ2iy8WlUOplNEnvuAcYFhjQ71CKjf+r+th8nitVhdFxJN9O1LfR52AM/A/Yf0f1A9D3Y+hyDS7P95oTn2704WyZrqIX66foNzBrrblZugbc0HQD4iFHrY64yg18pwZxeqS5HOkh4GPdFeIBwCaAxeAT3bWM5lMAo/mMOT7A58xh0GQOgy3mMNhmzhrADnMY7DKHwR5zGHzBnHWAL5nDIGQOg4g5DJ4wJwB4yhwGXzGHwdfMYfANc+4DfMscBjFzGCTMYbCv6dYwzC1e0F2gtkFVoANTT1jcw+JQU2XI/o4Xhv29Qcz+wSCm/qjp9pD6Ey8M9WeDmPqLQUz9VdOdIfU3Xhjq7wYx9Q+DmPpMvxjLZQa/jHyXCgeUXWw+5++J9w/bxUC5AAEAAf//AA94nIVVX2hbZRQ/5/t7893s5ja9f7ouzdZ0TTqz3bRJmogbWya6bG6Cq0VbSV2ddIJjFtfIQHEig80Hda8yUN/0YQz8AyriiyD+xQd92R4HCnaCb3samnpumrpsCsLlfPf7zvedc37nL3CAtc/5W/wQZGA3tOBSY/g+TMjHmwzEoM1Q8+ZjRZY4oJhmBw5/YB6Za0yC5AkhlwA1A1yCBIBOwCII0Cj0U8BAMdUCzq05sKwkP7SlUY6fcJk4Fb/RyE79/6P5hjM/F4aZiXBoeMgzcqQ4Xi1hPqfDLG5FT+lchCVU3lYMyvuwhl1mqndQL0RsuloLywHtthLXI06OblTrhfWVnpSJ5+mwu/JdbtuN3IAnkW0LLMcRwaC7ktrlzridM6kVdyf9uO1UNBByI7JhwtG2sEwab07ORBeilWhqavJCqV0qzZTOl/7ZXQ5TbTcdcFelyGhhRDAQpdqp1FEX3w3cFTc1k9pJQkmm4ySCbSikxRP2QOfN+0tHS5MrpQuTU1Mk5nw0E5Xa0WvrOwDyGax9yB9ma6DAg82wHc43SAGTI4GjBWebOePAERFE8/AHaQpZASSTy8A4WwZiLQMQ82mFKATO0ILicRAoDm9p5P99E5b/fXG+kQYY3TYUuqmERWYoT0u/GNYL2q/4WB3LaVS+VynXsVYIcWw6DkCh3nX1D+VzlYN4LClF5yexSQos8exqZ3KVP+wtrC54u4Nznq6cq+xpMpUUnZ8FUYzE86ud0g28NOIv3Gj5/rmA3ABs7S/ywzFuQ4qyd6QxfNtiQIaEgp3w/entQg4Vcbqa16M5FfpeUB8t1+qeg7mI7cUyOe79wOk86gSxkVec4KPTX69++5x68Yubn5/F+w52z7u08sJX7fZXv8ekT/d2mILJxq6sn+SC6qEJknzLJCxyZEKwWVqYmAPBxBE/9DLeZiWHu7lcr/VytrCRuHojncNuTt9h46tmacmYisnSamdN2bZptcsmSysdVsy1PrOvOzF3xN64Rb937t/og9KHxYdcjIUqFAmIAHGHNzlns+RTPgeUYAQm9DwpNxfxbhhBHPaw3/gfTcXO2L+eJVIx5nsyGkvm9X4/f+bGkH45G0PaSjcMXTjcZyTvi3UdHoCDjQd3IDUVsgwYmUoJK/gp4JJxeRI0MKHZIkgynyIBqBTOUs6rOVCojvjZ4mCQz49ZMlMcp8QoYk6NoBfsxnJtsBohpa8iGJS+ZH7gU7NxME6cmF+t7cO9vB8d3jTWSct0ycW9ranXmolNDwmVkNnxe+8JtoztwS5rKJ0xWS95tQ/1zMYzg69MzUZnNtl1ofNbsml/OJm6f9wjRjpnu2o4MzHzn77IQkRd+1DjwMQ2pqSjGMMhyjrgTbBAKksuUm0iU7hI0aN2wOKOq7WYBSH0HGihj/jkiPxAfmwsEbfYrjMG+j3ij932Db/LV7I/xruNrhnroxjR9HRMb2nTvO0ZXOoHPk8H2ZhDPx93qcE/53sH5np/dkIP7zzhTVKdR/BAY/9ElkkR+A6lJGsqpJ4oQcTxpvBT3Kn58VkaJjgHyPEIws57xkaHh9KuVpDEpJZeMbZ5w/zBHi5NMQ4r5VphsFqID7TyB9eR4pX216c3AHxpdAwoqU9qg0ZJ6yVLKmMSz1iG2z27ifx18NkY0LPx1W/wCc2l5LrznrIsiKsqbmB78A9wIGx4tI8rjihVHJyY9pgMirenVq0yWg7Iw7eogG7ZgYM3qR9959A/fZkg6MnD/exlkmc+jWV4SB15XUR+eqC6l6ZmgPtN9z5JMfik05OV8ljylunJ4J+wA/FUaQSSKotsYsCWqaPBidBLcxkWx7XKFRIb45TGaEhjlF9uUVPqXOtcIwsXbBvfoZXIyRYFdkfnqjExH98xpnPczqzjX/uNdO1Y17Wpi5+6Ts8BXtjVFasp9KZ1mOiNbH65c5w6HgmyF2jFCZywM8mWjRc7T5Pmt0lRy7Y71+jYbpGyvwG4sH0XeJxjYGRgYADiwBB/53h+m68M3MwvgCIM1z5N/g6j///9v5H5BbMnkMvBwAQSBQCIcA9gAHicY2BkYGAO+p8FJF/8//v/F/MLBqAICuAFALYQB5kAeJxjfsHAwLwAiCNB+P9fbJjJmoGBMRUo/wKCAfO2EnQAAAAAANoBXgGcAgICVALaA1IDvAPkBAYEPARyAAEAAAANAF0ABAAAAAAAAgAUACQAcwAAAG4LcAAAAAB4nHWRzWrCQBSFT+pPqUIXLXTTzayKUohGKIibCoLuhbrrYtTRxCYZmYyKyz5Fd32HvlDfoO/QkziIFJtw9bvnnpl7ZwLgBt/wcHieGAf2UGd24Atcou+4RH3kuEweO66QXx1XyaHjGh6ROa7jFp/cwStfMVvhy7GHO+/e8QWuvcBxifqz4zL5xXGF/Oa4Sn53XMPE+3Bcx4P3M9DrvYmWoRWNQVN02kFXTPdCU4pSGQu5saE2meiLhU6timPtz3SSs9ypTCdqrJabWJoT5QQnymSRTkXgt0/UkUqVkVbN807ZdtmxdiEWRidi6HqItdErNbN+aO2612qd9sYAGmvsYRBhyUu0EGhQbfK/gzYCdElTOgSdB1eEFBIxFYkNV4RFJWPeZyyYpVQVHTHZx4y/yVGX2LGWFZri51TccUOn5B7nPefVCSPvGhVVwUl9znveO2KkhV8Wk82PZ8qwZf8OVcu1+fSmWCMw/HMOwXvKaysqM+p+cVuWag8tvv+c+xdd+4+teJxtjUEOwiAURJla24KliQfhUA2g/Sl+CKXx+loNrpzVezOLEY34Ron/0WhwQoszOvQYIKFwwQiNSbSBeO2SZ0tBP4j3zVjKNng32ZmtD1VVXCuOiw/pJ8S3WOU6l+K5UOTaDC4+2TjKMtN9KQf1ezLx/Sg/00FCvABHhjDjAAB4nGPw3sFwIihiIyNjX+QGxp0cDBwMyQUbGVidNjEwMmiBGJu5mBg5ICw+BjCLzWkX0wGgNCeQze60i8EBwmZmcNmowtgRGLHBoSNiI3OKy0Y1EG8XRwMDI4tDR3JIBEhJJBBs5mFi5NHawfi/dQNL70YmBhcADHYj9AAA) format('woff');
}

.markdown-body {
  font-family: sans-serif;
  -ms-text-size-adjust: 100%;
  -webkit-text-size-adjust: 100%;
  color: #333333;
  overflow: hidden;
  font-family: "Helvetica Neue", Helvetica, "Segoe UI", Arial, freesans, sans-serif;
  font-size: 16px;
  line-height: 1.6;
  word-wrap: break-word;
}

.markdown-body a {
  background: transparent;
}

.markdown-body a:active,
.markdown-body a:hover {
  outline: 0;
}

.markdown-body b,
.markdown-body strong {
  font-weight: bold;
}

.markdown-body mark {
  background: #ff0;
  color: #000;
  font-style: italic;
  font-weight: bold;
}

.markdown-body sub,
.markdown-body sup {
  font-size: 75%;
  line-height: 0;
  position: relative;
  vertical-align: baseline;
}
.markdown-body sup {
  top: -0.5em;
}
.markdown-body sub {
  bottom: -0.25em;
}

.markdown-body h1 {
  font-size: 2em;
  margin: 0.67em 0;
}

.markdown-body img {
  border: 0;
}

.markdown-body hr {
  -moz-box-sizing: content-box;
  box-sizing: content-box;
  height: 0;
}

.markdown-body pre {
  overflow: auto;
}

.markdown-body code,
.markdown-body kbd,
.markdown-body pre,
.markdown-body samp {
  font-family: monospace, monospace;
  font-size: 1em;
}

.markdown-body input {
  color: inherit;
  font: inherit;
  margin: 0;
}

.markdown-body html input[disabled] {
  cursor: default;
}

.markdown-body input {
  line-height: normal;
}

.markdown-body input[type="checkbox"] {
  box-sizing: border-box;
  padding: 0;
}

.markdown-body table {
  border-collapse: collapse;
  border-spacing: 0;
}

.markdown-body td,
.markdown-body th {
  padding: 0;
}

.markdown-body .codehilitetable {
  border: 0;
  border-spacing: 0;
}

.markdown-body .codehilitetable tr {
  border: 0;
}

.markdown-body .codehilitetable pre,
.markdown-body .codehilitetable div.codehilite {
  margin: 0;
}

.markdown-body .linenos,
.markdown-body .code,
.markdown-body .codehilitetable td {
  border: 0;
  padding: 0;
}

.markdown-body td:not(.linenos) .linenodiv {
  padding: 0 !important;
}

.markdown-body .code {
  width: 100%;
}

.markdown-body .linenos div pre,
.markdown-body .linenodiv pre,
.markdown-body .linenodiv {
  border: 0;
  -webkit-border-radius: 0;
  -moz-border-radius: 0;
  border-radius: 0;
  -webkit-border-top-left-radius: 3px;
  -webkit-border-bottom-left-radius: 3px;
  -moz-border-radius-topleft: 3px;
  -moz-border-radius-bottomleft: 3px;
  border-top-left-radius: 3px;
  border-bottom-left-radius: 3px;
}

.markdown-body .code div pre,
.markdown-body .code div {
  border: 0;
  -webkit-border-radius: 0;
  -moz-border-radius: 0;
  border-radius: 0;
  -webkit-border-top-right-radius: 3px;
  -webkit-border-bottom-right-radius: 3px;
  -moz-border-radius-topright: 3px;
  -moz-border-radius-bottomright: 3px;
  border-top-right-radius: 3px;
  border-bottom-right-radius: 3px;
}

.markdown-body * {
  -moz-box-sizing: border-box;
  box-sizing: border-box;
}

.markdown-body input {
  font: 13px Helvetica, arial, freesans, clean, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol";
  line-height: 1.4;
}

.markdown-body a {
  color: #4183c4;
  text-decoration: none;
}

.markdown-body a:hover,
.markdown-body a:focus,
.markdown-body a:active {
  text-decoration: underline;
}

.markdown-body hr {
  height: 0;
  margin: 15px 0;
  overflow: hidden;
  background: transparent;
  border: 0;
  border-bottom: 1px solid #ddd;
}

.markdown-body hr:before,
.markdown-body hr:after {
  display: table;
  content: " ";
}

.markdown-body hr:after {
  clear: both;
}

.markdown-body h1,
.markdown-body h2,
.markdown-body h3,
.markdown-body h4,
.markdown-body h5,
.markdown-body h6 {
  margin-top: 15px;
  margin-bottom: 15px;
  line-height: 1.1;
}

.markdown-body h1 {
  font-size: 30px;
}

.markdown-body h2 {
  font-size: 21px;
}

.markdown-body h3 {
  font-size: 16px;
}

.markdown-body h4 {
  font-size: 14px;
}

.markdown-body h5 {
  font-size: 12px;
}

.markdown-body h6 {
  font-size: 11px;
}

.markdown-body blockquote {
  margin: 0;
}

.markdown-body ul,
.markdown-body ol {
  padding: 0;
  margin-top: 0;
  margin-bottom: 0;
}

.markdown-body ol ol,
.markdown-body ul ol {
  list-style-type: lower-roman;
}

.markdown-body ul ul ol,
.markdown-body ul ol ol,
.markdown-body ol ul ol,
.markdown-body ol ol ol {
  list-style-type: lower-alpha;
}

.markdown-body dd {
  margin-left: 0;
}

.markdown-body code,
.markdown-body pre,
.markdown-body samp {
  font-family: Consolas, "Liberation Mono", Menlo, Courier, monospace;
  font-size: 12px;
}

.markdown-body pre {
  margin-top: 0;
  margin-bottom: 0;
}

.markdown-body kbd {
  background-color: #e7e7e7;
  background-image: -moz-linear-gradient(#fefefe, #e7e7e7);
  background-image: -webkit-linear-gradient(#fefefe, #e7e7e7);
  background-image: linear-gradient(#fefefe, #e7e7e7);
  background-repeat: repeat-x;
  border-radius: 2px;
  border: 1px solid #cfcfcf;
  color: #000;
  padding: 3px 5px;
  line-height: 10px;
  font: 11px Consolas, "Liberation Mono", Menlo, Courier, monospace;
  display: inline-block;
}

.markdown-body>*:first-child {
  margin-top: 0 !important;
}

.markdown-body>*:last-child {
  margin-bottom: 0 !important;
}

.markdown-body .headerlink {
  font: normal 400 16px fontawesome-mini;
  vertical-align: middle;
  margin-left: -16px;
  float: left;
  display: inline-block;
  text-decoration: none;
  opacity: 0;
  color: #333;
}

.markdown-body .headerlink:focus {
  outline: none;
}

.markdown-body h1 .headerlink {
  margin-top: 0.8rem;
}

.markdown-body h2 .headerlink,
.markdown-body h3 .headerlink {
  margin-top: 0.6rem;
}

.markdown-body h4 .headerlink {
  margin-top: 0.2rem;
}

.markdown-body h5 .headerlink,
.markdown-body h6 .headerlink {
  margin-top: 0;
}

.markdown-body .headerlink:hover,
.markdown-body h1:hover .headerlink,
.markdown-body h2:hover .headerlink,
.markdown-body h3:hover .headerlink,
.markdown-body h4:hover .headerlink,
.markdown-body h5:hover .headerlink,
.markdown-body h6:hover .headerlink {
  opacity: 1;
  text-decoration: none;
}

.markdown-body h1 {
  padding-bottom: 0.3em;
  font-size: 2.25em;
  line-height: 1.2;
  border-bottom: 1px solid #eee;
}

.markdown-body h2 {
  padding-bottom: 0.3em;
  font-size: 1.75em;
  line-height: 1.225;
  border-bottom: 1px solid #eee;
}

.markdown-body h3 {
  font-size: 1.5em;
  line-height: 1.43;
}

.markdown-body h4 {
  font-size: 1.25em;
}

.markdown-body h5 {
  font-size: 1em;
}

.markdown-body h6 {
  font-size: 1em;
  color: #777;
}

.markdown-body p,
.markdown-body blockquote,
.markdown-body ul,
.markdown-body ol,
.markdown-body dl,
.markdown-body table,
.markdown-body pre,
.markdown-body .admonition {
  margin-top: 0;
  margin-bottom: 16px;
}

.markdown-body hr {
  height: 4px;
  padding: 0;
  margin: 16px 0;
  background-color: #e7e7e7;
  border: 0 none;
}

.markdown-body ul,
.markdown-body ol {
  padding-left: 2em;
}

.markdown-body ul ul,
.markdown-body ul ol,
.markdown-body ol ol,
.markdown-body ol ul {
  margin-top: 0;
  margin-bottom: 0;
}

.markdown-body li>p {
  margin-top: 16px;
}

.markdown-body dl {
  padding: 0;
}

.markdown-body dl dt {
  padding: 0;
  margin-top: 16px;
  font-size: 1em;
  font-style: italic;
  font-weight: bold;
}

.markdown-body dl dd {
  padding: 0 16px;
  margin-bottom: 16px;
}

.markdown-body blockquote {
  padding: 0 15px;
  color: #777;
  border-left: 4px solid #ddd;
}

.markdown-body blockquote>:first-child {
  margin-top: 0;
}

.markdown-body blockquote>:last-child {
  margin-bottom: 0;
}

.markdown-body table {
  display: block;
  width: 100%;
  overflow: auto;
  word-break: normal;
  word-break: keep-all;
}

.markdown-body table th {
  font-weight: bold;
}

.markdown-body table th,
.markdown-body table td {
  padding: 6px 13px;
  border: 1px solid #ddd;
}

.markdown-body table tr {
  background-color: #fff;
  border-top: 1px solid #ccc;
}

.markdown-body table tr:nth-child(2n) {
  background-color: #f8f8f8;
}

.markdown-body img {
  max-width: 100%;
  -moz-box-sizing: border-box;
  box-sizing: border-box;
}

.markdown-body code,
.markdown-body samp {
  padding: 0;
  padding-top: 0.2em;
  padding-bottom: 0.2em;
  margin: 0;
  font-size: 85%;
  background-color: rgba(0,0,0,0.04);
  border-radius: 3px;
}

.markdown-body code:before,
.markdown-body code:after {
  letter-spacing: -0.2em;
  content: "\00a0";
}

.markdown-body pre>code {
  padding: 0;
  margin: 0;
  font-size: 100%;
  word-break: normal;
  white-space: pre;
  background: transparent;
  border: 0;
}

.markdown-body .codehilite {
  margin-bottom: 16px;
}

.markdown-body .codehilite pre,
.markdown-body pre {
  padding: 16px;
  overflow: auto;
  font-size: 85%;
  line-height: 1.45;
  background-color: #f7f7f7;
  border-radius: 3px;
}

.markdown-body .codehilite pre {
  margin-bottom: 0;
  word-break: normal;
}

.markdown-body pre {
  word-wrap: normal;
}

.markdown-body pre code {
  display: inline;
  max-width: initial;
  padding: 0;
  margin: 0;
  overflow: initial;
  line-height: inherit;
  word-wrap: normal;
  background-color: transparent;
  border: 0;
}

.markdown-body pre code:before,
.markdown-body pre code:after {
  content: normal;
}

/* Admonition */
.markdown-body .admonition {
  -webkit-border-radius: 3px;
  -moz-border-radius: 3px;
  position: relative;
  border-radius: 3px;
  border: 1px solid #e0e0e0;
  border-left: 6px solid #333;
  padding: 10px 10px 10px 30px;
}

.markdown-body .admonition table {
  color: #333;
}

.markdown-body .admonition p {
  padding: 0;
}

.markdown-body .admonition-title {
  font-weight: bold;
  margin: 0;
}

.markdown-body .admonition>.admonition-title {
  color: #333;
}

.markdown-body .attention>.admonition-title {
  color: #a6d796;
}

.markdown-body .caution>.admonition-title {
  color: #d7a796;
}

.markdown-body .hint>.admonition-title {
  color: #96c6d7;
}

.markdown-body .danger>.admonition-title {
  color: #c25f77;
}

.markdown-body .question>.admonition-title {
  color: #96a6d7;
}

.markdown-body .note>.admonition-title {
  color: #d7c896;
}

.markdown-body .admonition:before,
.markdown-body .attention:before,
.markdown-body .caution:before,
.markdown-body .hint:before,
.markdown-body .danger:before,
.markdown-body .question:before,
.markdown-body .note:before {
  font: normal normal 16px fontawesome-mini;
  -moz-osx-font-smoothing: grayscale;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
  line-height: 1.5;
  color: #333;
  position: absolute;
  left: 0;
  top: 0;
  padding-top: 10px;
  padding-left: 10px;
}

.markdown-body .admonition:before {
  content: "\f056\00a0";
  color: 333;
}

.markdown-body .attention:before {
  content: "\f058\00a0";
  color: #a6d796;
}

.markdown-body .caution:before {
  content: "\f06a\00a0";
  color: #d7a796;
}

.markdown-body .hint:before {
  content: "\f05a\00a0";
  color: #96c6d7;
}

.markdown-body .danger:before {
  content: "\f057\00a0";
  color: #c25f77;
}

.markdown-body .question:before {
  content: "\f059\00a0";
  color: #96a6d7;
}

.markdown-body .note:before {
  content: "\f040\00a0";
  color: #d7c896;
}

.markdown-body .admonition::after {
  content: normal;
}

.markdown-body .attention {
  border-left: 6px solid #a6d796;
}

.markdown-body .caution {
  border-left: 6px solid #d7a796;
}

.markdown-body .hint {
  border-left: 6px solid #96c6d7;
}

.markdown-body .danger {
  border-left: 6px solid #c25f77;
}

.markdown-body .question {
  border-left: 6px solid #96a6d7;
}

.markdown-body .note {
  border-left: 6px solid #d7c896;
}

.markdown-body .admonition>*:first-child {
  margin-top: 0 !important;
}

.markdown-body .admonition>*:last-child {
  margin-bottom: 0 !important;
}

/* progress bar*/
.markdown-body .progress {
  display: block;
  width: 300px;
  margin: 10px 0;
  height: 24px;
  -webkit-border-radius: 3px;
  -moz-border-radius: 3px;
  border-radius: 3px;
  background-color: #ededed;
  position: relative;
  box-shadow: inset -1px 1px 3px rgba(0, 0, 0, .1);
}

.markdown-body .progress-label {
  position: absolute;
  text-align: center;
  font-weight: bold;
  width: 100%; margin: 0;
  line-height: 24px;
  color: #333;
  text-shadow: 1px 1px 0 #fefefe, -1px -1px 0 #fefefe, -1px 1px 0 #fefefe, 1px -1px 0 #fefefe, 0 1px 0 #fefefe, 0 -1px 0 #fefefe, 1px 0 0 #fefefe, -1px 0 0 #fefefe, 1px 1px 2px #000;
  -webkit-font-smoothing: antialiased !important;
  white-space: nowrap;
  overflow: hidden;
}

.markdown-body .progress-bar {
  height: 24px;
  float: left;
  -webkit-border-radius: 3px;
  -moz-border-radius: 3px;
  border-radius: 3px;
  background-color: #96c6d7;
  box-shadow: inset 0 1px 0 rgba(255, 255, 255, .5), inset 0 -1px 0 rgba(0, 0, 0, .1);
  background-size: 30px 30px;
  background-image: -webkit-linear-gradient(
    135deg, rgba(255, 255, 255, .4) 27%,
    transparent 27%,
    transparent 52%, rgba(255, 255, 255, .4) 52%,
    rgba(255, 255, 255, .4) 77%,
    transparent 77%, transparent
  );
  background-image: -moz-linear-gradient(
    135deg,
    rgba(255, 255, 255, .4) 27%, transparent 27%,
    transparent 52%, rgba(255, 255, 255, .4) 52%,
    rgba(255, 255, 255, .4) 77%, transparent 77%,
    transparent
  );
  background-image: -ms-linear-gradient(
    135deg,
    rgba(255, 255, 255, .4) 27%, transparent 27%,
    transparent 52%, rgba(255, 255, 255, .4) 52%,
    rgba(255, 255, 255, .4) 77%, transparent 77%,
    transparent
  );
  background-image: -o-linear-gradient(
    135deg,
    rgba(255, 255, 255, .4) 27%, transparent 27%,
    transparent 52%, rgba(255, 255, 255, .4) 52%,
    rgba(255, 255, 255, .4) 77%, transparent 77%,
    transparent
  );
  background-image: linear-gradient(
    135deg,
    rgba(255, 255, 255, .4) 27%, transparent 27%,
    transparent 52%, rgba(255, 255, 255, .4) 52%,
    rgba(255, 255, 255, .4) 77%, transparent 77%,
    transparent
  );
}

.markdown-body .progress-100plus .progress-bar {
  background-color: #a6d796;
}

.markdown-body .progress-80plus .progress-bar {
  background-color: #c6d796;
}

.markdown-body .progress-60plus .progress-bar {
  background-color: #d7c896;
}

.markdown-body .progress-40plus .progress-bar {
  background-color: #d7a796;
}

.markdown-body .progress-20plus .progress-bar {
  background-color: #d796a6;
}

.markdown-body .progress-0plus .progress-bar {
  background-color: #c25f77;
}

.markdown-body .candystripe-animate .progress-bar{
  -webkit-animation: animate-stripes 3s linear infinite;
  -moz-animation: animate-stripes 3s linear infinite;
  animation: animate-stripes 3s linear infinite;
}

@-webkit-keyframes animate-stripes {
  0% {
    background-position: 0 0;
  }

  100% {
    background-position: 60px 0;
  }
}

@-moz-keyframes animate-stripes {
  0% {
    background-position: 0 0;
  }

  100% {
    background-position: 60px 0;
  }
}

@keyframes animate-stripes {
  0% {
    background-position: 0 0;
  }

  100% {
    background-position: 60px 0;
  }
}

.markdown-body .gloss .progress-bar {
  box-shadow:
    inset 0 4px 12px rgba(255, 255, 255, .7),
    inset 0 -12px 0 rgba(0, 0, 0, .05);
}

/* MultiMarkdown Critic Blocks */
.markdown-body .critic_mark {
  background: #ff0;
}

.markdown-body .critic_delete {
  color: #c82829;
  text-decoration: line-through;
}

.markdown-body .critic_insert {
  color: #718c00 ;
  text-decoration: underline;
}

.markdown-body .critic_comment {
  color: #8e908c;
  font-style: italic;
}

.markdown-body .headeranchor {
  font: normal normal 16px fontawesome-mini;
  line-height: 1;
  display: inline-block;
  text-decoration: none;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

.headeranchor:before {
  content: '\e157';
}

.markdown-body .task-list-item {
  list-style-type: none;
}

.markdown-body .task-list-item+.task-list-item {
  margin-top: 3px;
}

.markdown-body .task-list-item input {
  margin: 0 4px 0.25em -20px;
  vertical-align: middle;
}

/* Media */
@media only screen and (min-width: 480px) {
  .markdown-body {
    font-size:14px;
  }
}

@media only screen and (min-width: 768px) {
  .markdown-body {
    font-size:16px;
  }
}

@media print {
  .markdown-body * {
    background: transparent !important;
    color: black !important;
    filter:none !important;
    -ms-filter: none !important;
  }

  .markdown-body {
    font-size:12pt;
    max-width:100%;
    outline:none;
    border: 0;
  }

  .markdown-body a,
  .markdown-body a:visited {
    text-decoration: underline;
  }

  .markdown-body .headeranchor-link {
    display: none;
  }

  .markdown-body a[href]:after {
    content: " (" attr(href) ")";
  }

  .markdown-body abbr[title]:after {
    content: " (" attr(title) ")";
  }

  .markdown-body .ir a:after,
  .markdown-body a[href^="javascript:"]:after,
  .markdown-body a[href^="#"]:after {
    content: "";
  }

  .markdown-body pre {
    white-space: pre;
    white-space: pre-wrap;
    word-wrap: break-word;
  }

  .markdown-body pre,
  .markdown-body blockquote {
    border: 1px solid #999;
    padding-right: 1em;
    page-break-inside: avoid;
  }

  .markdown-body .progress,
  .markdown-body .progress-bar {
    -moz-box-shadow: none;
    -webkit-box-shadow: none;
    box-shadow: none;
  }

  .markdown-body .progress {
    border: 1px solid #ddd;
  }

  .markdown-body .progress-bar {
    height: 22px;
    border-right: 1px solid #ddd;
  }

  .markdown-body tr,
  .markdown-body img {
    page-break-inside: avoid;
  }

  .markdown-body img {
    max-width: 100% !important;
  }

  .markdown-body p,
  .markdown-body h2,
  .markdown-body h3 {
    orphans: 3;
    widows: 3;
  }

  .markdown-body h2,
  .markdown-body h3 {
    page-break-after: avoid;
  }
}
</style><style>/*GitHub*/
.codehilite {background-color:#fff;color:#333333;}
.codehilite .hll {background-color:#ffffcc;}
.codehilite .c{color:#999988;font-style:italic}
.codehilite .err{color:#a61717;background-color:#e3d2d2}
.codehilite .k{font-weight:bold}
.codehilite .o{font-weight:bold}
.codehilite .cm{color:#999988;font-style:italic}
.codehilite .cp{color:#999999;font-weight:bold}
.codehilite .c1{color:#999988;font-style:italic}
.codehilite .cs{color:#999999;font-weight:bold;font-style:italic}
.codehilite .gd{color:#000000;background-color:#ffdddd}
.codehilite .ge{font-style:italic}
.codehilite .gr{color:#aa0000}
.codehilite .gh{color:#999999}
.codehilite .gi{color:#000000;background-color:#ddffdd}
.codehilite .go{color:#888888}
.codehilite .gp{color:#555555}
.codehilite .gs{font-weight:bold}
.codehilite .gu{color:#800080;font-weight:bold}
.codehilite .gt{color:#aa0000}
.codehilite .kc{font-weight:bold}
.codehilite .kd{font-weight:bold}
.codehilite .kn{font-weight:bold}
.codehilite .kp{font-weight:bold}
.codehilite .kr{font-weight:bold}
.codehilite .kt{color:#445588;font-weight:bold}
.codehilite .m{color:#009999}
.codehilite .s{color:#dd1144}
.codehilite .n{color:#333333}
.codehilite .na{color:teal}
.codehilite .nb{color:#0086b3}
.codehilite .nc{color:#445588;font-weight:bold}
.codehilite .no{color:teal}
.codehilite .ni{color:purple}
.codehilite .ne{color:#990000;font-weight:bold}
.codehilite .nf{color:#990000;font-weight:bold}
.codehilite .nn{color:#555555}
.codehilite .nt{color:navy}
.codehilite .nv{color:teal}
.codehilite .ow{font-weight:bold}
.codehilite .w{color:#bbbbbb}
.codehilite .mf{color:#009999}
.codehilite .mh{color:#009999}
.codehilite .mi{color:#009999}
.codehilite .mo{color:#009999}
.codehilite .sb{color:#dd1144}
.codehilite .sc{color:#dd1144}
.codehilite .sd{color:#dd1144}
.codehilite .s2{color:#dd1144}
.codehilite .se{color:#dd1144}
.codehilite .sh{color:#dd1144}
.codehilite .si{color:#dd1144}
.codehilite .sx{color:#dd1144}
.codehilite .sr{color:#009926}
.codehilite .s1{color:#dd1144}
.codehilite .ss{color:#990073}
.codehilite .bp{color:#999999}
.codehilite .vc{color:teal}
.codehilite .vg{color:teal}
.codehilite .vi{color:teal}
.codehilite .il{color:#009999}
.codehilite .gc{color:#999;background-color:#EAF2F5}
</style><title>floyd_manual</title></head><body><article class="markdown-body"><!---
Building TOC and links using Sublime Text 3, Markdowntoc and Markdown preview
-->

<p><img alt="" src="/Users/marcus/Documents/GitHub/Floyd/docs/floyd_manual/floyd_logo_banner.png" /></p>
<h1 id="table-of-contents">TABLE OF CONTENTS<a class="headerlink" href="#table-of-contents" title="Permanent link"></a></h1>
<!-- MarkdownTOC autolink="true" levels="1, 2, 3" autolink="true" autoanchor="true"  -->

<ul>
<li><a href="#1-floyd-language-users-manual">1 FLOYD LANGUAGE USER&rsquo;S MANUAL</a><ul>
<li><a href="#11-about-floyd">1.1 ABOUT FLOYD</a></li>
<li><a href="#12-getting-started">1.2 GETTING STARTED</a></li>
<li><a href="#13-command-line-tool">1.3 COMMAND LINE TOOL</a></li>
<li><a href="#14-global-scope-and-main-function">1.4 GLOBAL SCOPE AND MAIN FUNCTION</a></li>
<li><a href="#15-data-types">1.5 DATA TYPES</a></li>
<li><a href="#16-operators-and-expressions">1.6 OPERATORS AND EXPRESSIONS</a></li>
<li><a href="#17-values-variables">1.7 VALUES, VARIABLES</a><ul>
<li><a href="#immutable-values-vs-variables">IMMUTABLE VALUES VS VARIABLES</a></li>
<li><a href="#deep-by-value">DEEP BY VALUE</a></li>
<li><a href="#value-oriented-no-pointers">VALUE ORIENTED, NO POINTERS</a></li>
<li><a href="#static-typing-inferred">STATIC TYPING, INFERRED</a></li>
</ul>
</li>
<li><a href="#18-comments-and-documentation">1.8 COMMENTS AND DOCUMENTATION</a></li>
<li><a href="#19-string">1.9 STRING</a></li>
<li><a href="#110-vector">1.10 VECTOR</a></li>
<li><a href="#111-dictionary">1.11 DICTIONARY</a></li>
<li><a href="#112-struct">1.12 STRUCT</a></li>
<li><a href="#113-function">1.13 FUNCTION</a></li>
<li><a href="#114-test-def-making-tests-and-trying-things-out">1.14 TEST-DEF: MAKING TESTS AND TRYING THINGS OUT</a></li>
<li><a href="#115-json-and-automatic-serialization">1.15 JSON AND AUTOMATIC SERIALIZATION</a></li>
<li><a href="#116-floyd-processes---talking-to-the-real-world">1.16 FLOYD PROCESSES - TALKING TO THE REAL WORLD</a><ul>
<li><a href="#gain-performance-via-concurrency">GAIN PERFORMANCE VIA CONCURRENCY</a></li>
<li><a href="#concurrency-scenarios">CONCURRENCY SCENARIOS</a></li>
<li><a href="#example-simple-console-program">EXAMPLE: SIMPLE CONSOLE PROGRAM</a></li>
<li><a href="#example-pacman-iphone">EXAMPLE: PACMAN IPHONE</a></li>
</ul>
</li>
<li><a href="#117-system-architecture">1.17 SYSTEM ARCHITECTURE</a><ul>
<li><a href="#diagrams">DIAGRAMS</a></li>
</ul>
</li>
<li><a href="#118-todo-exceptions">1.18 TODO: EXCEPTIONS</a></li>
<li><a href="#119-about-performance">1.19 ABOUT PERFORMANCE</a></li>
<li><a href="#120-micro-benchmarks">1.20 MICRO BENCHMARKS</a><ul>
<li><a href="#about-micro-benchmarks">ABOUT MICRO BENCHMARKS</a></li>
<li><a href="#running-micro-benchmarks-from-command-line-tool">RUNNING MICRO BENCHMARKS FROM COMMAND LINE TOOL</a></li>
<li><a href="#running-micro-benchmarks-from-floyd-code">RUNNING MICRO BENCHMARKS FROM FLOYD CODE</a></li>
<li><a href="#hardware-caps">HARDWARE CAPS</a></li>
</ul>
</li>
<li><a href="#121-about-parallelism">1.21 ABOUT PARALLELISM</a></li>
<li><a href="#122-todo-probes">1.22 TODO: PROBES</a></li>
<li><a href="#123-todo-tweakers">1.23 TODO: TWEAKERS</a></li>
</ul>
</li>
<li><a href="#2-floyd-language-reference-manual">2 FLOYD LANGUAGE REFERENCE MANUAL</a><ul>
<li><a href="#21-source-code-files">2.1 SOURCE CODE FILES</a></li>
<li><a href="#22-main--executing-programs">2.2 MAIN() &amp; EXECUTING PROGRAMS</a></li>
<li><a href="#23-compiler-intrinsics">2.3 COMPILER INTRINSICS</a></li>
<li><a href="#24-data-types">2.4 DATA TYPES</a><ul>
<li><a href="#example-type-declarations">EXAMPLE TYPE DECLARATIONS</a></li>
<li><a href="#bool">BOOL</a></li>
<li><a href="#int">INT</a></li>
<li><a href="#double">DOUBLE</a></li>
<li><a href="#string">STRING</a></li>
<li><a href="#vector">VECTOR</a></li>
<li><a href="#dictionary">DICTIONARY</a></li>
<li><a href="#struct">STRUCT</a></li>
<li><a href="#typeid">TYPEID</a></li>
<li><a href="#json">JSON</a></li>
<li><a href="#todo-protocol">TODO: PROTOCOL</a></li>
</ul>
</li>
<li><a href="#25-expressions">2.5 EXPRESSIONS</a><ul>
<li><a href="#literals">LITERALS</a></li>
<li><a href="#vector-constructor">VECTOR CONSTRUCTOR</a></li>
<li><a href="#dictionary-constructor">DICTIONARY CONSTRUCTOR</a></li>
<li><a href="#function-call">FUNCTION CALL</a></li>
<li><a href="#arithmetic-operators">ARITHMETIC OPERATORS</a></li>
<li><a href="#relational-operators">RELATIONAL OPERATORS</a></li>
<li><a href="#logical-operators">LOGICAL OPERATORS</a></li>
<li><a href="#conditional-operator">CONDITIONAL OPERATOR</a></li>
<li><a href="#bitwise-operators">BITWISE OPERATORS</a></li>
<li><a href="#benchmark">BENCHMARK</a></li>
<li><a href="#example-expressions">EXAMPLE EXPRESSIONS</a></li>
</ul>
</li>
<li><a href="#26-statements">2.6 STATEMENTS</a><ul>
<li><a href="#let">LET</a></li>
<li><a href="#mutable">MUTABLE</a></li>
<li><a href="#function-definition">FUNCTION DEFINITION</a></li>
<li><a href="#test-def-statement">TEST-DEF STATEMENT</a></li>
<li><a href="#struct-definition">STRUCT DEFINITION</a></li>
<li><a href="#if---then---else">IF - THEN - ELSE</a></li>
<li><a href="#for-loop">FOR LOOP</a></li>
<li><a href="#while">WHILE</a></li>
<li><a href="#return">RETURN</a></li>
<li><a href="#software-system-def">SOFTWARE-SYSTEM-DEF</a></li>
<li><a href="#container-def">CONTAINER-DEF</a></li>
<li><a href="#benchmark-def">BENCHMARK-DEF</a></li>
<li><a href="#todo-switch">TODO: SWITCH</a></li>
</ul>
</li>
<li><a href="#27-example-software-system-file">2.7 EXAMPLE SOFTWARE SYSTEM FILE</a></li>
<li><a href="#28-floyd-syntax">2.8 FLOYD SYNTAX</a></li>
</ul>
</li>
<li><a href="#3-standard-library">3 STANDARD LIBRARY</a><ul>
<li><a href="#31-micro-benchmarking-features">3.1 MICRO BENCHMARKING FEATURES</a><ul>
<li><a href="#benchmarkid_t-and-benchmark_result2t">benchmark_id_t and benchmark_result2_t</a></li>
<li><a href="#get_benchmarks">get_benchmarks()</a></li>
<li><a href="#run_benchmarks">run_benchmarks()</a></li>
<li><a href="#makebenchmarkreport">make_benchmark_report()</a></li>
</ul>
</li>
<li><a href="#32-hardware-caps">3.2 HARDWARE CAPS</a><ul>
<li><a href="#detecthardwarecaps">detect_hardware_caps()</a></li>
<li><a href="#makehardware_capsreport">make_hardware_caps_report()</a></li>
<li><a href="#makehardware_caps_reportbrief">make_hardware_caps_report_brief()</a></li>
<li><a href="#getcurrent_date_and_timestring">get_current_date_and_time_string()</a></li>
</ul>
</li>
<li><a href="#33-working-with-hashes---sha1">3.3 WORKING WITH HASHES - SHA1</a><ul>
<li><a href="#quickhasht">quick_hash_t</a></li>
<li><a href="#sha1_t">sha1_t</a></li>
<li><a href="#calcstringsha1">calc_string_sha1()</a></li>
<li><a href="#calcbinarysha1">calc_binary_sha1()</a></li>
</ul>
</li>
<li><a href="#34-date-and-time">3.4 DATE AND TIME</a><ul>
<li><a href="#timemst">time_ms_t</a></li>
<li><a href="#date_t">date_t</a></li>
<li><a href="#gettime_ofday">get_time_of_day()</a></li>
</ul>
</li>
<li><a href="#35-file-system-features">3.5 FILE SYSTEM FEATURES</a><ul>
<li><a href="#readtextfile">read_text_file()</a></li>
<li><a href="#writetextfile">write_text_file()</a></li>
<li><a href="#readlinestdin">read_line_stdin()</a></li>
<li><a href="#getfsentries_shallow-and-get_fsentriesdeep">get_fsentries_shallow() and get_fsentries_deep()</a></li>
<li><a href="#getfsentryinfo">get_fsentry_info()</a></li>
<li><a href="#getfsenvironment">get_fs_environment()</a></li>
<li><a href="#doesfsentryexist">does_fsentry_exist()</a></li>
<li><a href="#createdirectorybranch">create_directory_branch()</a></li>
<li><a href="#deletefsentrydeep">delete_fsentry_deep()</a></li>
<li><a href="#rename_fsentry">rename_fsentry()</a></li>
</ul>
</li>
<li><a href="#36-standard-types">3.6 STANDARD TYPES</a><ul>
<li><a href="#uuid_t">uuid_t</a></li>
<li><a href="#ipaddresst">ip_address_t</a></li>
<li><a href="#url_t">url_t</a></li>
<li><a href="#urlpartst-">url_parts_t {}</a></li>
<li><a href="#key_t">key_t</a></li>
<li><a href="#binary_t">binary_t</a></li>
<li><a href="#seq_t">seq_t</a></li>
<li><a href="#text_t">text_t</a></li>
<li><a href="#textresourceid">text_resource_id</a></li>
<li><a href="#imageidt">image_id_t</a></li>
<li><a href="#color_t">color_t</a></li>
<li><a href="#vector2_t">vector2_t</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<!-- /MarkdownTOC -->

<p><a id="1-floyd-language-users-manual"></a></p>
<h1 id="1-floyd-language-users-manual">1 FLOYD LANGUAGE USER&rsquo;S MANUAL<a class="headerlink" href="#1-floyd-language-users-manual" title="Permanent link"></a></h1>
<p>This document assumes the reader knows basic programming concepts like variables, functions and types. It comes in two parts. The first is the user’s guide which explains how to use Floyd to build programs, the unique features of Floyd and its most important concepts. The second part is the reference manual that goes through every feature and explains in detail how they work.</p>
<p><a id="11-about-floyd"></a></p>
<h2 id="11-about-floyd">1.1 ABOUT FLOYD<a class="headerlink" href="#11-about-floyd" title="Permanent link"></a></h2>
<p>Floyd is a programming language that aims to compete with languages like Java, C++, Rust, Go, Javascript and Python. Floyd cares about low level things like CPU memory hardware as well as high level things like software systems, containers, components, APIs and virtual processes.</p>
<p>Floyd generates native machine code but also comes with a bytecode interpreter.</p>
<p><a id="12-getting-started"></a></p>
<h2 id="12-getting-started">1.2 GETTING STARTED<a class="headerlink" href="#12-getting-started" title="Permanent link"></a></h2>
<p><img alt="" src="/Users/marcus/Documents/GitHub/Floyd/docs/floyd_manual/floyd_quick_reference.png" /></p>
<p><a id="13-command-line-tool"></a></p>
<h2 id="13-command-line-tool">1.3 COMMAND LINE TOOL<a class="headerlink" href="#13-command-line-tool" title="Permanent link"></a></h2>
<p>Usage:</p>
<table>
<thead>
<tr>
<th align="left"></th>
<th align="left">COMMAND</th>
<th align="left">MEANING</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">help</td>
<td align="left">floyd help</td>
<td align="left">Show built in help for command line tool</td>
</tr>
<tr>
<td align="left">run</td>
<td align="left">floyd run game.floyd [arg1 arg2]</td>
<td align="left">compile and run the floyd program &ldquo;game.floyd&rdquo; using native execution. arg1 and arg2 are inputs to your main()</td>
</tr>
<tr>
<td align="left">run</td>
<td align="left">floyd run -t mygame.floyd</td>
<td align="left">-t turns on tracing, which shows compilation steps</td>
</tr>
<tr>
<td align="left">compile</td>
<td align="left">floyd compile mygame.floyd</td>
<td align="left">compile the floyd program &ldquo;mygame.floyd&rdquo; to a native object file, output to stdout</td>
</tr>
<tr>
<td align="left">compile</td>
<td align="left">floyd compile game.floyd -o test.o</td>
<td align="left">compile the floyd program &ldquo;game.floyd&rdquo; to a native object file .o, called &ldquo;test.o&rdquo;</td>
</tr>
<tr>
<td align="left">test</td>
<td align="left">floyd test game.floyd</td>
<td align="left">Runs all unit tests in game.floyd, then quits: Does not call main() or start Floyd processes</td>
</tr>
<tr>
<td align="left">test</td>
<td align="left">floyd test game.floyd one two</td>
<td align="left">Returns tests called &ldquo;one&rdquo; and &ldquo;two&rdquo; before running main() / starting processes</td>
</tr>
<tr>
<td align="left">test</td>
<td align="left">floyd test -l game.floyd</td>
<td align="left">Returns list of unit tests</td>
</tr>
<tr>
<td align="left">bench</td>
<td align="left">floyd bench mygame.floyd</td>
<td align="left">Runs all benchmarks, as defined by benchmark-def statements in Floyd program</td>
</tr>
<tr>
<td align="left">bench</td>
<td align="left">floyd bench game.floyd rle game_lp</td>
<td align="left">Runs specified benchmarks: &ldquo;rle&rdquo; and &ldquo;game_lp&rdquo;</td>
</tr>
<tr>
<td align="left">bench</td>
<td align="left">floyd bench -l mygame.floyd</td>
<td align="left">Returns list of benchmarks</td>
</tr>
<tr>
<td align="left">hwcaps</td>
<td align="left">floyd hwcaps</td>
<td align="left">Outputs hardware capabilities</td>
</tr>
<tr>
<td align="left">runtests</td>
<td align="left">floyd runtests</td>
<td align="left">Runs Floyd built internal unit tests</td>
</tr>
</tbody>
</table>
<p>Flags:</p>
<table>
<thead>
<tr>
<th align="left">FLAG</th>
<th align="left">MEANING</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">-t</td>
<td align="left">Verbose tracing</td>
</tr>
<tr>
<td align="left">-p</td>
<td align="left">Output parse tree as a JSON</td>
</tr>
<tr>
<td align="left">-a</td>
<td align="left">Output Abstract syntax tree (AST) as a JSON</td>
</tr>
<tr>
<td align="left">-i</td>
<td align="left">Output intermediate representation (IR / ASM) as assembly</td>
</tr>
<tr>
<td align="left">-b</td>
<td align="left">Use Floyd&rsquo;s bytecode backend instead of default LLVM</td>
</tr>
<tr>
<td align="left">-u</td>
<td align="left">Skip running the program&rsquo;s unit tests</td>
</tr>
<tr>
<td align="left">-g</td>
<td align="left">Compiler with debug info, no optimizations</td>
</tr>
<tr>
<td align="left">-O1</td>
<td align="left">Enable trivial optimizations</td>
</tr>
<tr>
<td align="left">-O2</td>
<td align="left">Enable default optimizations</td>
</tr>
<tr>
<td align="left">-O3</td>
<td align="left">Enable expensive optimizations</td>
</tr>
<tr>
<td align="left">-l</td>
<td align="left">returns a list (of tests or benchmarks)</td>
</tr>
<tr>
<td align="left">-vcarray</td>
<td align="left">Force vectors to use carray backend</td>
</tr>
<tr>
<td align="left">-vhamt</td>
<td align="left">Force vectors to use HAMT backend (this is default)</td>
</tr>
<tr>
<td align="left">-dcppmap</td>
<td align="left">Force dictionaries to use c++ map as backend</td>
</tr>
<tr>
<td align="left">-dhamt</td>
<td align="left">Force dictionaries to use HAMT backend (this is default)</td>
</tr>
</tbody>
</table>
<h5 id="more-examples">MORE EXAMPLES<a class="headerlink" href="#more-examples" title="Permanent link"></a></h5>
<p>Compile &ldquo;examples/fibonacci.floyd&rdquo; to LLVM IR code, disable optimization, write to file &ldquo;a.ir&rdquo;</p>
<blockquote>
<p>floyd compile -i -g examples/fibonacci.floyd -o a.ir</p>
</blockquote>
<p><a id="14-global-scope-and-main-function"></a></p>
<h2 id="14-global-scope-and-main-function">1.4 GLOBAL SCOPE AND MAIN FUNCTION<a class="headerlink" href="#14-global-scope-and-main-function" title="Permanent link"></a></h2>
<p>The global scope is the top level of you source file: statements that are not inside any function. Here you normally define functions, structs and global constants. The global scope can have almost any statement and they execute at program start. Simple programs can do without defining any functions at all.</p>
<p>You can implement a function called &ldquo;main&rdquo; that will be called by the Floyd runtime after all global statements have been executed. The main() function is optional, but the only way to get command line arguments and return a command line error code. Main-function that receives a vector of command line arguments:</p>
<div class="codehilite"><pre>func int main([string] args){
    print(args)
    assert(args == [&quot;-a&quot;, &quot;output.txt&quot;])

    return 42
}
</pre></div>

<blockquote>
<p>floyd run my_program.floyd -a output.txt</p>
</blockquote>
<p>&hellip;will call your main() function with [&ldquo;-a&rdquo;, &ldquo;output.txt&rdquo;] and your executable will return 42.</p>
<p><a id="15-data-types"></a></p>
<h2 id="15-data-types">1.5 DATA TYPES<a class="headerlink" href="#15-data-types" title="Permanent link"></a></h2>
<p>These are the primitive data types built into the language itself. The building blocks of all values and data in Floyd.
One of Floyd&rsquo;s goals is that all the basics you need are already there in the language and the standard library. This makes it easy to start making meaningful programs. It also promotes composability since all Floyd code can rely on these types and communicate between themselves using these types. This greatly reduces the need to write glue code that converts between different library&rsquo;s string classes and logging and so on.</p>
<table>
<thead>
<tr>
<th align="left">TYPE</th>
<th align="left">USE</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><strong>bool</strong></td>
<td align="left"><strong>true</strong> or <strong>false</strong></td>
</tr>
<tr>
<td align="left"><strong>int</strong></td>
<td align="left">Signed 64 bit integer</td>
</tr>
<tr>
<td align="left"><strong>double</strong></td>
<td align="left">64-bit floating point number</td>
</tr>
<tr>
<td align="left"><strong>string</strong></td>
<td align="left">Built-in string type</td>
</tr>
<tr>
<td align="left"><strong>typeid</strong></td>
<td align="left">Describes the <em>type</em> of a value</td>
</tr>
<tr>
<td align="left"><strong>function</strong></td>
<td align="left">A function value. Functions can be Floyd functions or C functions. They are callable</td>
</tr>
<tr>
<td align="left"><strong>struct</strong></td>
<td align="left">Like C struct or classes or tuples. A value object</td>
</tr>
<tr>
<td align="left"><strong>vector</strong></td>
<td align="left">A continuous array of elements addressed via indexes</td>
</tr>
<tr>
<td align="left"><strong>dictionary</strong></td>
<td align="left">Lookup values using string keys</td>
</tr>
<tr>
<td align="left"><strong>json</strong></td>
<td align="left">A value that holds a JSON-compatible value, can be a big JSON tree</td>
</tr>
</tbody>
</table>
<p>Notice that string has many qualities of an array of characters. You can ask for its size, access characters via [], etc.</p>
<p>The standard library has more common types, like sha1_t, uuid_t, url_t, date_t, binary_t and text_t.</p>
<p><a id="16-operators-and-expressions"></a></p>
<h2 id="16-operators-and-expressions">1.6 OPERATORS AND EXPRESSIONS<a class="headerlink" href="#16-operators-and-expressions" title="Permanent link"></a></h2>
<p>There are operators for comparing values: &lt;, &gt;, &lt;=, &gt;=, == (equal), != (not equal).
Logical operators &amp;&amp; (and) and || (or).
There are arithmetic operators like +, -, *, / and %.</p>
<p>The trinary comparison operator is also supported:</p>
<div class="codehilite"><pre>let direction = x &gt; 0 ? -1 : +1
</pre></div>

<p>Notice that floyd has no special operator syntax for bitwise operations the way C has.</p>
<p><a id="17-values-variables"></a></p>
<h2 id="17-values-variables">1.7 VALUES, VARIABLES<a class="headerlink" href="#17-values-variables" title="Permanent link"></a></h2>
<p><a id="immutable-values-vs-variables"></a></p>
<h3 id="immutable-values-vs-variables">IMMUTABLE VALUES VS VARIABLES<a class="headerlink" href="#immutable-values-vs-variables" title="Permanent link"></a></h3>
<p>All values in Floyd are immutable &ndash; you make new values based on previous values, but you don&rsquo;t directly modify old values. Internally Floyd uses clever mechanisms to make this fast and avoids copying data too much. It&rsquo;s perfectly good to replace a character in a 3 GB long string and get a new 3 GB string as a result. Almost all of the characters will be stored only once.
The only exception is local variables that can be forced to be mutable.</p>
<p>(Also, each green-process has one mutable value too.)</p>
<ul>
<li>Function arguments</li>
<li>Function local variables</li>
<li>Member variables of structs.</li>
</ul>
<p>When defining a variable, you can often skip telling which type it is, since the type can be inferred by the Floyd compiler.</p>
<p>Explicit</p>
<div class="codehilite"><pre>let int x = 10
</pre></div>

<p>Implicit</p>
<div class="codehilite"><pre>let y = 11
</pre></div>

<p>Example:</p>
<div class="codehilite"><pre>let a = &quot;hello&quot;
a = &quot;goodbye&quot;   //  Error - you cannot change variable a.
</pre></div>

<p>You can use &ldquo;mutable&rdquo; to make a variable changeable.</p>
<div class="codehilite"><pre>mutable a = &quot;hello&quot;
a = &quot;goodbye&quot;   //  Changes variable a to &quot;goodbye&quot;.
</pre></div>

<p><a id="deep-by-value"></a></p>
<h3 id="deep-by-value">DEEP BY VALUE<a class="headerlink" href="#deep-by-value" title="Permanent link"></a></h3>
<p>All values and aggregated members values are always considered in operations in any type of nesting of structs and values and collections. This includes equality checks or assignment for example.</p>
<p>The order of the members inside the struct (or collection) is important for sorting since those are done member by member from top to bottom.</p>
<p>Example: your application&rsquo;s entire state may be stored in <em>one</em> value in a struct containing other structs and vectors and so on. This value can still be copied around quickly, it is automatically sortable, convertible to JSON or whatever.</p>
<p><a id="value-oriented-no-pointers"></a></p>
<h3 id="value-oriented-no-pointers">VALUE ORIENTED, NO POINTERS<a class="headerlink" href="#value-oriented-no-pointers" title="Permanent link"></a></h3>
<p>There are no pointers or references in Floyd. You copy values around deeply instead. Even a big value like your game&rsquo;s entire world or your word processor&rsquo;s entire document. Behind the curtains Floyd uses pointers extensively to make this fast.</p>
<p>Removing the concept of pointers makes programming easier. There are no dangling pointers, aliasing problems or defensive copying and other classic problems. It also makes it simpler for the runtime and compiler to generate extremely fast code.</p>
<p><a id="static-typing-inferred"></a></p>
<h3 id="static-typing-inferred">STATIC TYPING, INFERRED<a class="headerlink" href="#static-typing-inferred" title="Permanent link"></a></h3>
<p>Floyd is strongly typed language. Every variable, argument, return value and struct member has a defined type. If you make a vector of elements, you need to decide on one type of elements to store in the vector.</p>
<p>All types are defined at compile time, before the program runs. This is how Java, C++ and Swift works.</p>
<p>Javascript, Python and Ruby does not use static typing.</p>
<p>You can often leave out the actual type from the code, when the compiler already knows the type - the compiler can often guess = infer the type.</p>
<p><a id="18-comments-and-documentation"></a></p>
<h2 id="18-comments-and-documentation">1.8 COMMENTS AND DOCUMENTATION<a class="headerlink" href="#18-comments-and-documentation" title="Permanent link"></a></h2>
<p>Use comments to write documentation, notes or explanations in the code. Comments are not executed or compiled &ndash; they are only for humans. You often use the comment features to disable / hide code from the compiler.</p>
<p>Two types of comments:</p>
<p>You can wrap many lines with &ldquo;/*&rdquo; and &ldquo;*/&rdquo; to make a big section of documentation or to disable many lines of code. You can nest comments, for example wrap a lot of code that already contains comments using /* &hellip; */.</p>
<div class="codehilite"><pre>/*  This is a comment */
</pre></div>

<p>Everything between // and newline is a comment:</p>
<div class="codehilite"><pre>//  This is an end-of line comment
let a = &quot;hello&quot; //  This is an end of line comment.
</pre></div>

<p><a id="19-string"></a></p>
<h2 id="19-string">1.9 STRING<a class="headerlink" href="#19-string" title="Permanent link"></a></h2>
<p>Floyd has a built-in 8-bit string type. As all data types in Floyd, the string type is immutable. You can also use them as fast and compact arrays of bytes since there are no other 8 bit types in Floyd. You can make string literals directly in the source code like this: <code>let a = "Hello, world!"</code></p>
<p>All comparison expressions work, like a == b, a &lt; b, a &gt;= b, a != b and so on. You can access a random character in the string, using its integer position, where element 0 is the first character, 1 the second etc. You can append two strings together using the + operation.</p>
<div class="codehilite"><pre>let a = &quot;Hello&quot;[1]
assert(a == &quot;e&quot;)
</pre></div>

<p><strong>Notice 1</strong>: You cannot modify the string using [], only read. Use update() to change a character.</p>
<p><strong>Notice 2</strong>: Floyd returns the character as an int, which is 64 bit signed integer.</p>
<p>Notice: a special mechansim for Unicode is planned, using another data type: &ldquo;text&rdquo;.</p>
<p><a id="110-vector"></a></p>
<h2 id="110-vector">1.10 VECTOR<a class="headerlink" href="#110-vector" title="Permanent link"></a></h2>
<p>A vector is a collection of values where you look up the values using an index between 0 and (vector size - 1). The items in a vector are called &ldquo;elements&rdquo;. The elements are ordered. Finding an element at an index uses constant time. In other languages vectors are called &ldquo;arrays&rdquo; or even &ldquo;lists&rdquo;. Floyd vectors can have any size - the number of elements is not part of the type.</p>
<p>You can make a new vector and specify its elements directly, like this:</p>
<div class="codehilite"><pre>let a = [ 1, 2, 3]
</pre></div>

<p>You can also calculate its elements, they don&rsquo;t need to be constants:</p>
<div class="codehilite"><pre>let a = [ calc_pi(4), 2.1, size([ 20, 21 ]) ]
</pre></div>

<p>You can put any type of value into a vector: integers, doubles, strings, structs, other vectors and so on. All elements must be the <em>same type</em> inside a specific vector.</p>
<p>You can copy vectors using = operator. All comparison expressions work, like a == b, a &lt; b, a &gt;= b, a != b and similar. Comparisons will compare each element of the two vectors.</p>
<p>This lets you access a random element in the vector, using its integer position.</p>
<div class="codehilite"><pre>let a = [10, 20, 30][1]
assert(a == 20)
</pre></div>

<p><strong>Notice:</strong> You cannot modify the vector using [], only read. Use update() to change an element.</p>
<p>You can append two vectors together using the + operation.</p>
<div class="codehilite"><pre>let a = [ 10, 20, 30 ] + [ 40, 50 ]
assert(a == [ 10, 20, 30, 40, 50 ])
</pre></div>

<p><a id="111-dictionary"></a></p>
<h2 id="111-dictionary">1.11 DICTIONARY<a class="headerlink" href="#111-dictionary" title="Permanent link"></a></h2>
<p>A collection of values where you identify the values using string keys. In C++ you would use a std::map. When you specify the type of dictionary you must always include &ldquo;string&rdquo;. You can put any type of value into the dictionary (but not mix inside the same dictionary).</p>
<p>You make a new dictionary and specify its values like this:</p>
<div class="codehilite"><pre>let [string: int] a = { &quot;red&quot;: 0, &quot;blue&quot;: 100, &quot;green&quot;: 255 }
</pre></div>

<p>or shorter:</p>
<div class="codehilite"><pre>b = { &quot;red&quot;: 0, &quot;blue&quot;: 100, &quot;green&quot;: 255 }
</pre></div>

<p>Use [] to look up values using a key. It throws an exception is the key not found. If you want to avoid that. check with exists() first.</p>
<p>You copy dictionaries using = and all comparison expressions work, just like with strings and vectors.</p>
<p><a id="112-struct"></a></p>
<h2 id="112-struct">1.12 STRUCT<a class="headerlink" href="#112-struct" title="Permanent link"></a></h2>
<p>Structs are the central building block for composing data in Floyd. They are used in place of classes in other programming languages. Structs are alway use value-semantics and are immutable. They are very fast and compact: behind the curtains copied structs shares state between them, even when partially modified.</p>
<p>Every struct type automatically gets a constructor function with the same name. It is the only function that can create a value of the struct. Its arguments match the struct&rsquo;s members.</p>
<p>Usually you create some functions that makes instancing a struct convenient, like make_black_color(), make_empty() etc.</p>
<p>All comparison operators: == != &lt; &gt; &lt;= &gt;= always work.</p>
<p>There is no concept of pointers or references or shared structs so there are no problems with aliasing or side effects caused by several clients modifying the same struct.</p>
<h5 id="example">Example:<a class="headerlink" href="#example" title="Permanent link"></a></h5>
<div class="codehilite"><pre>//  Make simple, ready-for use struct.
struct point {
    double x
    double y
}

//  Try the new struct:

let a = point(0, 3)
assert(a.x == 0)
assert(a.y == 3)

let b = point(0, 3)
let c = point(1, 3)

assert(a == a)
assert(a == b)
assert(a != c)
assert(c &gt; a)
</pre></div>

<h5 id="update">UPDATE()<a class="headerlink" href="#update" title="Permanent link"></a></h5>
<p>let b = update(a, member, value)</p>
<div class="codehilite"><pre>//  Make simple, ready-for use struct.
struct point {
    double x
    double y
}

let a = point(0, 3)

//  Nothing happens! Setting width to 100 returns us a new point but we don&#39;t keep it.
update(a, x, 100)
assert(a.x == 0)

//  Modifying a member creates a new instance, we assign it to b
let b = update(a, x, 100)

//  Now we have the original, unmodified a and the new, updated b.
assert(a.x == 0)
assert(b.x == 100)
</pre></div>

<p>This works with nested values too:</p>
<div class="codehilite"><pre>//  Define an image-struct that holds some stuff, including a pixel struct.
struct image { string name; point size }

let a = image(&quot;Cat image.png&quot;, point(512, 256))

assert(a.size.x == 512)

//  Update the width-member inside the image&#39;s size-member. The result is a brand-new image, b!
let b = update(a, size.x, 100)
assert(a.size.x == 512)
assert(b.size.x == 100)
</pre></div>

<p><a id="113-function"></a></p>
<h2 id="113-function">1.13 FUNCTION<a class="headerlink" href="#113-function" title="Permanent link"></a></h2>
<p>Functions in Floyd are by default <em>pure</em>, or <em>referential transparent</em>. This means they can only read their input arguments and constants. They cannot modify global variables or affect the outside work via communication or files.</p>
<blockquote>
<p>When you call a pure function with a set of arguments you <em>always get the same result back</em>.</p>
</blockquote>
<p>While a function executes, it perceives the outside world to stand still.</p>
<p>Functions always return exactly one value. Use a struct to return more values.</p>
<p>Example definitions of functions:</p>
<div class="codehilite"><pre>func int f1(string x){
    return 3
}

func int f2(int a, int b){
    return 5
}

func int f3(){  
    return 100
}

func string f4(string x, bool y){
    return &quot;&lt;&quot; + x + &quot;&gt;&quot;
}
</pre></div>

<p>Function types:</p>
<div class="codehilite"><pre>func bool (string, double)
</pre></div>

<p>This is a function that takes a function value as argument:</p>
<div class="codehilite"><pre>func int f5(func bool (string, string))
</pre></div>

<p>This is a function that returns a function value:</p>
<div class="codehilite"><pre>func bool (string, string) f5(int x)
</pre></div>

<p>All arguments to a function are read-only &ndash; you cannot modify the arguments or anything they refer too. There are no output parameters in Floyd.</p>
<p><a id="impure-functions"></a></p>
<h4 id="impure-functions">IMPURE FUNCTIONS<a class="headerlink" href="#impure-functions" title="Permanent link"></a></h4>
<p>You can tag a function to be impure using the &ldquo;impure&rdquo; keyword.</p>
<div class="codehilite"><pre>func int f1(string x) impure {
    return 3
}
</pre></div>

<p>This means the function has side effects or gets information somewhere that can change over time.</p>
<ul>
<li>A pure function cannot call any impure functions!</li>
<li>An impure function can call both pure and impure functions.</li>
</ul>
<p>Limit the amount of impure code!</p>
<p>A number of impure functions are built into the language and its standard library.</p>
<p><a id="114-test-def-making-tests-and-trying-things-out"></a></p>
<h2 id="114-test-def-making-tests-and-trying-things-out">1.14 TEST-DEF: MAKING TESTS AND TRYING THINGS OUT<a class="headerlink" href="#114-test-def-making-tests-and-trying-things-out" title="Permanent link"></a></h2>
<p>Floyd has built-in features for writing unit tests. Tests are critical for making robust software. There are two syntactic features for testing: the test-def statement and the test function. The test-def statement registers one test in a global registry of tests but does not run it. There are detailed controls over running some or all tests via the command line.</p>
<p>Here is simple test where we test that Floyd&rsquo;s subset() function works in a specific scenario:</p>
<div class="codehilite"><pre>test-def (&quot;subset()&quot;, &quot;skip first character&quot;){ test( subset(&quot;abc&quot;, 1, 3), &quot;bc&quot; }
</pre></div>

<p>When this test is run, it will execute the test-call by first calling subset(), then comparing subset&rsquo;s output with &ldquo;bc&rdquo;. If it&rsquo;s not identical the test fails.</p>
<p>All unit tests are by default run everytime the program runs, just before main() or the Floyd processes start running.</p>
<p>When you use the Floyd command line tool you can control the tests:</p>
<p>The -u flag skips running the unit tests.</p>
<p><code>floyd run -t -u mygame.floyd</code></p>
<p>To run all unit tests, but not the program itself:</p>
<p><code>floyd test game.floyd</code></p>
<p>To run just specific unit tests, use:</p>
<p><code>floyd test game.floyd one two</code></p>
<p>To get a list of all unit tests:</p>
<p><code>floyd test -l game.floyd</code></p>
<h4 id="guidelines-for-testing">GUIDELINES FOR TESTING<a class="headerlink" href="#guidelines-for-testing" title="Permanent link"></a></h4>
<p>Each test should test <strong>one</strong> function and one scenario and <strong>prove</strong> it is correct in this scenario. You normally write a handful of tests for each function, each testing a specific scenario.</p>
<ol>
<li>The order of the tests are important: first prove the simplest scenario works, then a little more advanced scenario.</li>
<li>Each test proves exactly ONE scenario for the tested function. All other tests relies on this and builds on what&rsquo;s been proved already.</li>
<li>Never check the same things more than once</li>
<li>Put tests directly after the function-under-test in the source file.</li>
<li>Describe the scenario you are testing for and the expected result.</li>
<li>There must not be runtime dependencies between the tests &ndash; they may run in a different order or in parallell.</li>
</ol>
<p>Here is a typical function sek_to_string() and it&rsquo;s tests:</p>
<div class="codehilite"><pre>struct money_format_t {
    bool add_currency_tag
    bool skip_minor_if_zero
}

func money_format_t make_default_format(){
    return money_format_t(true, false)
}



struct sek_t {
    int kronor
    int oren
}

func string sek_to_string(money_format_t format, sek_t amount){
    assert(amount.oren &gt;= 0 &amp;&amp; amount.oren &lt; 100)

    let oren_signed = amount.kronor &gt;= 0 ? amount.oren : -amount.oren
    let v = amount.kronor * 100 + oren_signed

    let a = to_string(v)

    let r = format.add_currency_tag ? a + &quot; SEK&quot; : a
    return r
}


let max = get_max_sek_example()

test-def (&quot;sek_to_string()&quot;, &quot;zero&quot;)    {   test(   sek_to_string(make_default_format(), sek_t(0, 0)),          &quot;0:00 SEK&quot;  }
test-def (&quot;sek_to_string()&quot;, &quot;one&quot;)     {   test(   sek_to_string(make_default_format(), sek_t(1, 0)),          &quot;1:00 SEK&quot;  }
test-def (&quot;sek_to_string()&quot;, &quot;1 ore&quot;)   {   test(   sek_to_string(make_default_format(), sek_t(0, 1)),          &quot;0:01 SEK&quot;  }
test-def (&quot;sek_to_string()&quot;, &quot;99.99&quot;)   {   test(   sek_to_string(make_default_format(), max),                  &quot;99:99 SEK&quot; }

test-def (&quot;sek_to_string()&quot;, &quot;zero&quot;)    {   test(   sek_to_string(money_format_t(false, true), sek_t(0, 1)),    &quot;0:00&quot;      }
test-def (&quot;sek_to_string()&quot;, &quot;99.99&quot;)   {   test(   sek_to_string(money_format_t(false, true), max),            &quot;99:99&quot;     }
</pre></div>

<p>This is one of the few instances where it makes scense to align the columns so you can see clearly each call to sek_to_string() and the expected output &ndash; this makes it very simple to make sure you&rsquo;ve covered the important scenarios.</p>
<p>If you need setup code for your test - often called &ldquo;fixtures&rdquo; - you can make helper functions that you call from within your test-def, like make_default_format() above. If your fixture is expensive to computer you can make a a global instance of it&rsquo;s value and use it in may test-def:s, like &ldquo;max&rdquo; in the example above.</p>
<p>TIPS: If you aren&rsquo;t sure how a function works - one of yours or a FLoyd or library function &ndash; just put a small test that checks its behaviour right where you are working right now. This test is great documentation / reminder instead of making code comments.</p>
<p>TIPS: Add some tests that demonstrates your function. These are great documentation and copy-pasteable startig points for clients and they are <strong>guaranteed</strong> to be up to date and working, better than docs that often gets out of sync.</p>
<p>TIPS: If you are struggling with getting a function to work: use command line to only run tests for that function: this gives you super-fast iterations.</p>
<p><a id="115-json-and-automatic-serialization"></a></p>
<h2 id="115-json-and-automatic-serialization">1.15 JSON AND AUTOMATIC SERIALIZATION<a class="headerlink" href="#115-json-and-automatic-serialization" title="Permanent link"></a></h2>
<p>Serializing any Floyd value is a built-in mechanism. It is always true-deep.</p>
<blockquote>
<p><strong>This is very important in Floyd since values are central to Floyd&rsquo;s design. The JSON features allows any value to be easily passed around, sent as messages, stored in files, copy-pasted from log or debugger into the source code and so on.</strong></p>
</blockquote>
<p>There are built in functions for a floyd json to a JSON string and back. The JSON-string can be directly read or written to a text file, sent via a protocol and so on.</p>
<div class="codehilite"><pre>string generate_json_script(json v)
json parse_json_script(string s)
</pre></div>

<p>Converts any Floyd value, (including any type of nesting of custom structs, collections and primitives) into a json, storing enough info so the original Floyd value can be reconstructed at a later time from the json, using from_json().</p>
<div class="codehilite"><pre>json to_json(any v)
any from_json(json v, typeid target_type)
</pre></div>

<p>There is also direct support for JSON literals in your program source code, like this:</p>
<div class="codehilite"><pre>let json d = { &quot;pigcount&quot;: 3, &quot;pigcolor&quot;: &quot;pink&quot; }
</pre></div>

<div class="codehilite"><pre>let test_json2 = json(
    {
        &quot;one&quot;: 1,
        &quot;two&quot;: 2,
        &quot;three&quot;: &quot;three&quot;,
        &quot;four&quot;: [ 1, 2, 3, 4 ],
        &quot;five&quot;: { &quot;alpha&quot;: 1000, &quot;beta&quot;: 2000 },
        &quot;six&quot;: true,
        &quot;seven&quot;: false,
    }
)
</pre></div>

<p><a id="116-floyd-processes---talking-to-the-real-world"></a></p>
<h2 id="116-floyd-processes-talking-to-the-real-world">1.16 FLOYD PROCESSES - TALKING TO THE REAL WORLD<a class="headerlink" href="#116-floyd-processes-talking-to-the-real-world" title="Permanent link"></a></h2>
<p>Floyd processes is how you express the passing of time, updating state (mutation) and handling concurrency in Floyd. These concepts are tied together.</p>
<p>The goal with Floyd&rsquo;s concurrency model is:</p>
<ol>
<li>Built-in mechanisms for real-world concurrency need. Avoid general-purpose primitives.</li>
<li>Simple and robust.</li>
<li>Composable.</li>
<li>Allow you to make a <em>static design</em> of your program and its concurrency and state.</li>
<li>Separate out parallelism into a separate mechanism.</li>
<li>Avoid problematic constructs like threads, locks, callback hell, nested futures and await/async &ndash; dead ends of concurrency.</li>
<li>Let you control/tune how many threads and cores to use for what parts of the system, independently of the actual code.</li>
</ol>
<p>Inspirations for Floyd&rsquo;s concurrency model are CSP, Erlang, Go routines and channels and Clojure Core.Async.</p>
<p>Floyd processes lives inside a Floyd container and are very light weight. They are not the same as OS-processes. They <em>are</em> sandboxed from their sibling processes. They can be run in their own OS-threads or share OS-thread with other Floyd processes.</p>
<p>A process is defined by:</p>
<ol>
<li>
<p>a value <strong>M</strong> for its memory / state &ndash; usually a struct</p>
</li>
<li>
<p>an initialisation function that instantiates needed components and returns the initial state</p>
</li>
<li>
<p>a process function <strong>f</strong> that repeatedly handles messages. It can make impure calls, send messages to other processes and block for a long time. The process function ends each call by returning an updated version of its state - this is the only mutable memory in Floyd.</p>
</li>
<li>
<p>A message inbox.</p>
</li>
</ol>
<p><img alt="Floyd Process" src="/Users/marcus/Documents/GitHub/Floyd/docs/floyd_manual/floyd_process.png" /></p>
<p>Usually process functions are one-offs and not reusable, they are the glue that binds your program together.</p>
<p>Avoid having logic inside the process functions - move that logic to separate, pure functions.</p>
<p>Example process code:</p>
<div class="codehilite"><pre>struct my_gui_state_t {
    int _count
}

func my_gui_state_t my_gui__init(){
    send(&quot;a&quot;, &quot;dec&quot;)

    return my_gui_state_t(0 )
}

func my_gui_state_t my_gui(my_gui_state_t state, json message){
    if(message == &quot;inc&quot;){
        return update(state, _count, state._count + 1)
    }
    else if(message == &quot;dec&quot;){
        return update(state, _count, state._count - 1)
    }
    else{
        assert(false)
    }
}
</pre></div>

<table>
<thead>
<tr>
<th align="left">Part</th>
<th align="left">Details</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><strong>my_gui_state_t</strong></td>
<td align="left">this is a struct that holds the mutable memory of this process and any component instances needed by the container.</td>
</tr>
<tr>
<td align="left"><strong>my_gui()</strong></td>
<td align="left">this function is specified in the software-system/&rdquo;containers&rdquo;/&rdquo;my_iphone_app&rdquo;/&rdquo;clocks&rdquo;. The message is always a json. You can decide how to encode the message into that.</td>
</tr>
<tr>
<td align="left"><strong>my_gui__init()</strong></td>
<td align="left">this is the init function &ndash; it has the same name with &ldquo;__init&rdquo; at the end. It has no arguments and returns the initial state of the process.</td>
</tr>
</tbody>
</table>
<h5 id="processes-inbox-state-processing-function">PROCESSES: INBOX, STATE, PROCESSING FUNCTION<a class="headerlink" href="#processes-inbox-state-processing-function" title="Permanent link"></a></h5>
<p>For each independent mutable state and/or &ldquo;thread&rdquo; you want in your container, you need to insert a process. Processes are statically instantiated in a container &ndash; you cannot allocate them at runtime.</p>
<p>The process represents a little standalone program with its own call stack that listens to messages from other processes. When a process receives a message in its inbox, its function is called (now or some time later) with the message and the process&rsquo;s previous state. The process does some work - something simple or maybe call a big call tree or do blocking calls to the file system, and then it ends by returning its new state, which completes the message handling.</p>
<p><strong>The process feature is the only way to keep state in Floyd.</strong></p>
<p>Use a process if:</p>
<ol>
<li>You want to be able to run work concurrently, like loading data in the background</li>
<li>You want a mutable state / memory</li>
<li>You want to model a system where things happen concurrently, like audio streaming vs main thread</li>
</ol>
<p>The inbox is thread safe and it&rsquo;s THE way to communicate across processes. The inbox has these purposes:</p>
<ol>
<li>Allow process to <em>wait</em> for external messages using the select() call</li>
<li>Transform messages between different clock-bases &ndash; the inbox is thread safe</li>
<li>Allow buffering of messages, that is moving them in time</li>
</ol>
<p>You need to implement your process&rsquo;s processing function and define its mutable state. The processing function is impure. It can call OS-functions, block on writes to disk, use sockets etc. Each API you want to use needs to be passed as an argument into the processing function, it cannot go find them - or anything else.</p>
<p>Processes cannot change any other state than its own, they run in their own virtual address space.</p>
<p>When you send messages to other process you can block until you get a reply, get replies via your inbox or just don&rsquo;t use replies.</p>
<p>The process function CAN chose to have several select()-statements which makes it work as a small state machine.</p>
<p>Processes are very inexpensive.</p>
<p><strong>Synchronization points between systems (state or concurrent) always breaks all attempts to composition. That&rsquo;s why Floyd has moved these to top level of container.</strong></p>
<p>The runtime can choose to execute processes on different cores or servers. You have control over this via tweakers. Tweakers also controls the priority of processes vs hardware.</p>
<p>Floyd process limitations:</p>
<ul>
<li>Cannot find assets / ports / resources — those are handed to it via the container&rsquo;s wiring</li>
<li>Cannot be created or deleted at runtime</li>
<li>Cannot access any global state or other processes</li>
</ul>
<h5 id="synchronous-processes">SYNCHRONOUS PROCESSES<a class="headerlink" href="#synchronous-processes" title="Permanent link"></a></h5>
<p>If the processes are running on the same clock, the sequence of:</p>
<ul>
<li>process A posts message to process B</li>
<li>process B receives the message</li>
<li>process B processes the message</li>
<li>process B completes and updates its state</li>
<li>process A continues</li>
</ul>
<p>&hellip;is done synchronously without any scheduling or OS-level context switching - just like a function call from A to B.</p>
<p>You synchronise processes when it&rsquo;s important that the receiving process handles the messages <em>right away</em>. </p>
<p>Synced processes still have their own state and can be used as controllers / mediators.</p>
<p><a id="gain-performance-via-concurrency"></a></p>
<h3 id="gain-performance-via-concurrency">GAIN PERFORMANCE VIA CONCURRENCY<a class="headerlink" href="#gain-performance-via-concurrency" title="Permanent link"></a></h3>
<p>Sometimes we introduce concurrency to make more parallelism possible: multithreading a game engine is taking a non-concurrent design and making it concurrent to be able to improve throughput by running many tasks in parallel. This is different to using concurrency to model real-world concurrency like UI vs background cloud com vs real-time audio processing.</p>
<p><a id="concurrency-scenarios"></a></p>
<h3 id="concurrency-scenarios">CONCURRENCY SCENARIOS<a class="headerlink" href="#concurrency-scenarios" title="Permanent link"></a></h3>
<table>
<thead>
<tr>
<th>#</th>
<th>Need</th>
<th>Traditional</th>
<th>Floyd</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>Make a REST request</td>
<td>Block entire thread / nested callbacks / futures / async-await</td>
<td>Just block. Make call from process to keep caller running</td>
</tr>
<tr>
<td>2</td>
<td>Make a sequence of back and forth communication with a REST server</td>
<td>Make separate thread and block on each step then notify main thread on completion / nested futures or callbacks / await-async</td>
<td>Make a process that makes blocking calls</td>
</tr>
<tr>
<td>3</td>
<td>Perform non-blocking impure background calculation (auto save doc)</td>
<td>Copy document, create worker thread</td>
<td>Use process, use data directly</td>
</tr>
<tr>
<td>4</td>
<td>Run process concurrently, like analyze game world to prefetch assets</td>
<td>Manually synchronize all shared data, use separate thread</td>
<td>Use process &ndash; data is immutable</td>
</tr>
<tr>
<td>5</td>
<td>Handle requests from OS quickly, like call to audio buffer switch process()</td>
<td>Use callback function</td>
<td>Use process and set its clock to sync to clock of buffer switch</td>
</tr>
<tr>
<td>6</td>
<td>Improve performance using concurrency + parallelism / fan-in-fan-out / processing pipeline</td>
<td>Split work into small tasks that are independent, queue them to a thread team, resolve dependencies somehow, use end-fence with competition notification</td>
<td>call map() or map_dag() from a process.</td>
</tr>
<tr>
<td>7</td>
<td>Spread heavy work across time (do some processing each game frame)</td>
<td>Use coroutine or thread that sleeps after doing some work. Wake it next frame.</td>
<td>Process does work. It calls select() inside a loop to wait for next trigger to continue work.</td>
</tr>
<tr>
<td>8</td>
<td>Do work regularly, independent of other threads (like a timer interrupt)</td>
<td>Call timer with callback / make thread that sleeps on event</td>
<td>Use process that calls post_at_time(now() + 100) to itself</td>
</tr>
<tr>
<td>9</td>
<td>Small server</td>
<td>Write loop that listens to socket</td>
<td>Use process that waits for messages</td>
</tr>
</tbody>
</table>
<p><a id="example-simple-console-program"></a></p>
<h3 id="example-simple-console-program">EXAMPLE: SIMPLE CONSOLE PROGRAM<a class="headerlink" href="#example-simple-console-program" title="Permanent link"></a></h3>
<p>This is a basic command line app. It doesn&rsquo;t need a Floyd process at all, it&rsquo;s just a function. It gets its input values from the command line arguments, calls some pure Floyd functions on the arguments, reads and writes to the world, then finally return an integer result. </p>
<p><a id="example-pacman-iphone"></a></p>
<h3 id="example-pacman-iphone">EXAMPLE: PACMAN IPHONE<a class="headerlink" href="#example-pacman-iphone" title="Permanent link"></a></h3>
<p><img alt="Pacman" src="/Users/marcus/Documents/GitHub/Floyd/docs/floyd_manual/floyd_pacman.png" /></p>
<p>TODO: make example of <em>all</em> the diagrams, including Software System diagram.</p>
<p>A complex game will have many clocks, both to model concurrency and to allow parallelism. When simulation has been run, it can hand of a copy of the game world for renderer to work on in parallel.</p>
<ul>
<li>UI event loop clock</li>
<li>Prefetch assets clock</li>
<li>World-simulation / physics clock</li>
<li>Rendering pass 1 clock</li>
<li>Commit to OpenGL clock</li>
<li>Audio streaming clock</li>
</ul>
<p><a href="https://www.youtube.com/watch?v=v2Q_zHG3vqg">https://www.youtube.com/watch?v=v2Q_zHG3vqg</a></p>
<p><a id="117-system-architecture"></a></p>
<h2 id="117-system-architecture">1.17 SYSTEM ARCHITECTURE<a class="headerlink" href="#117-system-architecture" title="Permanent link"></a></h2>
<p>Floyd uses the C4 model to navigate and present your code and for its terminology. It&rsquo;s completely optional to use these features. They give you a very fast and lightweight way method to think about your system and to automatically generate a few great diagrams that helps you reason about it.</p>
<p>Read more here: <a href="https://c4model.com/">https://c4model.com/</a></p>
<p>The C4 diagrams lets you have a complete overview over your entire system and how users interact with it, then drill down to individual containers and further down to components and the code itself.</p>
<p>In Floyd you describe your system using the keywords <strong>software-system-def</strong> and <strong>container-def</strong>, which use C4 terminology.</p>
<p><img alt="Software Systems" src="/Users/marcus/Documents/GitHub/Floyd/docs/floyd_manual/floyd_systems_software_system.png" /></p>
<p><strong>PERSON</strong>: Represents various human users of your software system. They access the system through some sort of user interface. For example, a UI on an iPhone.</p>
<p><strong>SOFTWARE SYSTEM:</strong> This describes the entire software system you are building &ndash; something that delivers value to its users, whether they are human or not. It can be composed of many computers, servers and apps working together &ndash; or just one, like an iPhone app.</p>
<p><strong>CONTAINER:</strong> A container is a thing that needs to be running in order for the overall software system to work. A mobile app, a server-side web application, a client-side web application, a micro service.</p>
<p>A container is usually a single OS-process. It looks for resources and knows how to string things together inside the container, does its own processing of events and so forth, has its own state and handles runtimer errors. Sockets, file systems, concurrency, messages and screens are handled here.</p>
<p>A container&rsquo;s design is usually a one-off and not reusable.</p>
<p><img alt="" src="/Users/marcus/Documents/GitHub/Floyd/docs/floyd_manual/floyd_container_example.png" /></p>
<p>In Floyd, containers are defined using container-def, which lists the components it needs, which internal Floyd processes it runs and which impure Floyd functions that run those processes.</p>
<p><strong>COMPONENT:</strong> A component is the same as a library, package or module. It&rsquo;s a group of related features encapsulated behind a well-defined API. You can make your own components, use built-in component and get 3rd party components.</p>
<p>Examples: JPEG library, JSON lib. Custom component for syncing with your server. Amazon S3 library, socket library.</p>
<p><strong>CODE:</strong> These are the source files and functions that makes up a component.</p>
<p>Example software system statement:</p>
<div class="codehilite"><pre>software-system-def {
    &quot;name&quot;: &quot;My Arcade Game&quot;,
    &quot;desc&quot;: &quot;Space shooter for mobile devices with connection to a server.&quot;,

    &quot;people&quot;: {
        &quot;Gamer&quot;: &quot;Plays the game on one of the mobile apps&quot;,
        &quot;Curator&quot;: &quot;Updates achievements, competitions, make custom on-off maps&quot;,
        &quot;Admin&quot;: &quot;Keeps the system running&quot;
    },
    &quot;connections&quot;: [
        { &quot;source&quot;: &quot;Game&quot;, &quot;dest&quot;: &quot;iphone app&quot;, &quot;interaction&quot;: &quot;plays&quot;, &quot;tech&quot;: &quot;&quot; }
    ],
    &quot;containers&quot;: [
        &quot;gmail mail server&quot;,
        &quot;iphone app&quot;,
        &quot;Android app&quot;
    ]
}
</pre></div>

<p><a id="diagrams"></a></p>
<h3 id="diagrams">DIAGRAMS<a class="headerlink" href="#diagrams" title="Permanent link"></a></h3>
<h5 id="level-1-system-context-diagram">LEVEL 1 - SYSTEM CONTEXT DIAGRAM<a class="headerlink" href="#level-1-system-context-diagram" title="Permanent link"></a></h5>
<p><img alt="Level1" src="/Users/marcus/Documents/GitHub/Floyd/docs/floyd_manual/floyd_systems_level1_diagram.png" /></p>
<h5 id="level-2-container-diagram">LEVEL 2 - CONTAINER DIAGRAM<a class="headerlink" href="#level-2-container-diagram" title="Permanent link"></a></h5>
<p>Zooms into your software system and shows the different containers (apps) that makes up the system.</p>
<p>You can use a mix of your own custom containers and proxy-containers for things like Amazon S3 or an email server. They are all part of the diagram.</p>
<p><img alt="Level2" src="/Users/marcus/Documents/GitHub/Floyd/docs/floyd_manual/floyd_systems_level2_diagram.png" /></p>
<h5 id="level-3-component-diagram">LEVEL 3 - COMPONENT DIAGRAM<a class="headerlink" href="#level-3-component-diagram" title="Permanent link"></a></h5>
<p>This diagram zooms into an individual container to show the components inside.</p>
<p><img alt="Level3" src="/Users/marcus/Documents/GitHub/Floyd/docs/floyd_manual/floyd_systems_level3_diagram.png" /></p>
<h5 id="level-4-code-diagram">LEVEL 4 - CODE DIAGRAM<a class="headerlink" href="#level-4-code-diagram" title="Permanent link"></a></h5>
<p>Classes. Instance diagram. Examples. Passive. You often use a simple UML diagram here.</p>
<p><img alt="Level3" src="/Users/marcus/Documents/GitHub/Floyd/docs/floyd_manual/floyd_systems_level4_diagram.png" /></p>
<p>TODO: Make script that generates diagrams from software-system-def JSON.</p>
<p>TODO: support proxy software-systems
TODO: support connections between components inside containers.</p>
<p><a id="118-todo-exceptions"></a></p>
<h2 id="118-todo-exceptions">1.18 TODO: EXCEPTIONS<a class="headerlink" href="#118-todo-exceptions" title="Permanent link"></a></h2>
<p>Throw exception. Built in types, free noun. Refine, final.</p>
<p><a id="119-about-performance"></a></p>
<h2 id="119-about-performance">1.19 ABOUT PERFORMANCE<a class="headerlink" href="#119-about-performance" title="Permanent link"></a></h2>
<p>Chandler Carruth:</p>
<ul>
<li>
<p>EFFICIENCY: HOW MUCH WORK IS REQUIRED BY A TASK</p>
<ul>
<li>Improve by doing less work.</li>
<li>Better algorithms.</li>
</ul>
</li>
<li>
<p>PERFORMANCE: HOW QUICKLY A PROGRAM DOES ITS WORK.</p>
<ul>
<li>Do work faster. </li>
<li>Lighting up all the transistors.</li>
<li>Data structures</li>
</ul>
</li>
</ul>
<p><strong>EFFICIENCY WITH ALGORITHMS, PERFORMANCE WITH DATA STRUCTURES</strong></p>
<p>Floyd is designed to make it simple and practical to make big systems with performance better than what you get with average optimized C code.</p>
<p>It does this by splitting the design into two different concepts:</p>
<ol>
<li>
<p>Encourage your logic and processing code to be simple and correct and to declare where there is opportunity to execute code independently of each other. This type of code is ideal to run in parallel or cache etc, like a shader in a graphics API.</p>
</li>
<li>
<p>At the top level, profile execution and make high-level improvements that dramatically alter how the code is <em>generated</em> and executed to run on the available hardware. Caching, collection type selection, batching, parallelization, ordering work for different localities, memory layouts and access patterns.</p>
</li>
</ol>
<p>It is also simple to introduce more concurrency to create more opportunities to run computations in parallel.</p>
<p><img alt="" src="/Users/marcus/Documents/GitHub/Floyd/docs/floyd_manual/cpu_overview.png" /></p>
<p>TODO: Also draw computing power.
TOD: Fact check stats.</p>
<p><a id="120-micro-benchmarks"></a></p>
<h2 id="120-micro-benchmarks">1.20 MICRO BENCHMARKS<a class="headerlink" href="#120-micro-benchmarks" title="Permanent link"></a></h2>
<p><a id="about-micro-benchmarks"></a></p>
<h3 id="about-micro-benchmarks">ABOUT MICRO BENCHMARKS<a class="headerlink" href="#about-micro-benchmarks" title="Permanent link"></a></h3>
<p>Floyd is about engineering programs for fast execution. To aid in this, Floyd has built-in features to benchmark your code so you know the actual performance in a scientific away.</p>
<p>The benchmark features have been designed to:</p>
<ul>
<li>Give you a <em>built-in</em> and <em>simple</em> way to measure performance</li>
<li>Let you control which tests to run and when</li>
<li>Let you keep the tests next to the function under test </li>
<li>Let you control how to use the measurements, even from code.</li>
</ul>
<div class="codehilite"><pre>benchmark-def &quot;Linear veq 0&quot; {
    let dur = benchmark {
        let a = unpack_linear_veq(x)
    }
    return [ benchmark_result_t(dur, {}) ]
}
</pre></div>

<p>The snippet above measures how long the statement &ldquo;let a = unpack_linear_veq(x)&rdquo; takes to execute.</p>
<p>The Floyd micro benchmark features give you a simple way to measure the performance of a snippet of code on a specific computer and get statistics on how it performs for different data sets.</p>
<blockquote>
<p>NOTICE: Micro benchmarking is not the same as profiling with a profiler. Profiling is used on an entire program and helps you <em>find</em> hotspots. Micro benchmarking just looks at a small code snippet.</p>
</blockquote>
<p>You can add a micro benchmark anywhere in a source file (at the top level) using the <strong>benchmark-def statement</strong>. It&rsquo;s recommended your put your benchmark-defs right after the function it measures. The micro benchmarks are not automatically run, you need to request that, either from the floyd command line tool or via your own code. You are in control over which tests to run and can control how to present the output. You leave the micro benchmarks in your code. They can be stripped out when compiling.</p>
<p>To make the actual measurement you use the benchmark-expression which runs your code and measures the time.</p>
<blockquote>
<p>TERM <strong>benchmark</strong>: in Floyd benchmark means <strong>one explicitly defined task that performs the exact same code snippet every time over the exact same data</strong>.</p>
<p>TERM <strong>run</strong>: Floyd will run a benchmark many times to get better precision of the measurement. These are called &ldquo;runs&rdquo;. The number of runs is controlled by Floyd.</p>
<p>TERM <strong>benchmark instance</strong>: Often you want to benchmark code for several different sized data sets. Floyd allows you to make several <strong>benchmark instances</strong> from within same benchmark definition. This results in several measurements (you return several benchmark_result_t  values from your benchmark-def) but you only need to define one benchmark-def and it can share the same code and the same setup.</p>
</blockquote>
<p>BENCHMARK WITH 11 INSTANCES:</p>
<div class="codehilite"><pre>benchmark-def &quot;Linear veq&quot; {
    mutable [benchmark_result_t] results = []
    let instances = [ 0, 1, 2, 3, 4, 10, 20, 100, 1000, 10000, 100000 ]
    for(i in 0 ..&lt; size(instances)){
        let x = instances[i]
        mutable acc = 0

        let r = benchmark {
            //  The work to measure
            for(a in 0 ..&lt; x){
                acc = acc + 1
            }
        }
        results = push_back(results, benchmark_result_t(r, json( { &quot;Count&quot;: x } )))
    }
    return results
}
</pre></div>

<p>Floyd&rsquo;s design lets you make short benchmark-defs, it lets you add more data to the benchmarks and get new columns to the benchmark ouput, for example record bandwith and show in &ldquo;KB/s&rdquo; column. It lets you write benchmark-def that builds for example a big image, then runs a number of benchmark instances on that image. It lets you record custom data and make your own analysis of that data and output it as CSV data to examin in Excel and so on. Read more in the reference section.</p>
<p><a id="running-micro-benchmarks-from-command-line-tool"></a></p>
<h3 id="running-micro-benchmarks-from-command-line-tool">RUNNING MICRO BENCHMARKS FROM COMMAND LINE TOOL<a class="headerlink" href="#running-micro-benchmarks-from-command-line-tool" title="Permanent link"></a></h3>
<p>Run all micro benchmarks in your program mygame.floyd:</p>
<div class="codehilite"><pre>floyd bench mygame.floyd
</pre></div>

<p>This results in a print out something like this:</p>
<div class="codehilite"><pre>| MODULE  | TEST         |     DUR|                   | KB/S    | OUT SIZE  |
|---------|--------------|--------|-------------------|---------|-----------|
|         | pack_png()   | 1800 ns|                   | 670000  | 14014     |
|         | pack_png()   | 2023 ns| alpha             |         |           |
|         | pack_png()   | 2980 ns| null              |         |           |
|         | zip()        | 4030 ns|                   | 503000  | 12030     |
|         | zip()        | 5113 ns| alpha             |         |           |
|         | pack_jpeg()  | 2029 ns| [&quot;1024&quot;, &quot;1024&quot;]  |         |           |
</pre></div>

<p>Ususally you run one or two specific tests again and again while optimising. This is how you run specific tests:</p>
<div class="codehilite"><pre>floyd bench mygame.floyd &quot;Linear veq&quot; &quot;Smart tiling&quot; blur1 blur_b2
</pre></div>

<p>This will run 4 different benchmarks, called &ldquo;Linear veq&rdquo;, &ldquo;Smart tiling&rdquo;, &ldquo;blur1&rdquo; and blur_b2
The output will be formatted and sent to stdout.</p>
<p>Notive: when you run a benchmark, all/any of its instances are always run.</p>
<p>You can also list all benchmarks in your program:</p>
<div class="codehilite"><pre>floyd bench -l mygame.floyd
</pre></div>

<p>This prints something like this to standard output:</p>
<p><div class="codehilite"><pre>Benchmarks registry:
pack_png 1
pack_png 2
pack_png no compress
</pre></div>
This lets you first list all benchmark, filter out some of them, then run just those benchmarks.</p>
<p><a id="running-micro-benchmarks-from-floyd-code"></a></p>
<h3 id="running-micro-benchmarks-from-floyd-code">RUNNING MICRO BENCHMARKS FROM FLOYD CODE<a class="headerlink" href="#running-micro-benchmarks-from-floyd-code" title="Permanent link"></a></h3>
<p>This snippets runs all registered benchmarks, formats their output and prints to the terminal:</p>
<div class="codehilite"><pre>print(make_benchmark_report(run_benchmarks(get_benchmarks())))
</pre></div>

<p>You can write code that run only some benchmark and uses the output in some other way. There is a number of function in the standard library for working like this.</p>
<p><a id="hardware-caps"></a></p>
<h3 id="hardware-caps">HARDWARE CAPS<a class="headerlink" href="#hardware-caps" title="Permanent link"></a></h3>
<p>These built-in features lets you see what kind of CPU and memory system your program is currently running on. This is important when recording and understanding microbenchmark results.</p>
<p><div class="codehilite"><pre>[string: json] detect_hardware_caps()
</pre></div>
Output is something similar to this:</p>
<div class="codehilite"><pre>{
    &quot;availcpu&quot; : 0,
    &quot;bus_freq_hz&quot; : 100000000,
    &quot;byteorder&quot; : 1234,
    &quot;cacheline_size&quot; : 64,
    &quot;cpu_freq_hz&quot; : 4000000000,
    &quot;cpu_type&quot; : 7,
    &quot;cpu_type_subtype&quot; : 8,
    &quot;epoch&quot; : 0,
    &quot;floatingpoint&quot; : 0,
    &quot;l1_data_cache_size&quot; : 32768,
    &quot;l1_instruction_cache_size&quot; : 32768,
    &quot;l2_cache_size&quot; : 262144,
    &quot;l3_cache_size&quot; : 8388610,
    &quot;logical_processor_count&quot; : 8,
    &quot;machdep_cpu_brand_string&quot; : &quot;Intel(R) Core(TM) i7-4790K CPU @ 4.00GHz&quot;,
    &quot;machine&quot; : &quot;x86_64&quot;,
    &quot;machinearch&quot; : &quot;&quot;,
    &quot;mem_size&quot; : 17179900000,
    &quot;model&quot; : &quot;iMac15,1&quot;,
    &quot;ncpu&quot; : 8,
    &quot;packaged&quot; : 1,
    &quot;page_size&quot; : 4096,
    &quot;physical_processor_count&quot; : 4,
    &quot;physmem&quot; : 2147480000,
    &quot;scalar_align&quot; : 16,
    &quot;tbfrequency&quot; : 1000000000,
    &quot;usermem&quot; : 4214070000,
    &quot;vectorunit&quot; : 1
}
</pre></div>

<p>This is important information when understanding benchmark results and comparing benchmarks across different computers.</p>
<p>You can also request this using the command line tool:</p>
<div class="codehilite"><pre>floyd hwcaps
</pre></div>

<p>Prints something like this:</p>
<div class="codehilite"><pre>Intel(R) Core(TM) i7-4790K CPU @ 4.00GHz  16 GB DRAM  8 cores

PROCESSOR                                                     
--------------------------------------------------------------
Model          iMac15,1            ncpu                 8     
Machine        x86_64              Phys Processor Count 4     
CPU Freq       4 GHz                                          
CPU Type       7                   Vector unit          yes   
CPU Sub type   8                   Floatingpoint        no    

MEMORY                                                        
--------------------------------------------------------------
Bus freq       100 MHz             Page size            4 kB  
User mem       85860 kB            Scalar align         16 B  
Physical mem   2 GB                Byte order           1234  
Cacheline size 64 B                                           
L1 data        32 kB               L1 instructions      32 kB 
L2             256 kB              L3                   8 MB  
</pre></div>

<p><a id="121-about-parallelism"></a></p>
<h2 id="121-about-parallelism">1.21 ABOUT PARALLELISM<a class="headerlink" href="#121-about-parallelism" title="Permanent link"></a></h2>
<p>Parallelism is about finishing a task faster by using more of the available hardware.</p>
<p>In Floyd you parallelize your code by write the code so it expose where there are dependencies between computations and where there are not. Then you can orchestrate how to best execute your program from the top level &ndash; using tweak probes and profiling probes. This lets you control how the hardware is mapped to your logic.</p>
<p>Easy ways to expose parallelism is by writing pure functions (their results can be cached or precomputed) and by using functions like map(), fold(), filter() and map_dag(). These function work on individual elements of a collection and each computation is independent of the others. This lets the runtime process the different elements on parallel hardware.</p>
<p>The functions map() and map_dag() replaces FAN-IN-FAN-OUT-mechanisms.</p>
<p>map_dag() works like map(), but each element also has dependencies to other elements in the collection.</p>
<p>Accelerating computations (parallelism) is done using tweaks — a separate mechanism. It supports moving computations in time (lazy, eager, caching) and running work in parallel.</p>
<p>The optimizations using tweaks in no way affect the logic of your program, only the timing and order where those don&rsquo;t matter.</p>
<p><strong>Task</strong> - this is a work item that ideally takes 0.5 - 100 ms to execute and has an end. The runtime generates these when it wants to run map() elements in parallel. All tasks in the entire container are scheduled together.</p>
<p>Notice: map() and map_dag() shares threads with other mechanisms in the Floyd runtime. This mean that even if your tasks cannot be distributed to all execution units, other things going on can fill those execution gaps with other work.</p>
<p><a id="122-todo-probes"></a></p>
<h2 id="122-todo-probes">1.22 TODO: PROBES<a class="headerlink" href="#122-todo-probes" title="Permanent link"></a></h2>
<p>You add probes to wires, processes and individual functions and expressions. They gather intel on how your program runs on the hardware, let&rsquo;s you explore your running code and profile its hardware use.</p>
<p><a id="123-todo-tweakers"></a></p>
<h2 id="123-todo-tweakers">1.23 TODO: TWEAKERS<a class="headerlink" href="#123-todo-tweakers" title="Permanent link"></a></h2>
<p>Tweakers are inserted onto the wires and clocks and functions and expressions of the code and affect how the runtime and language executes that code, without changing its logic. Caching, batching, pre-calculation, parallelization, hardware allocation, collection-type selection are examples of what&rsquo;s possible.</p>
<p><img alt="" src="/Users/marcus/Documents/GitHub/Floyd/docs/floyd_manual/floyd_logo_banner.png" /></p>
<p><a id="2-floyd-language-reference-manual"></a></p>
<h1 id="2-floyd-language-reference-manual">2 FLOYD LANGUAGE REFERENCE MANUAL<a class="headerlink" href="#2-floyd-language-reference-manual" title="Permanent link"></a></h1>
<p><a id="21-source-code-files"></a></p>
<h2 id="21-source-code-files">2.1 SOURCE CODE FILES<a class="headerlink" href="#21-source-code-files" title="Permanent link"></a></h2>
<p>Floyd files are always utf-8 files with no BOM. Their extension is &ldquo;.floyd&rdquo;.</p>
<p><a id="22-main--executing-programs"></a></p>
<h2 id="22-main-executing-programs">2.2 MAIN() &amp; EXECUTING PROGRAMS<a class="headerlink" href="#22-main-executing-programs" title="Permanent link"></a></h2>
<p>These are the steps used by the Floyd runtime to executing a Floyd program that has a main() function</p>
<ol>
<li>Main thread initialises all globals and constants</li>
<li>Main thread executes all global statements </li>
<li>Main thread runs unit tests, if requested</li>
<li>Main thread calls main()</li>
<li>When main() returns, the runtime is taken down and the OS executable is exited</li>
</ol>
<p>These are the steps used by the Floyd runtime to executing a Floyd program that has no main() function</p>
<ol>
<li>Main thread initialises all globals and constants</li>
<li>Main thread executes all global statements </li>
<li>Main thread runs unit tests, if requested</li>
<li>Main thread starts all floyd processes in separate threads. How they execute is undefined here but under your control</li>
<li>When all floyd processes have exited, the runtime is taken down and the OS executable is exited.</li>
</ol>
<p>A Floyd program either has a main() function or processes.</p>
<p>Main-function with no command line arguments:</p>
<div class="codehilite"><pre>int main(){ }
</pre></div>

<p>Main-function that receives a vector of command line arguments:</p>
<div class="codehilite"><pre>int main([string] args){ }
</pre></div>

<p>Example:</p>
<div class="codehilite"><pre>func int main([string] args){
    print(args)
    assert(args == [&quot;-a&quot;, &quot;output.txt&quot;])

    return 42
}
</pre></div>

<blockquote>
<p>floyd run my_program.floyd -a output.txt</p>
</blockquote>
<p>&hellip;will call your main() function with [&ldquo;-a&rdquo;, &ldquo;output.txt&rdquo;] and your executable will return 42.</p>
<p><a id="23-compiler-intrinsics"></a></p>
<h2 id="23-compiler-intrinsics">2.3 COMPILER INTRINSICS<a class="headerlink" href="#23-compiler-intrinsics" title="Permanent link"></a></h2>
<p>These functions are built into the language itself and are always available to your code. They are all pure unless except print() and send(). The have special code generation algorithms. Many of these functions are generic &ndash; they work on many different types.</p>
<p><strong>COMPLETE LIST OF INTRINSICS:</strong></p>
<table>
<thead>
<tr>
<th align="left">INTRINSICS: BASICS</th>
<th align="left">USE</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">print() &ndash; IMPURE</td>
<td align="left">Prints a value to standard output</td>
</tr>
<tr>
<td align="left">send() &ndash; IMPURE</td>
<td align="left">Posts a message to a process</td>
</tr>
<tr>
<td align="left">assert()</td>
<td align="left">Halts program on false</td>
</tr>
<tr>
<td align="left">to_string()</td>
<td align="left">Converts any value to a string</td>
</tr>
<tr>
<td align="left">to_pretty_string()</td>
<td align="left">Converts value to an exploded multi-line string</td>
</tr>
<tr>
<td align="left">typeof()</td>
<td align="left">Return the type of its input value</td>
</tr>
<tr>
<td align="left">probe()</td>
<td align="left">TODO: Expose variable to test and performance tools</td>
</tr>
<tr>
<td align="left">select()</td>
<td align="left">TODO: Called from a process function to read its inbox. It will block until a message is received or it times out</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th align="left">INTRINSICS: FOR SOME TYPES ONLY</th>
<th align="left">USE</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">update()</td>
<td align="left">Replace an element in a vector, string, dictionary or struct</td>
</tr>
<tr>
<td align="left">size()</td>
<td align="left">Returns number of elements in a collection or string</td>
</tr>
<tr>
<td align="left">find()</td>
<td align="left">Find index of value in a vector or string</td>
</tr>
<tr>
<td align="left">exists()</td>
<td align="left">Check if key exists in dictionary</td>
</tr>
<tr>
<td align="left">erase()</td>
<td align="left">Erase value in dictionary</td>
</tr>
<tr>
<td align="left">get_keys()</td>
<td align="left">Get all keys of dictionary</td>
</tr>
<tr>
<td align="left">push_back()</td>
<td align="left">Append an element to a vector or string</td>
</tr>
<tr>
<td align="left">subset()</td>
<td align="left">Extract range of elements from vector or string</td>
</tr>
<tr>
<td align="left">replace()</td>
<td align="left">Replace range of elements from vector or string</td>
</tr>
<tr>
<td align="left">map()</td>
<td align="left">Perform operation on every element of a vector</td>
</tr>
<tr>
<td align="left">map_dag()</td>
<td align="left">Perform operation on every element of a vector, where elements have dependencies</td>
</tr>
<tr>
<td align="left">filter()</td>
<td align="left">Remove some elements from vector, based on expression</td>
</tr>
<tr>
<td align="left">reduce()</td>
<td align="left">Accumulate all vector elements into a new value</td>
</tr>
<tr>
<td align="left">stable_sort()</td>
<td align="left">Sort vector</td>
</tr>
<tr>
<td align="left">get_json_type()</td>
<td align="left">Get which value sits in a json value. It can be one of the 8 types supported by JSON</td>
</tr>
<tr>
<td align="left">generate_json_script()</td>
<td align="left">Convert json value to a JSON-compatible string</td>
</tr>
<tr>
<td align="left">parse_json_script()</td>
<td align="left">Parse a JSON string and create a json-value</td>
</tr>
<tr>
<td align="left">json to_json(any)</td>
<td align="left">Convert any Floyd value to a json-value</td>
</tr>
<tr>
<td align="left">from_json()</td>
<td align="left">Convert a json-value to a specific Floyd type</td>
</tr>
<tr>
<td align="left">bw_not()</td>
<td align="left">Bitwise not operation</td>
</tr>
<tr>
<td align="left">bw_and()</td>
<td align="left">Bitwise and operation</td>
</tr>
<tr>
<td align="left">bw_or()</td>
<td align="left">Bitwise or operation</td>
</tr>
<tr>
<td align="left">bw_xor()</td>
<td align="left">Bitwise xor operation</td>
</tr>
<tr>
<td align="left">bw_shift_left()</td>
<td align="left">Bitwise shift left</td>
</tr>
<tr>
<td align="left">bw_shift_right()</td>
<td align="left">Bitwise shift right (logical)</td>
</tr>
<tr>
<td align="left">bw_shift_right_arithmetic()</td>
<td align="left">Bitwise shift right with sign extension for signed values</td>
</tr>
</tbody>
</table>
<p><a id="print----impure"></a></p>
<h4 id="print-impure">print() &ndash; IMPURE<a class="headerlink" href="#print-impure" title="Permanent link"></a></h4>
<p>This outputs text to the default output of the application. It can print any type of value. If you want to compose output of many parts you need to convert them to strings and add them. Also works with types, like a struct-type.</p>
<p>Does not automatically add newlines, you always needs to add those explicitly. This means print(&ldquo;hel&rdquo;) print(&ldquo;lo&rdquo;) print the same thing as print(&ldquo;hello&rdquo;).
<div class="codehilite"><pre>print(any)
</pre></div></p>
<table>
<thead>
<tr>
<th>Example</th>
<th>Result</th>
</tr>
</thead>
<tbody>
<tr>
<td>print(3)</td>
<td>3</td>
</tr>
<tr>
<td>print(&ldquo;shark&rdquo;)</td>
<td>shark</td>
</tr>
<tr>
<td>print(&ldquo;Number four: &rdquo; + to_string(4))</td>
<td>Number four: 4</td>
</tr>
<tr>
<td>print(int)</td>
<td>int</td>
</tr>
<tr>
<td>print([int])</td>
<td>[int]</td>
</tr>
<tr>
<td double="double" string:="string:">print(</td>
<td string:double="string:double"></td>
</tr>
<tr>
<td>print([7, 8, 9])</td>
<td>[7, 8, 9]</td>
</tr>
<tr>
<td 1="1" _a_:="&quot;a&quot;:">print(</td>
<td 1="1" _a_:="&quot;a&quot;:"></td>
</tr>
<tr>
<td>print(json(&ldquo;b&rdquo;))</td>
<td>b</td>
</tr>
<tr>
<td>print(json(5.3))</td>
<td>5.3</td>
</tr>
<tr>
<td -1="-1" 0_="0," _x_:="&quot;x&quot;:" _y_:="&quot;y&quot;:">print(json(</td>
<td -1="-1" 0_="0," _a_:="&quot;a&quot;:" _b_:="&quot;b&quot;:"></td>
</tr>
<tr>
<td>print(json([&ldquo;q&rdquo;, &ldquo;u&rdquo;, &ldquo;v&rdquo;]))</td>
<td>[&ldquo;q&rdquo;, &ldquo;u&rdquo;, &ldquo;v&rdquo;]</td>
</tr>
<tr>
<td>print(json(true))</td>
<td>true</td>
</tr>
<tr>
<td>print(json(false))</td>
<td>false</td>
</tr>
<tr>
<td>print(json(null))</td>
<td>null</td>
</tr>
</tbody>
</table>
<p><a id="send----impure"></a></p>
<h4 id="send-impure">send() &ndash; IMPURE<a class="headerlink" href="#send-impure" title="Permanent link"></a></h4>
<p>Sends a message to the inbox of a Floyd process, possibly your own process.</p>
<p>The process may run on a different OS thread but send() is guaranteed to be thread safe.</p>
<div class="codehilite"><pre>send(string process_key, json message) impure
</pre></div>


<p>The send function returns immediately.</p>
<p><a id="assert"></a></p>
<h4 id="assert">assert()<a class="headerlink" href="#assert" title="Permanent link"></a></h4>
<p>Used this to check your code for programming errors, and check the inputs of your function for misuse by its callers.</p>
<div class="codehilite"><pre>assert(bool)
</pre></div>

<p>If the expression evaluates to false, the program will log to the output, then be aborted via an exception.</p>
<p>Example:</p>
<div class="codehilite"><pre>func f(int x){
    assert(x &gt;= 0)
}
</pre></div>

<p><a id="to_string"></a></p>
<h4 id="to_string">to_string()<a class="headerlink" href="#to_string" title="Permanent link"></a></h4>
<p>Converts its input to a string. This works with any type of values. It also works with types themselves, which is useful for debugging.</p>
<div class="codehilite"><pre>string to_string(any)
</pre></div>

<p>You often use this function to convert numbers to strings.</p>
<p><a id="toprettystring"></a></p>
<h4 id="to95pretty95string">to_pretty_string()<a class="headerlink" href="#to95pretty95string" title="Permanent link"></a></h4>
<p>Converts its input to a string of JSON data that is formatted nicely with indentations. It works with any Floyd value.</p>
<p><a id="typeof"></a></p>
<h4 id="typeof">typeof()<a class="headerlink" href="#typeof" title="Permanent link"></a></h4>
<p>Return the type of its input value. The returned typeid-value is a complete Floyd type and can be stored, compared and so on. The type is resolved at compile time so the same source code line will always return the same type. </p>
<div class="codehilite"><pre>typeid typeof(any)
</pre></div>

<p><a id="24-data-types"></a></p>
<h2 id="24-data-types">2.4 DATA TYPES<a class="headerlink" href="#24-data-types" title="Permanent link"></a></h2>
<p>These are the data types built into the language itself:</p>
<table>
<thead>
<tr>
<th align="left">TYPE</th>
<th align="left">USE</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><strong>bool</strong></td>
<td align="left"><strong>true</strong> or <strong>false</strong></td>
</tr>
<tr>
<td align="left"><strong>int</strong></td>
<td align="left">Signed 64 bit integer</td>
</tr>
<tr>
<td align="left"><strong>double</strong></td>
<td align="left">64-bit floating point number</td>
</tr>
<tr>
<td align="left"><strong>string</strong></td>
<td align="left">Built-in string type. 8-bit pure (supports embedded zeros). Use for machine strings, basic UI. Not localizable. Typically used for Windows Latin1, UTF-8 or ASCII.</td>
</tr>
<tr>
<td align="left"><strong>typeid</strong></td>
<td align="left">Describes the <em>type</em> of a value.</td>
</tr>
<tr>
<td align="left"><strong>function</strong></td>
<td align="left">A function value. Functions can be Floyd functions or C functions. They are callable.</td>
</tr>
<tr>
<td align="left"><strong>struct</strong></td>
<td align="left">Like C struct or classes or tuples. A value object.</td>
</tr>
<tr>
<td align="left"><strong>vector</strong></td>
<td align="left">A continuous array of elements addressed via indexes.</td>
</tr>
<tr>
<td align="left"><strong>dictionary</strong></td>
<td align="left">Lookup values using string keys.</td>
</tr>
<tr>
<td align="left"><strong>json</strong></td>
<td align="left">A value that holds a JSON-compatible value, can be a big JSON tree.</td>
</tr>
<tr>
<td align="left"><strong>protocol</strong></td>
<td align="left"><strong>TODO:</strong> A value that holds a number of callable functions. Also called interface or abstract base class.</td>
</tr>
<tr>
<td align="left"><strong>sum-type</strong></td>
<td align="left"><strong>TODO:</strong> Tagged union</td>
</tr>
<tr>
<td align="left"><strong>float</strong></td>
<td align="left"><strong>TODO:</strong> 32-bit floating point number</td>
</tr>
<tr>
<td align="left"><strong>int8</strong></td>
<td align="left"><strong>TODO:</strong> 8-bit signed integer</td>
</tr>
<tr>
<td align="left"><strong>int16</strong></td>
<td align="left"><strong>TODO:</strong> 16-bit signed integer</td>
</tr>
<tr>
<td align="left"><strong>int32</strong></td>
<td align="left"><strong>TODO:</strong> 32-bit signed integer</td>
</tr>
</tbody>
</table>
<p><a id="example-type-declarations"></a></p>
<h3 id="example-type-declarations">EXAMPLE TYPE DECLARATIONS<a class="headerlink" href="#example-type-declarations" title="Permanent link"></a></h3>
<table>
<thead>
<tr>
<th align="left">SOURCE</th>
<th align="left">MEANING</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">bool</td>
<td align="left">Bool type: <strong>true</strong> or <strong>false</strong></td>
</tr>
<tr>
<td align="left">int</td>
<td align="left">Int type</td>
</tr>
<tr>
<td align="left">string</td>
<td align="left">String type</td>
</tr>
<tr>
<td align="left">[int]</td>
<td align="left">Vector of ints</td>
</tr>
<tr>
<td align="left"><a class="wikilink" href="/int/">int</a></td>
<td align="left">Vector of int-vectors</td>
</tr>
<tr>
<td align="left">[string:int]</td>
<td align="left">Dictionary of ints</td>
</tr>
<tr>
<td align="left">func int ()</td>
<td align="left">Function returning int, no arguments</td>
</tr>
<tr>
<td align="left">func int (double a, string b)</td>
<td align="left">Function returning int, arguments are double and string</td>
</tr>
<tr>
<td align="left">[func int (double a, string b)]</td>
<td align="left">vector of functions, were functions return int and takes double and string arg.</td>
</tr>
<tr>
<td align="left">func int (double a) ()</td>
<td align="left">Function A with no arguments that returns a function B. B returns int and has a double argument.</td>
</tr>
<tr>
<td align="left">my_global</td>
<td align="left">name of custom type</td>
</tr>
<tr>
<td align="left">[my_global]</td>
<td align="left">vector of custom type</td>
</tr>
<tr>
<td align="left">func mything (mything a, mything b)</td>
<td align="left">function returning mything-type, with two mything arguments</td>
</tr>
<tr>
<td align="left">func bool (int (double a) b)</td>
<td align="left">function returns bool and takes an argument of type: function that returns in and take double-argument.</td>
</tr>
</tbody>
</table>
<p><a id="bool"></a></p>
<h3 id="bool">BOOL<a class="headerlink" href="#bool" title="Permanent link"></a></h3>
<p>The bool type in Floyd can only be true or false.</p>
<p><div class="codehilite"><pre>let a = false
assert(a == false)
assert(a != true)
</pre></div>
You can use it to store flags. It is also the output of all comparison operators.</p>
<p><a id="int"></a></p>
<h3 id="int">INT<a class="headerlink" href="#int" title="Permanent link"></a></h3>
<p>Floyd integers are 64 bit signed. All normal expressions and comparisons work on them, like + - and so on.</p>
<p>Here we make a new variable containing an integer:</p>
<div class="codehilite"><pre>let a = 1003
</pre></div>

<p>The &ldquo;1003&rdquo; above is an integer literal. There are several ways you can type an integer literal:</p>
<ul>
<li>decimal number</li>
<li>hexadecimal</li>
<li>binary number</li>
<li>an ASCII character, including escape code (see string literal section)</li>
</ul>
<p>Example: ASCII character
<div class="codehilite"><pre>let b =&#39;X&#39;

assert(b == 88) // 88 is the ASCII code for uppercase A.
</pre></div></p>
<p>Hexadecimal integer literals</p>
<table>
<thead>
<tr>
<th align="left">CODE</th>
<th align="left">EXPLANATION</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">0x0</td>
<td align="left">Hexadecimal number 0, decimal 0</td>
</tr>
<tr>
<td align="left">0xff</td>
<td align="left">Hexadecimal number FF, decimal 255</td>
</tr>
<tr>
<td align="left">0xabcd</td>
<td align="left">Hexadecimal number ABCD, decimal 43981</td>
</tr>
<tr>
<td align="left">0xffff1111</td>
<td align="left">Hexadecimal number FFFF1111, decimal 4294906129</td>
</tr>
</tbody>
</table>
<p>Binary integer literals:</p>
<table>
<thead>
<tr>
<th align="left">CODE</th>
<th align="left">EXPLANATION</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">0b000</td>
<td align="left">Binary number 000, decimal 0</td>
</tr>
<tr>
<td align="left">0b00000000</td>
<td align="left">Binary number 00000000, decimal 0</td>
</tr>
<tr>
<td align="left">0b00000001</td>
<td align="left">Binary number 00000001, decimal 1</td>
</tr>
<tr>
<td align="left">0b10000000</td>
<td align="left">Binary number 10000000, decimal 128</td>
</tr>
<tr>
<td align="left">0b11111111</td>
<td align="left">Binary number 11111111, decimal 255</td>
</tr>
<tr>
<td align="left">0b11111111000000000000000011111111</td>
<td align="left">Binary number 11111111000000000000000011111111, decimal 4278190335</td>
</tr>
</tbody>
</table>
<p><strong>Divider:</strong> you can use the &lsquo; character as a divider between groups of 8 number for both hex and binary literals (but not for decimal literals). This makes longer sequences of numbers easier to read.</p>
<table>
<thead>
<tr>
<th align="left">CODE</th>
<th align="left">EXPLANATION</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">0xffff1111&lsquo;00000000&lsquo;00000fff&rsquo;fff00000</td>
<td align="left">Hexadecimal number with separators</td>
</tr>
<tr>
<td align="left">0b11111111&lsquo;00000000&lsquo;00000000&lsquo;11111111</td>
<td align="left">Binary number with separators</td>
</tr>
</tbody>
</table>
<h4 id="bitwise-operators">BITWISE OPERATORS<a class="headerlink" href="#bitwise-operators" title="Permanent link"></a></h4>
<p>Notice that floyd has no special operator syntax for bitwise operations the way C has. Instead Floyd has explicitly named intrinsics for these operations. This:</p>
<p>1) allows us to have more and more specific operators, like several types of shift operations
2) avoid accidentally mixing &amp;&amp; with &amp;.
3) forces explicit evaluation order</p>
<p>They are real operators and translate to machine instructions, they just don&rsquo;t have any special syntax in the language.</p>
<table>
<thead>
<tr>
<th align="left">OPERATOR</th>
<th align="left">EXPLANATION</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">int bw_not(int v)</td>
<td align="left">inverts all bits in the integer v.</td>
</tr>
<tr>
<td align="left">int bw_and(int a, int b)</td>
<td align="left">and:s each bit in a with the corresponding bit in b</td>
</tr>
<tr>
<td align="left">int bw_or(int a, int b)</td>
<td align="left">or:s each bit in a with the corresponding bit in b</td>
</tr>
<tr>
<td align="left">int bw_xor(int a, int b)</td>
<td align="left">xor:s each bit in a with the corresponding bit in b</td>
</tr>
<tr>
<td align="left">int bw_shift_left(int v, int count)</td>
<td align="left">shifts the bits in v left, the number of bits specified by count. New bits are set to 0.</td>
</tr>
<tr>
<td align="left">int bw_shift_right(int v, int count)</td>
<td align="left">shifts the bits in v right, the number of bits specified by count. New bits are set to 0.</td>
</tr>
<tr>
<td align="left">int bw_shift_right_arithmetic(int v, int count)</td>
<td align="left">shifts the bits in v right, the number of bits specified by count. New bits are copied from bit 63, which sign-extends the number</td>
</tr>
</tbody>
</table>
<p>When doing bitwise manipulation it is often convenient to use binary literals or hexadecimal literals, rather than normal decimal literals.</p>
<p><a id="double"></a></p>
<h3 id="double">DOUBLE<a class="headerlink" href="#double" title="Permanent link"></a></h3>
<p>This is a 64 bit floating point number. It&rsquo;s literals looks like this:</p>
<p><div class="codehilite"><pre>let a = 3.14
</pre></div>
You need to include the &ldquo;.&rdquo; or the literal will be interpreted as an integer.</p>
<p><a id="string"></a></p>
<h3 id="string">STRING<a class="headerlink" href="#string" title="Permanent link"></a></h3>
<p>This is a pure 8-bit string type. It is immutable. The encoding of the characters in the string is undefined. You can put 7-bit ASCII in them or UTF-8 or something else. You can also use them as fast arrays of bytes. When you access individual elements in the string you use the int-type, which is a 64 bit signed type. There is no equivalent to C-lang &ldquo;char&rdquo; type.</p>
<p>Here we make a simple string:</p>
<div class="codehilite"><pre>let a = &quot;hello, world!&quot;
</pre></div>

<p>You need to wrap string literals in quote characters. Some characters cannot be entered directly into string literals - you need to use special trick, called an escape sequence. You can use these escape characters inside string literals by entering \n or ' or " etc.</p>
<table>
<thead>
<tr>
<th align="left">ESCAPE SEQUENCE</th>
<th align="left">RESULT CHAR, AS HEX</th>
<th align="left">ASCII MEANING</th>
<th align="left">JSON</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">\0</td>
<td align="left">0x00</td>
<td align="left">ZERO</td>
<td align="left">NO</td>
</tr>
<tr>
<td align="left">\a</td>
<td align="left">0x07</td>
<td align="left">BEL, bell, alarm, \a</td>
<td align="left">NO</td>
</tr>
<tr>
<td align="left">\b</td>
<td align="left">0x08</td>
<td align="left">BS, backspace, \b</td>
<td align="left">YES</td>
</tr>
<tr>
<td align="left">\f</td>
<td align="left">0x0c</td>
<td align="left">FF, NP, form feed, \f</td>
<td align="left">NO</td>
</tr>
<tr>
<td align="left">\n</td>
<td align="left">0x0a</td>
<td align="left">Newline (Line Feed)</td>
<td align="left">YES</td>
</tr>
<tr>
<td align="left">\r</td>
<td align="left">0x0d</td>
<td align="left">Carriage Return</td>
<td align="left">YES</td>
</tr>
<tr>
<td align="left">\t</td>
<td align="left">0x09</td>
<td align="left">Horizontal Tab</td>
<td align="left">YES</td>
</tr>
<tr>
<td align="left">\v</td>
<td align="left">0x0b</td>
<td align="left">Vertical Tab</td>
<td align="left">NO</td>
</tr>
<tr>
<td align="left">\\</td>
<td align="left">0x5c</td>
<td align="left">Backslash</td>
<td align="left">YES</td>
</tr>
<tr>
<td align="left">\&lsquo;</td>
<td align="left">0x27</td>
<td align="left">Single quotation mark</td>
<td align="left">NO</td>
</tr>
<tr>
<td align="left">\&ldquo;</td>
<td align="left">0x22</td>
<td align="left">Double quotation mark</td>
<td align="left">YES</td>
</tr>
<tr>
<td align="left">\/</td>
<td align="left">0x2f</td>
<td align="left">Forward slash</td>
<td align="left">YES</td>
</tr>
</tbody>
</table>
<p>Notice: Floyd string literals do not support insert hex sequences or Unicode code points.</p>
<p>Example: escape sequences</p>
<div class="codehilite"><pre>print(&quot;hello&quot;) //   Prints: hello

print(&quot;What does \\&quot;blob\\&quot; mean?&quot;) //  Prints: What does &quot;blob&quot; mean?
</pre></div>

<p>You can access a random character in the string, using its integer position, where element 0 is the first character, 1 the second etc.</p>
<div class="codehilite"><pre>let a = &quot;Hello&quot;[1]
assert(a == &quot;e&quot;)
</pre></div>

<p>Notice 1: You cannot modify the string using [], only read. Use update() to change a character.
Notice 2: Floyd returns the character as an int, which is 64 bit signed.</p>
<table>
<thead>
<tr>
<th align="left">FEATURE</th>
<th align="left">SIGNATURE</th>
<th align="left">DESCRIPTION</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">[]</td>
<td align="left">int s[int index]</td>
<td align="left">Lookup element in the string sand return it</td>
</tr>
<tr>
<td align="left">&lt;     &gt;   &lt;=  &gt;=  ==  !=</td>
<td align="left"></td>
<td align="left">Compares strings, element by element</td>
</tr>
<tr>
<td align="left">+</td>
<td align="left"></td>
<td align="left">Concatunates two strings</td>
</tr>
<tr>
<td align="left">update()</td>
<td align="left">string update(string s, int index, int new_element)</td>
<td align="left">Changes one element of the string and returns a new string</td>
</tr>
<tr>
<td align="left">size()</td>
<td align="left">int size(string s)</td>
<td align="left">Return the number of elements in the string. Returns 0 if the string is empty</td>
</tr>
<tr>
<td align="left">find()</td>
<td align="left">int find(string s, int element)</td>
<td align="left">Returns the index of the first occurance of element, -1 if none found</td>
</tr>
<tr>
<td align="left">push_back()</td>
<td align="left">string push_back(string s, int element)</td>
<td align="left">Returns a new string where the element is appended last</td>
</tr>
<tr>
<td align="left">subset()</td>
<td align="left">string subset(string s, int start, int end)</td>
<td align="left">This returns a new string with a range of elements from the collection. Both start and end are clipped to be 0 to size(s). In other languages this function is called substr()</td>
</tr>
<tr>
<td align="left">replace()</td>
<td align="left">string replace(string s, int start, int end, string new)</td>
<td align="left">Replace the range start to end in the string s with the contents of new. Both start and end are clipped to be 0 to size(s). Can also be used to erase or insert</td>
</tr>
</tbody>
</table>
<p>Example: size()</p>
<div class="codehilite"><pre>assert(size(&quot;hello&quot;) == 5)
</pre></div>

<p>Example: find()</p>
<div class="codehilite"><pre>assert(find(&quot;hello&quot;, &quot;o&quot;) == 4)
assert(find(&quot;hello&quot;, &quot;x&quot;) == -1)
</pre></div>

<p>Example: replace()</p>
<div class="codehilite"><pre>assert(replace(&quot;hello&quot;, 0, 2, &quot;bori&quot;) == borillo)
</pre></div>

<p>Example: subset()</p>
<div class="codehilite"><pre>assert(subset(&quot;hello&quot;, 2, 4) == &quot;ll&quot;)
</pre></div>

<p>Example: update()</p>
<div class="codehilite"><pre>assert(update(&quot;hello&quot;, 3, &#39;x&#39;) == &quot;helxo&quot;)
</pre></div>

<p>Example: push_back()</p>
<div class="codehilite"><pre>assert(push_back(&quot;hello&quot;, &#39;x&#39;) == hellox)
</pre></div>

<p><a id="vector"></a></p>
<h3 id="vector">VECTOR<a class="headerlink" href="#vector" title="Permanent link"></a></h3>
<p>A vector is a collection of values where you look up the values using an index between 0 and (vector size - 1). Finding an element at an index uses constant time.</p>
<p>You can make a new vector and specify its elements directly, like this:</p>
<div class="codehilite"><pre>let a = [ 1, 2, 3]
</pre></div>

<p>This is called the vector constructor. It lets you create a new vector value anywhere an expression can be put. This expression supports non-constant elements of the constructor.</p>
<p>Notice: You cannot modify the vector using [], only read. Use update() to change an element.</p>
<p>You can append two vectors together using the + operation.</p>
<table>
<thead>
<tr>
<th align="left">FEATURE</th>
<th align="left">SIGNATURE</th>
<th align="left">DESCRIPTION</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">[]</td>
<td align="left">ELEMENT s[int index]</td>
<td align="left">Lookup element in vector s and return it</td>
</tr>
<tr>
<td align="left">&lt;     &gt;   &lt;=  &gt;=  ==  !=</td>
<td align="left"></td>
<td align="left">Compares vectors, element by element</td>
</tr>
<tr>
<td align="left">+</td>
<td align="left"></td>
<td align="left">Concatunates two vectors of the same type</td>
</tr>
<tr>
<td align="left">update()</td>
<td align="left">VECTOR update(VECTOR s, int index, ELEMENT new_element)</td>
<td align="left">Changes one element of the vector and returns a new vector</td>
</tr>
<tr>
<td align="left">size()</td>
<td align="left">int size(VECTOR s)</td>
<td align="left">Returns the number of elements in the vector. Returns 0 if the vector is empty</td>
</tr>
<tr>
<td align="left">find()</td>
<td align="left">int find(VECTOR s, ELEMENT element)</td>
<td align="left">Returns the index of the first occurance of element, -1 if none found</td>
</tr>
<tr>
<td align="left">push_back()</td>
<td align="left">VECTOR push_back(VECTOR s, ELEMENT element)</td>
<td align="left">Returns a new vector where the element is appended last</td>
</tr>
<tr>
<td align="left">subset()</td>
<td align="left">VECTOR subset(VECTOR s, int start, int end)</td>
<td align="left">Returns a new vector with a range of elements from the collection. Both start and end are clipped to be 0 to size(s).</td>
</tr>
<tr>
<td align="left">replace()</td>
<td align="left">VECTOR replace(VECTOR s, int start, int end, VECTOR new)</td>
<td align="left">Replace the range start to end in the vector s with the contents of new and returns the new vector. Both start and end are clipped to be 0 to size(s). Can also be used to erase or insert</td>
</tr>
<tr>
<td align="left">map()</td>
<td align="left"></td>
<td align="left">See below</td>
</tr>
<tr>
<td align="left">map_dag()</td>
<td align="left"></td>
<td align="left">See below</td>
</tr>
<tr>
<td align="left">filter()</td>
<td align="left"></td>
<td align="left">See below</td>
</tr>
<tr>
<td align="left">reduce()</td>
<td align="left"></td>
<td align="left">See below</td>
</tr>
<tr>
<td align="left">stable_sort()</td>
<td align="left"></td>
<td align="left">See below</td>
</tr>
</tbody>
</table>
<p>Example: update()</p>
<div class="codehilite"><pre>assert(update([1, 2, 3, 4], 2, 33) == [1, 2, 33, 4])
</pre></div>

<p>Example: size()</p>
<div class="codehilite"><pre>assert(size([1, 2, 3, 4]) == 4)
</pre></div>

<p>Example: find()</p>
<div class="codehilite"><pre>assert(find([ 10, 20, 30, 40], 30) == 3)
</pre></div>

<p>Example: replace()</p>
<div class="codehilite"><pre>assert(replace([ 1, 2, 3, 4, 5], 1, 4, [8, 9])  == [1, 8, 9, 5])
</pre></div>

<p>Example: subset()</p>
<div class="codehilite"><pre>assert(subset([ 10, 20, 30, 40 ], 1, 3) == [ 20, 30 ])
</pre></div>

<h4 id="vector-functional-style-operations">VECTOR FUNCTIONAL-STYLE OPERATIONS<a class="headerlink" href="#vector-functional-style-operations" title="Permanent link"></a></h4>
<p>Also called &ldquo;Higher-order functions&rdquo;.</p>
<p>IMPORTANT: These functions replace custom loops but <em>also</em> expose parallelism opportunities that allows the Floyd runtime to process each element on a separate hardware core, like shaders works in a graphics card. The supplied function must be pure.</p>
<h5 id="map">map()<a class="headerlink" href="#map" title="Permanent link"></a></h5>
<p>Processes a vector of values one by one using function f. It returns a vector of the same size, but with values of type R.</p>
<div class="codehilite"><pre>[R] map([E] elements, func R (E e, C context) f, C context)
</pre></div>

<p>Supports mapping over
- vectors
- characters in a string</p>
<h5 id="map_dag">map_dag()<a class="headerlink" href="#map_dag" title="Permanent link"></a></h5>
<div class="codehilite"><pre>[R] map_dag([E] elements, [int] depends_on, func R (E, [R], C context) f, C context)
</pre></div>

<p>This function runs a bunch of tasks with dependencies between them. When map_dag() returns, all tasks have been executed.</p>
<ul>
<li>Tasks can call blocking functions or impure functions. This makes the map_dag() call impure too.</li>
<li>Tasks cannot generate new tasks.</li>
<li>A task <em>can</em> call map_dag.</li>
<li>Task will not start until all its dependencies have been finished.</li>
<li>
<p>There is no way for any code to observe partially executed map_dag(). It&rsquo;s done or not.</p>
</li>
<li>
<p><strong>values</strong>: a vector of tasks and their dependencies. A task is a value of type T. T can be an enum to allow mixing different types of tasks. Each task also has a vector of integers tell which other tasks it depends upon. The indexes are the indexes into the tasks-vector. Use index -1 to mean <em>depends on nothing</em>.</p>
</li>
<li>
<p><strong>f</strong>: this is your function that processes one T and returns a result R. The function must not depend on the order in which tasks execute. When f is called, all the tasks dependency tasks have already been executed and you get their results in [R].</p>
</li>
<li>
<p><strong>result</strong>: a vector with one element for each element in the tasks-argument. The order of the elements is the same as the input vector.</p>
</li>
</ul>
<p>Notice: your function f can send messages to a clock — this means another clock can start consuming results while map_dag() is still running.</p>
<p>Notice: using this function exposes potential for parallelism.</p>
<h5 id="filter">filter()<a class="headerlink" href="#filter" title="Permanent link"></a></h5>
<p>Processes a vector of values and returns each that function f decides to include.</p>
<div class="codehilite"><pre>[E] filter([E] elements, func bool (E e, C context) f, C context)
</pre></div>

<h5 id="reduce">reduce()<a class="headerlink" href="#reduce" title="Permanent link"></a></h5>
<p>Processes a vector or values using the supplied function. Result is <em>one</em> value.</p>
<div class="codehilite"><pre>R reduce([E] elements, R accumulator_init, func R (R accumulator, E element, C context) f, C context)
</pre></div>

<h5 id="stable_sort">stable_sort()<a class="headerlink" href="#stable_sort" title="Permanent link"></a></h5>
<p>Sort a vector and return a new sorted vector. The existing vector is unchanged.</p>
<div class="codehilite"><pre>[T] stable_sort([T] elements, func bool (T left, T right, C context) less, C context)
</pre></div>

<p><a id="dictionary"></a></p>
<h3 id="dictionary">DICTIONARY<a class="headerlink" href="#dictionary" title="Permanent link"></a></h3>
<p>A collection of values where you identify the values using string keys. Internally it is represented as a hash table. It is not sorted.</p>
<p>You make a new dictionary and specify its values like this:</p>
<div class="codehilite"><pre>b = { &quot;red&quot;: 0, &quot;blue&quot;: 100, &quot;green&quot;: 255 }
</pre></div>

<p>This is called the dictionary-constructor and it lets you create a new dictionary value anywhere an expression can be typed. This expression supports non-constant elements of the constructor.</p>
<p>Dictionaries always use string-keys. When you specify the type of dictionary you must always include &ldquo;string&rdquo;. In the future other types of keys may be supported.</p>
<p>Use [] to look up values using a key. It throws an exception is the key not found. If you want to avoid that. check with exists() first.</p>
<table>
<thead>
<tr>
<th align="left">FEATURE</th>
<th align="left">SIGNATURE</th>
<th align="left">DESCRIPTION</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">[]</td>
<td align="left">ELEMENT s[string key]</td>
<td align="left">Lookup element in the dictionary s using its string key</td>
</tr>
<tr>
<td align="left">&lt; &gt; &lt;= &gt;= == != &amp;&amp;</td>
<td align="left"></td>
<td align="left">Compares dictionaries, element by element</td>
</tr>
<tr>
<td align="left">update()</td>
<td align="left">DICTIONARY update(DICTIONARY s, string key, ELEMENT new_element)</td>
<td align="left">Changes one element of the dictionary and returns a new dictionary</td>
</tr>
<tr>
<td align="left">size()</td>
<td align="left">int size(DICTIONARY s)</td>
<td align="left">Returns the number of elements in the dictionary. Returns 0 if the dictionary is empty</td>
</tr>
<tr>
<td align="left">exists()</td>
<td align="left">bool exists(DICTIONARY s, string key)</td>
<td align="left">Returns true if the key is found</td>
</tr>
<tr>
<td align="left">erase()</td>
<td align="left">DICTIONARY erase(DICTIONARY s, string key)</td>
<td align="left">Erases the value from the dictionary, returns a new dictionary</td>
</tr>
<tr>
<td align="left">get_keys()</td>
<td align="left">[ELEMENT] get_keys(DICTIONARY s)</td>
<td align="left">Returns a vector with all the string keys of the dictionary. Order is undefined</td>
</tr>
</tbody>
</table>
<p>Example: size()</p>
<div class="codehilite"><pre>assert(size({ &quot;a&quot;: 1, &quot;b&quot;: 1000 }) == 2)
</pre></div>

<p>Example: get_keys()
<div class="codehilite"><pre>let a = { &quot;a&quot;: 1, &quot;b&quot;: 2, &quot;c&quot; : 3 }
let b = get_keys(a)
assert(b == [ &quot;a&quot;, &quot;b&quot;, &quot;c&quot;])
</pre></div></p>
<p>??? erase() key not part of dict = silent or error?</p>
<p>Example: update()</p>
<div class="codehilite"><pre>let x = update({ &quot;a&quot;: 1 }, &quot;b&quot;, 2)
assert(x == { &quot;a&quot;: 1, &quot;b&quot;: 2 })

let y = update({ &quot;a&quot;: 1, &quot;b&quot;: 2, &quot;c&quot;: 3 }, &quot;a&quot;, 11)
assert(y == { &quot;a&quot;:11, &quot;b&quot;:2, &quot;c&quot;: 3 })
</pre></div>

<p>Example: exists()</p>
<div class="codehilite"><pre>assert(exists({ &quot;a&quot;: 1, &quot;b&quot;: 2, &quot;c&quot;: 3 }, &quot;b&quot;)  == true)

assert(exists({ &quot;a&quot;: 1, &quot;b&quot;: 2, &quot;c&quot;: 3 }, &quot;f&quot;)  == false)
</pre></div>

<p><a id="struct"></a></p>
<h3 id="struct">STRUCT<a class="headerlink" href="#struct" title="Permanent link"></a></h3>
<p>Structs are aggregate types. The members have name and type. They replace objects and class of other languages. Structs are always values and immutable. They are very fast and compact: behind the curtains copied structs shares state between them, even when partially modified.</p>
<p>A struct type automatically gets a construction function with the same name as the struct. This is the only function that can create a value of the struct from scratch. It&rsquo;s arguments match the struct members and are in the order they are listed in the struct definition.</p>
<p>There are no destructors.
Comparison operators: == != &lt; &gt; &lt;= &gt;= (this allows sorting too) automatically works for every struct.</p>
<h5 id="not-possible">NOT POSSIBLE<a class="headerlink" href="#not-possible" title="Permanent link"></a></h5>
<ul>
<li>You cannot make constructors. There is only <em>one</em> way to initialize the members, via the constructor, which always takes <em>all</em> members</li>
<li>There is no way to directly initialize a member when defining the struct.</li>
<li>There is no way to have several different constructors, instead create explicit functions like make_square().</li>
<li>If you want a default constructor, implement one yourself: <code>func rect make_zero_rect(){ return rect(0, 0) }</code>.</li>
<li>Unlike struct in the C language, Floyd&rsquo;s struct has an undefined layout so you cannot use them to do byte-level mapping like you often do in C. Floyd is free to store members in any way it wants too - pack or reorder in any way.</li>
</ul>
<p>Named and unnamed structs:</p>
<p>There are two flavors of structs: named structs and unnamed structs.</p>
<ul>
<li>A named structs is only compatible with itself, even if another struct has the exact same members. They need to be defined before use, using the struct definition statement.</li>
<li>Unnamed structs use structure equivalence and can be defined when you use a type, like this: <code>func int get_count(struct { int start; int end } range)</code></li>
</ul>
<p>Examples of named structs</p>
<div class="codehilite"><pre>//  Make simple, ready-for use struct.
struct point {
    double x
    double y
}

//  Try the new struct:

let a = point(0, 3)
assert(a.x == 0)
assert(a.y == 3)
</pre></div>

<p>Example: update()</p>
<div class="codehilite"><pre>let b = point(10, 20)
let c = update(b, x, 123)
assert(c == point(123, 20))
</pre></div>

<p>Examples of unnamed structs</p>
<p>Next makes a new unnamed struct on the fly. The type uses structual equivalence with other unnamed types. It never matches a named struct with the same members.</p>
<div class="codehilite"><pre>let a = struct { string name, int age }(&quot;Bob&quot;, 62)

func struct { string message, int err } open(string path){
    return struct { string message, int err }(&quot;File not found&quot;, -4)
}
</pre></div>

<table>
<thead>
<tr>
<th align="left">FEATURE</th>
<th align="left">SIGNATURE</th>
<th align="left">DESCRIPTION</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">&lt; &gt; &lt;= &gt;= == != &amp;&amp;</td>
<td align="left"></td>
<td align="left">Compares struct values in member order</td>
</tr>
<tr>
<td align="left">update()</td>
<td align="left">STRUCT update(STRUCT s, member, new_value)</td>
<td align="left">Changes one member of the struct and returns a new struct. The member is evalutated at compile time. The new_value must match member&rsquo;s type</td>
</tr>
</tbody>
</table>
<p><a id="typeid"></a></p>
<h3 id="typeid">TYPEID<a class="headerlink" href="#typeid" title="Permanent link"></a></h3>
<p>A typeid is tells the type of a value.</p>
<p>When you reference one of the built-in primitive types by name, you are accessing a variable of type typeid.</p>
<ul>
<li>bool</li>
<li>int</li>
<li>double</li>
<li>string</li>
</ul>
<div class="codehilite"><pre>assert(typeid(&quot;hello&quot;) == string)
assert(to_string(typeid([ 1, 2, 3 ])) == &quot;[int]&quot;)
</pre></div>

<p>A typeid is a proper Floyd value: you can copy it, compare it, convert it to strings, store it in dictionaries or whatever. Since to_string() supports typeid, you can easily print out the exact layout of any type, including complex ones with nested structs and vectors etc.</p>
<table>
<thead>
<tr>
<th align="left">FEATURE</th>
<th align="left">SIGNATURE</th>
<th align="left">DESCRIPTION</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">&lt; &gt; &lt;= &gt;= == != &amp;&amp;</td>
<td align="left"></td>
<td align="left">Compares dictionaries, element by element</td>
</tr>
</tbody>
</table>
<p><a id="json"></a></p>
<h3 id="json">JSON<a class="headerlink" href="#json" title="Permanent link"></a></h3>
<p>Why JSON? JSON is very central to Floyd. Floyd is based on values (simple ones or entire data models as one value) JSON is a simple and standard way to store composite values in a tree shape in a simple and standardized way. It also makes it easy to serializing any Floyd value to text and back. JSON is built directly into the language as the default serialized format for Floyd values.</p>
<p>Read more about JSON here: <a href="http://www.json.org">www.json.org</a></p>
<p>It can be used for custom file format and protocol and to interface with other JSON-based systems. All structs also automatically are serializable to and from JSON automatically.</p>
<p>JSON format is also used by the compiler and language itself to store intermediate Floyd program code, for all logging and for debugging features.</p>
<blockquote>
<p>Floyd has built in support for JSON in the language.</p>
</blockquote>
<p>It has a JSON type called <strong>json</strong> and functions to pack &amp; unpack strings / JSON files into the JSON type.</p>
<p>Floyd has support for JSON literals: you can put JSON data directly into a Floyd file. Great for copy-pasting snippets for tests.</p>
<p>This value can contain any of the 7 JSON-compatible types:</p>
<table>
<thead>
<tr>
<th align="left">JSON TYPE</th>
<th align="left">EXAMPLE CODE</th>
<th align="left">FLOYD CONSTANT NAME</th>
<th align="left">FLOYD CONSTANT VALUE</th>
<th align="left">FLOYD TYPE</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">object</td>
<td 1="1" _a_:="&quot;a&quot;:" align="left">json(</td>
<td align="left">json_object</td>
<td align="left">1</td>
<td align="left">dictionary</td>
</tr>
<tr>
<td align="left">array</td>
<td align="left">json([1, 2, 3])</td>
<td align="left">json_array</td>
<td align="left">2</td>
<td align="left">vector</td>
</tr>
<tr>
<td align="left">string</td>
<td align="left">json(&ldquo;hi!&rdquo;)</td>
<td align="left">json_string</td>
<td align="left">3</td>
<td align="left">string</td>
</tr>
<tr>
<td align="left">number</td>
<td align="left">json(13.2)</td>
<td align="left">json_number</td>
<td align="left">4</td>
<td align="left">double</td>
</tr>
<tr>
<td align="left">true</td>
<td align="left">json(true)</td>
<td align="left">json_true</td>
<td align="left">5</td>
<td align="left">bool:true</td>
</tr>
<tr>
<td align="left">false</td>
<td align="left">json(false)</td>
<td align="left">json_false</td>
<td align="left">6</td>
<td align="left">bool:false</td>
</tr>
<tr>
<td align="left">null</td>
<td align="left">json(null)</td>
<td align="left">json_null</td>
<td align="left">7</td>
<td align="left">illegal</td>
</tr>
</tbody>
</table>
<p>Notice: This is the only situation were Floyd supports null. Floyd things null is a concept to avoid when possible.</p>
<p>Notice that Floyd stores true/false as a bool type with the values true / false, not as two types called &ldquo;true&rdquo; and &ldquo;false&rdquo;.</p>
<p>Notice that json can contain an entire huge JSON file, with a big tree of JSON objects and arrays and so on. A json can also contain just a string or a number or a single JSON array of strings. The json is used for every node in the json tree.</p>
<table>
<thead>
<tr>
<th align="left">FEATURE</th>
<th align="left">SIGNATURE</th>
<th align="left">DESCRIPTION</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">&lt; &gt; &lt;= &gt;= == != &amp;&amp;</td>
<td align="left"></td>
<td align="left">Compares dictionaries, element by element</td>
</tr>
<tr>
<td align="left">size()</td>
<td align="left">int size(json s)</td>
<td align="left">If the json contains an array or object, it will return the number of elements. Else throws an exception</td>
</tr>
<tr>
<td align="left">get_json_type()</td>
<td align="left">int get_json_type(json s)</td>
<td align="left">Returns the actual type of this value stores inside the json. It can be one of the 7 types supported by JSON. This needs to be queried at runtime since the json type can change its type at runtime</td>
</tr>
<tr>
<td align="left">generate_json_script()</td>
<td align="left">string generate_json_script(json v)</td>
<td align="left">Pack a JSON value to a JSON script string, ready to write to a file, send via protocol etc. The result is a valid JSON script string that can be handed to another system to be unpacked. The string is unescaped, not ready to stored in URL etc</td>
</tr>
<tr>
<td align="left">parse_json_script()</td>
<td align="left">json parse_json_script(string s)</td>
<td align="left">Make a new Floyd JSON value from a JSON-script string. If the string is malformed, exceptions will be thrown. The string s is expected to be unescaped</td>
</tr>
<tr>
<td align="left">to_json()</td>
<td align="left">json to_json(any v)</td>
<td align="left">Converts any Floyd value to a hiearchy of json-values</td>
</tr>
<tr>
<td align="left">from_json()</td>
<td align="left">any from_json(json v, typeid target_type)</td>
<td align="left">Attempts to convert a json to a specific Floyd type</td>
</tr>
</tbody>
</table>
<p>Example: size()</p>
<div class="codehilite"><pre>let a = size(json([ 1, 2, 3 ])
assert(a == 3)

let b = size(json({ &quot;a&quot;: 9 })
assert(b == 1)
</pre></div>

<p>Example: get_json_type() and json constants (json_object etc)</p>
<div class="codehilite"><pre>func string get_name(json value){
    let t = get_json_type(value)
    if(t == json_object){
        return &quot;json_object&quot;
    }
    else if(t == json_array){
        return &quot;json_array&quot;
    }
    else if(t == json_string){
        return &quot;json_string&quot;
    }
    else if(t == json_number){
        return &quot;json_number&quot;
    }
    else if(t == json_true){
        return &quot;json_true&quot;
    }
    else if(t == json_false){
        return &quot;json_false&quot;
    }
    else if(t == json_null){
        return &quot;json_null&quot;
    }
    else {
        assert(false)
    }
}

assert(get_name(json({ &quot;a&quot;: 1, &quot;b&quot;: 2 })) == &quot;json_object&quot;)
assert(get_name(json([ 1, 2, 3 ])) == &quot;json_array&quot;)
assert(get_name(json(&quot;crash&quot;)) == &quot;json_string&quot;)
assert(get_name(json(0.125)) == &quot;json_number&quot;)
assert(get_name(json(true)) == &quot;json_true&quot;)
assert(get_name(json(false)) == &quot;json_false&quot;)
</pre></div>

<h4 id="json-literals">JSON LITERALS<a class="headerlink" href="#json-literals" title="Permanent link"></a></h4>
<p>You can directly embed JSON inside Floyd source code file. This is extremely simple - no escaping needed - just paste a snippet into the Floyd source code.</p>
<p>Example JSON:</p>
<div class="codehilite"><pre>let json a = 13
let json b = &quot;Hello!&quot;
let json c = { &quot;hello&quot;: 1, &quot;bye&quot;: 3 }
let json d = { &quot;pigcount&quot;: 3, &quot;pigcolor&quot;: &quot;pink&quot; }

assert(a == 13)
assert(b == &quot;Hello!&quot;)
assert(c[&quot;hello&quot;] == 1)
assert(c[&quot;bye&quot;] == 3)
assert(size(c) == 2)

let test_json2 = json(
    {
        &quot;one&quot;: 1,
        &quot;two&quot;: 2,
        &quot;three&quot;: &quot;three&quot;,
        &quot;four&quot;: [ 1, 2, 3, 4 ],
        &quot;five&quot;: { &quot;alpha&quot;: 1000, &quot;beta&quot;: 2000 },
        &quot;six&quot;: true,
        &quot;seven&quot;: false,
    }
)
</pre></div>

<p>Notice that JSON objects are laxer than other Floyd values: you can mix different types of values in the same object or array. Floyd is stricter: a vector can only hold one type of element, same with dictionaries. If your code makes an invalid JSON you get an error.</p>
<p>These are the different shapes a JSON can have in Floyd:</p>
<ol>
<li>
<p>Floyd value: a normal Floyd value - struct or a vector or a number etc. Stored in RAM.</p>
</li>
<li>
<p>json: data is JSON compatible, stored in RAM the 7 different value types supported by json. It holds one JSON value or a JSON object or a JSON array, that in turn can hold other json:s.</p>
</li>
<li>
<p>JSON-script string: JSON data encoded as a string of characters, as stored in a text file.</p>
<p>Example string: {&ldquo;name&rdquo;:&rdquo;John&rdquo;, &ldquo;age&rdquo;:31, &ldquo;city&rdquo;:&rdquo;New York&rdquo;}</p>
<p>It contains quotation characters, question mark characters, new lines etc.</p>
</li>
<li>
<p>Escaped string: the string is simplified to be stuffed as a string snippet into some restricted format, like inside a parameter in a URL, as a string-literal inside another JSON or inside a REST command.</p>
<p>Example string: {\&ldquo;name":\&ldquo;John", \&ldquo;age\&ldquo;:31, \&ldquo;city\&ldquo;:\&ldquo;New York\&ldquo;}</p>
</li>
</ol>
<p>Different destinations have different limitations and escape mechanisms and will need different escape functions. This is not really a JSON-related issue, more a URL, REST question.</p>
<p><a id="todo-protocol"></a></p>
<h3 id="todo-protocol">TODO: PROTOCOL<a class="headerlink" href="#todo-protocol" title="Permanent link"></a></h3>
<p>TODO 1.0</p>
<p>This defines a set of functions that several clients can implement differently. This introduced polymorphism into Floyd. Equivalent to interface classes in other languages.</p>
<p>Protocol member functions can be tagged &ldquo;impure&rdquo; which allows it to be implemented so it saves or uses state, modifies the world. There is no way to do these things in the implementation of pure protocol function members.</p>
<p><a id="25-expressions"></a></p>
<h2 id="25-expressions">2.5 EXPRESSIONS<a class="headerlink" href="#25-expressions" title="Permanent link"></a></h2>
<p>An expression is how you calculate new values. The output of an expression is always another value.</p>
<p>Comparisons are deep: for a composite value they consider all members values and their member values. This goes for struct members and collections.</p>
<p><a id="literals"></a></p>
<h3 id="literals">LITERALS<a class="headerlink" href="#literals" title="Permanent link"></a></h3>
<p>This is a value that is fully defined directly in the code. Like the number 3. See each data type for its literals work.</p>
<p><a id="vector-constructor"></a></p>
<h3 id="vector-constructor">VECTOR CONSTRUCTOR<a class="headerlink" href="#vector-constructor" title="Permanent link"></a></h3>
<p>This lets you create a new vector value anywhere an expression can be put. This expression supports non-constant elements of the constructor.
Read more in the vector data type text.</p>
<p><a id="dictionary-constructor"></a></p>
<h3 id="dictionary-constructor">DICTIONARY CONSTRUCTOR<a class="headerlink" href="#dictionary-constructor" title="Permanent link"></a></h3>
<p>This lets you create a new dictionary value anywhere an expression can be typed. This expression supports non-constant elements of the constructor.
Read more in the dictionary data type text.</p>
<p><a id="function-call"></a></p>
<h3 id="function-call">FUNCTION CALL<a class="headerlink" href="#function-call" title="Permanent link"></a></h3>
<div class="codehilite"><pre>let a = make_friendly_message(&quot;Lana&quot;)
</pre></div>

<p>Anywhere an expression can be put, so can a function call be put. Notice that the function value itself can also be an expression, so can each of its arguments.</p>
<p><a id="arithmetic-operators"></a></p>
<h3 id="arithmetic-operators">ARITHMETIC OPERATORS<a class="headerlink" href="#arithmetic-operators" title="Permanent link"></a></h3>
<p>How to add and combine values:</p>
<table>
<thead>
<tr>
<th align="left">OPERATOR</th>
<th align="left">EXPLANATION</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">+</td>
<td align="left">Addition - adds two operands: &ldquo;a = b + c&rdquo;, &ldquo;a = b + c + d&rdquo;</td>
</tr>
<tr>
<td align="left">−</td>
<td align="left">Subtracts second operand from the first. &ldquo;a = b - c&rdquo;, &ldquo;a = b - c - d&rdquo;</td>
</tr>
<tr>
<td align="left">*</td>
<td align="left">Multiplies both operands: &ldquo;a = b * c&rdquo;, &ldquo;a = b * c * d&rdquo;</td>
</tr>
<tr>
<td align="left">/</td>
<td align="left">Divides numerator by de-numerator: &ldquo;a = b / c&rdquo;, &ldquo;a = b / c / d&rdquo;</td>
</tr>
<tr>
<td align="left">%</td>
<td align="left">Modulus Operator returns remainder after an integer division: &ldquo;a = b / c&rdquo;, &ldquo;a = b / c / d&rdquo;</td>
</tr>
</tbody>
</table>
<p><a id="relational-operators"></a></p>
<h3 id="relational-operators">RELATIONAL OPERATORS<a class="headerlink" href="#relational-operators" title="Permanent link"></a></h3>
<p>Used to compare two values. The result is true or false:</p>
<table>
<thead>
<tr>
<th align="left">OPERATOR</th>
<th align="left">EXPLANATION</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">a == b</td>
<td align="left">true if a and b have the same value</td>
</tr>
<tr>
<td align="left">a != b</td>
<td align="left">true if a and b have different values</td>
</tr>
<tr>
<td align="left">a &gt; b</td>
<td align="left">true if the value of a is greater than the value of b</td>
</tr>
<tr>
<td align="left">a &lt; b</td>
<td align="left">true if the value of a is smaller than the value of b</td>
</tr>
<tr>
<td align="left">a &gt;= b</td>
<td align="left">true if a is greater than or equal to b</td>
</tr>
<tr>
<td align="left">a &lt;= b</td>
<td align="left">true if a is less than or equal to b</td>
</tr>
</tbody>
</table>
<p><a id="logical-operators"></a></p>
<h3 id="logical-operators">LOGICAL OPERATORS<a class="headerlink" href="#logical-operators" title="Permanent link"></a></h3>
<p>Used to compare two values. The result is true or false:</p>
<table>
<thead>
<tr>
<th align="left">OPERATOR</th>
<th align="left">EXPLANATION</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">a &amp;&amp; b</td>
<td align="left">true if a is true and b is true</td>
</tr>
<tr>
<td align="left">a || b</td>
<td align="left">true if a is true or b is true</td>
</tr>
</tbody>
</table>
<p><a id="conditional-operator"></a></p>
<h3 id="conditional-operator">CONDITIONAL OPERATOR<a class="headerlink" href="#conditional-operator" title="Permanent link"></a></h3>
<p>When the condition is true, this entire expression has the value of a. Else it has the value of b. Also called ternary operator, because it has three parts.</p>
<div class="codehilite"><pre>condition ? a : b
</pre></div>

<p>Condition, a and b can all be complex expressions, with function calls, etc.</p>
<div class="codehilite"><pre>func bool is_polite(string x){
    return x == &quot;hello&quot; ? &quot;polite&quot; : &quot;rude&quot;
}
assert(is_polite(&quot;hiya!&quot;) == false)
assert(is_polite(&quot;hello&quot;) == true)
</pre></div>

<p><a id="bitwise-operators"></a></p>
<h3 id="bitwise-operators_1">BITWISE OPERATORS<a class="headerlink" href="#bitwise-operators_1" title="Permanent link"></a></h3>
<p>Floyd uses explicit names for all bitwise operators, not special language operators like C does. C uses &ldquo;&amp;&rdquo; for AND and &ldquo;&lt;&lt;&rdquo; for shift left. This is to make evaluation order clear and to avoid accidental mixup between logical operators and bitwise operators.</p>
<p>Read more about this in the int data type section.</p>
<p><a id="benchmark"></a></p>
<h3 id="benchmark">BENCHMARK<a class="headerlink" href="#benchmark" title="Permanent link"></a></h3>
<div class="codehilite"><pre>int benchmark { ... }
</pre></div>

<p>You use this expression to wrap a code snippet to measure. Only the statements inside the brackets are measured, no code outside.</p>
<p>The expression returns the duration it takes the run the body. The compiler&rsquo;s dead-code elimination is disabled inside the brackets to not trip up the measurement. The result of the benchmark expression is a value that tells how long the bracketed statements took to execute. Floyd will execute the bracketed statements many times (called runs): both to warm up the computer caches before measuring, then to get a statistically safe number &ndash; to reduce the error caused by the OS or hardware doing other things.</p>
<p>The returned value is the measured time, in nanoseconds.</p>
<p>Notice: compiler&rsquo;s dead-code elimination is NOT currently disabled correctly.</p>
<p>The instructions will be run:
- For maximum 10.000 times (runs)
- For max 3 seconds
- Minimum 2 times, no matter how long run takes. If your code takes 20 seconds, it will still be run twice.</p>
<p>Notice: if you measure something very fast, the complete benchmark will run quickly too since it stops at 100.000 runs.</p>
<p><a id="example-expressions"></a></p>
<h3 id="example-expressions">EXAMPLE EXPRESSIONS<a class="headerlink" href="#example-expressions" title="Permanent link"></a></h3>
<table>
<thead>
<tr>
<th align="left">SOURCE</th>
<th align="left">MEANING</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">0</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">3</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">3.5</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">(3)</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">3 + 4</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">(1 + 2) * 3</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">x</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">x + y</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">hello + 3</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">&ldquo;test&rdquo;</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">&ldquo;test number&rdquo;</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">f()</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">f(10, 122)</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">print(3)</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">print (3)</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">print (&ldquo;Hello, World!&rdquo;)</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">print(&ldquo;Hello, World!&rdquo; + f(3) == 2)</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">(my_fun1(&ldquo;hello, 3) + 4) * my_fun2(10))</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">hello["troll"].kitty[10].cat</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">condition_expr ? yes_expr : no_expr</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">condition_expr ? yes_expr : no_expr</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">a == 1 ? &ldquo;one&rdquo; : ”some other number&rdquo;</td>
<td align="left"></td>
</tr>
</tbody>
</table>
<p><a id="26-statements"></a></p>
<h2 id="26-statements">2.6 STATEMENTS<a class="headerlink" href="#26-statements" title="Permanent link"></a></h2>
<p><a id="let"></a></p>
<h3 id="let">LET<a class="headerlink" href="#let" title="Permanent link"></a></h3>
<p>Makes a new constant with a name and a value. The value cannot be changed.</p>
<div class="codehilite"><pre>let hello = &quot;Greeting message.&quot;
</pre></div>

<table>
<thead>
<tr>
<th align="left">SOURCE</th>
<th align="left">MEANING</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">let int b = 11</td>
<td align="left">Allocate an immutable local int &ldquo;b&rdquo; and initialize it with 11</td>
</tr>
<tr>
<td align="left">let c = 11</td>
<td align="left">Allocate an immutable local &ldquo;b&rdquo; and initialize it with 11. Type will be inferred to int.</td>
</tr>
<tr>
<td align="left">let d = 8.5</td>
<td align="left">Allocate an immutable local &ldquo;d&rdquo; and initialize it with 8.5. Type will be inferred to double.</td>
</tr>
<tr>
<td align="left">let e = &ldquo;hello&rdquo;</td>
<td align="left">Allocate an immutable local &ldquo;e&rdquo; and initialize it with &ldquo;hello&rdquo;. Type will be inferred to string.</td>
</tr>
<tr>
<td align="left">let f = f(3) == 2</td>
<td align="left">Allocate an immutable local &ldquo;f&rdquo; and initialize it true/false. Type will be bool.</td>
</tr>
<tr>
<td 1_="1," 2="2" _a_:="&quot;a&quot;:" _b_:="&quot;b&quot;:" align="left">let int x = </td>
<td align="left">Allocate a new dictionary.</td>
</tr>
</tbody>
</table>
<p><a id="mutable"></a></p>
<h3 id="mutable">MUTABLE<a class="headerlink" href="#mutable" title="Permanent link"></a></h3>
<p>Makes a new local variable with a name, calculated from the expression. The variable can be changed to hold another value of the same type.</p>
<div class="codehilite"><pre>mutable hello = &quot;Greeting message.&quot;
</pre></div>

<table>
<thead>
<tr>
<th align="left">SOURCE</th>
<th align="left">MEANING</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">mutable int a = 10</td>
<td align="left">Allocate a mutable local int &ldquo;a&rdquo; and initialize it with 10</td>
</tr>
<tr>
<td align="left">a = 12</td>
<td align="left">Assign 12 to local mutable &ldquo;a&rdquo;.</td>
</tr>
<tr>
<td align="left">mutable int x = 10</td>
<td align="left"></td>
</tr>
</tbody>
</table>
<p><a id="function-definition"></a></p>
<h3 id="function-definition">FUNCTION DEFINITION<a class="headerlink" href="#function-definition" title="Permanent link"></a></h3>
<p><div class="codehilite"><pre>func int hello(string s){
    ...
}
</pre></div>
This defines a new function value and gives it a name in the current scope. If you don&rsquo;t include the { &hellip; } body you get a <em>function declaration</em>, you tell the compiler this function exists but is implemented elsewhere.</p>
<table>
<thead>
<tr>
<th align="left">SOURCE</th>
<th align="left">MEANING</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">func int f(string name){ return 13</td>
<td align="left">Function <strong>f</strong> returns int, accepts a string input.</td>
</tr>
<tr>
<td align="left" class="..">func int print(float a) </td>
<td align="left">Function <strong>print</strong> returns int, accepts float argument</td>
</tr>
<tr>
<td align="left">func int f(string name)</td>
<td align="left">Function declaration (without body)</td>
</tr>
</tbody>
</table>
<p><a id="test-def-statement"></a></p>
<h3 id="test-def-statement">TEST-DEF STATEMENT<a class="headerlink" href="#test-def-statement" title="Permanent link"></a></h3>
<p>This defines a new test and registers it in the global registry.</p>
<blockquote>
<p>test-def ( STRING: FUNCTION-UNDER-TEST, STRING: SCENARIO) { TEST-STATEMENTS }</p>
</blockquote>
<p>Floyd has built-in features for writing unit tests. Tests are critical to makeing robust software.</p>
<p>The test-def is all you need to register tests. If it&rsquo;s TEST-STATEMENTS throw an exception the test fails. But there is special test function you use most of the time. NOTICE: Floyd has no means of explicitly throwing an exceptions yet.</p>
<blockquote>
<p>void test(T result, T expected_result)</p>
</blockquote>
<p>Here is simple test where we test that floyd&rsquo;s subset() function work in a specific scenario:</p>
<div class="codehilite"><pre>test-def (&quot;subset()&quot;, &quot;skip first character&quot;){ test(subset(&quot;abc&quot;, 1, 3), &quot;bc&quot; }
</pre></div>

<p>When this test is run, it will execute the test-call by first calling subset(), then comparing subset&rsquo;s output with &ldquo;bc&rdquo;. If it&rsquo;s not identical the test fails.</p>
<p><strong>Important:</strong> test-def is pure and you cannot call any impure functions. This make sense since unit-tests cannot have side effects.</p>
<p><a id="struct-definition"></a></p>
<h3 id="struct-definition">STRUCT DEFINITION<a class="headerlink" href="#struct-definition" title="Permanent link"></a></h3>
<p>This defines a new struct-type and gives it a name in the current scope.</p>
<div class="codehilite"><pre>struct my_struct_t {
    int a
    string b
}
</pre></div>

<table>
<thead>
<tr>
<th align="left">SOURCE</th>
<th align="left">MEANING</th>
</tr>
</thead>
<tbody>
<tr>
<td a="a" align="left" b="b" float="float">struct mytype_t </td>
<td align="left"></td>
</tr>
<tr>
<td align="left">struct a </td>
<td align="left"></td>
</tr>
<tr>
<td a="a" align="left" int="int">struct b </td>
<td align="left"></td>
</tr>
<tr>
<td a="a" align="left" int="int">struct c </td>
<td align="left"></td>
</tr>
<tr>
<td align="left" blue="blue" green="green" int="int" red="red">struct pixel </td>
<td align="left"></td>
</tr>
<tr>
<td align="left" int="int" red="red">struct pixel </td>
<td align="left"></td>
</tr>
</tbody>
</table>
<p>This always results in a named struct that uses name-equivalence. The struct is not compatible or equivalent with another struct with the same members.</p>
<p><a id="if---then---else"></a></p>
<h3 id="if-then-else">IF - THEN - ELSE<a class="headerlink" href="#if-then-else" title="Permanent link"></a></h3>
<p>This is a normal if-elseif-else feature, like in most languages. Brackets are required always.</p>
<div class="codehilite"><pre>if (s == &quot;one&quot;){
    return 1
}
</pre></div>

<p>You can add an else body like this:</p>
<div class="codehilite"><pre>if(s == &quot;one&quot;){
    return 1
}
else{
    return -1
}
</pre></div>

<p>Else-if lets you avoid big nested if-else statements and do this:</p>
<div class="codehilite"><pre>if(s == &quot;one&quot;){
    return 1
}
else if(s == &quot;two&quot;){
    return 2
}
else{
    return -1
}
</pre></div>

<p>In each body you can write any statements. There is no &ldquo;break&rdquo; keyword.</p>
<h5 id="example-if-statements">EXAMPLE IF STATEMENTS<a class="headerlink" href="#example-if-statements" title="Permanent link"></a></h5>
<table>
<thead>
<tr>
<th align="left">SOURCE</th>
<th align="left">MEANING</th>
</tr>
</thead>
<tbody>
<tr>
<td 1000="1000" align="left" return="return">if(true)</td>
<td align="left"></td>
</tr>
</tbody>
</table>
<p><a id="for-loop"></a></p>
<h3 id="for-loop">FOR LOOP<a class="headerlink" href="#for-loop" title="Permanent link"></a></h3>
<p>For loops are used to execute a body of statements many times. The number of times is calculated <em>before</em> the first time the body is called. Many other languages evaluate the condition for each loop iteration. In Floyd you use a while-loop for that.</p>
<p>Example: Closed range that starts with 1 and ends with 5:</p>
<div class="codehilite"><pre>for (index in 1 ... 5) {
    print(index)
}
</pre></div>

<p>Example: Open range that starts with 1 and ends with 59:</p>
<div class="codehilite"><pre>for (tickMark in 0 ..&lt; 60) {
}
</pre></div>

<p>You can use expressions to define the range:, not only constants:</p>
<div class="codehilite"><pre>for (tickMark in a ..&lt; string.size()) {
}
</pre></div>

<ul>
<li>..&lt; defines an <em>open range</em>. Up to the end value but <em>excluding the end value</em>.</li>
<li>..- defines a <em>closed range</em>. Up to and <em>including</em> the end.</li>
</ul>
<p>Notice: prefer to use map(), filter() and reduce() instead of for-loops whenever possible. This makes cleaner code and more optimisation opportunities.</p>
<p><a id="while"></a></p>
<h3 id="while">WHILE<a class="headerlink" href="#while" title="Permanent link"></a></h3>
<p>Perform the loop body while the expression is true.</p>
<div class="codehilite"><pre>while (my_array[a] != 3){
}
</pre></div>

<p>The condition is executed each time before body is executed. If the condition is false initially, then zero loops will run. If you can calculate the number of loop iteration beforehand, then prefer to use for-loop since it expresses that better and also can give better performance.</p>
<p><a id="return"></a></p>
<h3 id="return">RETURN<a class="headerlink" href="#return" title="Permanent link"></a></h3>
<p>The return statement aborts the execution of the current function as the function will have the return statement&rsquo;s expression as its return value.</p>
<table>
<thead>
<tr>
<th align="left">SOURCE</th>
<th align="left">MEANING</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">return 3</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">return myfunc(myfunc() + 3)</td>
<td align="left"></td>
</tr>
</tbody>
</table>
<p><a id="software-system-def"></a></p>
<h3 id="software-system-def">SOFTWARE-SYSTEM-DEF<a class="headerlink" href="#software-system-def" title="Permanent link"></a></h3>
<p>This is a dedicated keyword for defining software systems: <strong>software-system-def</strong>. Its contents is encoded as a JSON object and designed to be either hand-coded or processed by tools. You only have one of these in a software system.</p>
<table>
<thead>
<tr>
<th align="left">Key</th>
<th align="left">Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><strong>name</strong></td>
<td align="left">name of your software system. Something short. JSON String.</td>
</tr>
<tr>
<td align="left"><strong>desc</strong></td>
<td align="left">longer description of your software system. JSON String.</td>
</tr>
<tr>
<td align="left"><strong>people</strong></td>
<td align="left">personas involved in using or maintaining your system. Don&rsquo;t go crazy. JSON object.</td>
</tr>
<tr>
<td align="left"><strong>connections</strong></td>
<td align="left">the most important relationships between people and the containers. Be specific &ldquo;user sends email using gmail&rdquo; or &ldquo;user plays game on device&rdquo; or &ldquo;mobile app pulls user account from server based on login&rdquo;. JSON array.</td>
</tr>
<tr>
<td align="left"><strong>containers</strong></td>
<td align="left">Your iOS app, your server, the email system. Notice that you gmail-server is a container, even though it&rsquo;s a gigantic software system by itself. JSON array with container names as strings. These strings are used as keys to identify containers.</td>
</tr>
</tbody>
</table>
<h5 id="people">PEOPLE<a class="headerlink" href="#people" title="Permanent link"></a></h5>
<p>This is an object where each key is the name of a persona and a short description of that persona.</p>
<div class="codehilite"><pre>&quot;people&quot;: {
    &quot;Gamer&quot;: &quot;Plays the game on one of the mobile apps&quot;,
    &quot;Curator&quot;: &quot;Updates achievements, competitions, make custom on-off maps&quot;,
    &quot;Admin&quot;: &quot;Keeps the system running&quot;
}
</pre></div>

<h5 id="connections">CONNECTIONS<a class="headerlink" href="#connections" title="Permanent link"></a></h5>
<div class="codehilite"><pre>&quot;connections&quot;: [
    {
        &quot;source&quot;: &quot;Game&quot;,
        &quot;dest&quot;: &quot;iphone app&quot;,
        &quot;interaction&quot;: &quot;plays&quot;,
        &quot;tech&quot;: &quot;&quot;
    }
]
</pre></div>

<table>
<thead>
<tr>
<th align="left">Key</th>
<th align="left">Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><strong>source</strong></td>
<td align="left">the name of the container or user, as listed in the software-system-def</td>
</tr>
<tr>
<td align="left"><strong>dest</strong></td>
<td align="left">the name of the container or user, as listed in the software-system-def</td>
</tr>
<tr>
<td align="left"><strong>interaction</strong></td>
<td align="left">&ldquo;user plays game on device&rdquo; or &ldquo;server sends order notification&rdquo;</td>
</tr>
<tr>
<td align="left"><strong>tech</strong></td>
<td align="left">&ldquo;webhook&rdquo;, &ldquo;REST command&rdquo;</td>
</tr>
</tbody>
</table>
<p><a id="container-def"></a></p>
<h3 id="container-def">CONTAINER-DEF<a class="headerlink" href="#container-def" title="Permanent link"></a></h3>
<p>This is a dedicated keyword. It defines <em>one</em> container, its name, its internal processes and how they interact.</p>
<table>
<thead>
<tr>
<th align="left">Key</th>
<th align="left">Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left"><strong>name</strong></td>
<td align="left">Needs to match the name listed in software-system-defs, containers.</td>
</tr>
<tr>
<td align="left"><strong>tech</strong></td>
<td align="left">short string that lists the most important technologies, languages, toolkits.</td>
</tr>
<tr>
<td align="left"><strong>desc</strong></td>
<td align="left">short string that tells what this component is and does.</td>
</tr>
<tr>
<td align="left"><strong>clocks</strong></td>
<td align="left">defines every clock (concurrent process) in this container and lists which processes that are synced to each of these clocks</td>
</tr>
<tr>
<td align="left"><strong>connections</strong></td>
<td align="left">connects the processes together using virtual wires. Source-process-name, dest-process-name, interaction-description.</td>
</tr>
<tr>
<td align="left"><strong>probes_and_tweakers</strong></td>
<td align="left">lists all probes and tweakers used in this container. Notice that the same function or component can have a different set of probes and tweakers per container or share them.</td>
</tr>
<tr>
<td align="left"><strong>components</strong></td>
<td align="left">lists all imported components needed for this container</td>
</tr>
</tbody>
</table>
<p>You should keep this statement close to process-code that makes up the container. That handles messages, stores their mutable state, does all communication with the real world. Keep the logic code out of here as much as possible, the Floyd processes are about communication and state and time only.</p>
<h5 id="example-container">EXAMPLE CONTAINER<a class="headerlink" href="#example-container" title="Permanent link"></a></h5>
<div class="codehilite"><pre>container-def {
    &quot;name&quot;: &quot;iphone app&quot;,
    &quot;tech&quot;: &quot;Swift, iOS, Xcode, Open GL&quot;,
    &quot;desc&quot;: &quot;Mobile shooter game for iOS.&quot;,

    &quot;clocks&quot;: {
        &quot;main&quot;: {
            &quot;a&quot;: &quot;my_gui&quot;,
            &quot;b&quot;: &quot;iphone-ux&quot;
        },

        &quot;com-clock&quot;: {
            &quot;c&quot;: &quot;server_com&quot;
        },
        &quot;opengl_feeder&quot;: {
            &quot;d&quot;: &quot;renderer&quot;
        }
    },
    &quot;connections&quot;: [
        { &quot;source&quot;: &quot;b&quot;, &quot;dest&quot;: &quot;a&quot;, &quot;interaction&quot;: &quot;b sends messages to a&quot;, &quot;tech&quot;: &quot;OS call&quot; },
        { &quot;source&quot;: &quot;b&quot;, &quot;dest&quot;: &quot;c&quot;, &quot;interaction&quot;: &quot;b also sends messages to c, which is another clock&quot;, &quot;tech&quot;: &quot;OS call&quot; }
    ],
    &quot;components&quot;: [
        &quot;My Arcade Game-iphone-app&quot;,
        &quot;My Arcade Game-logic&quot;,
        &quot;My Arcade Game-servercom&quot;,
        &quot;OpenGL-component&quot;,
        &quot;Free Game Engine-component&quot;,
        &quot;iphone-ux-component&quot;
    ]
}
</pre></div>

<h5 id="proxy-container">PROXY CONTAINER<a class="headerlink" href="#proxy-container" title="Permanent link"></a></h5>
<p>If you use an external component or software system, like for example gmail, you list it here so we can represent it via a proxy container.</p>
<div class="codehilite"><pre>container-def {
    &quot;name&quot;: &quot;gmail mail server&quot;
}
</pre></div>

<p>or </p>
<div class="codehilite"><pre>container-def {
    &quot;name&quot;: &quot;gmail mail server&quot;
    &quot;tech&quot;: &quot;Google tech&quot;,
    &quot;desc&quot;: &quot;Use gmail to store all gamer notifications.&quot;
}
</pre></div>

<h5 id="container-code">CONTAINER CODE<a class="headerlink" href="#container-code" title="Permanent link"></a></h5>
<p>For each floyd process you&rsquo;ve listed under &ldquo;clocks&rdquo;, (&ldquo;my_gui&rdquo;, &ldquo;iphone-ux&rdquo;, &ldquo;server_com&rdquo; and &ldquo;renderer&rdquo; in the example above) you need to implement two functions. The init-function and the message handler. These functions are named based on the process.</p>
<p>The init function is called x__init() where x is a placeholder. It takes no arguments, is impure and returns a value of type of your choice. This type is your process&rsquo; memory slot &ndash; the only mutable state your process has access to.</p>
<p>The message handler is named like your process, takes two arguments: the current state of your memory, of type T and a message to process. It&rsquo;s am impure function. It returns the next state of it&rsquo;s memory. The memory type must be the same between the init and message handler functions. It&rsquo;s usually a struct that represents the top level of your process&rsquo; entire state.</p>
<p>The message is represented as a json for now. This is a workaround until there is a proper sumtype feature in Floyd.</p>
<div class="codehilite"><pre>func my_gui_state_t my_gui__init() impure {
    send(&quot;a&quot;, &quot;dec&quot;)
    send(&quot;a&quot;, &quot;dec&quot;)
    send(&quot;a&quot;, &quot;dec&quot;)
    send(&quot;a&quot;, &quot;dec&quot;)
    send(&quot;a&quot;, &quot;stop&quot;)
    return my_gui_state_t(1000)
}

func my_gui_state_t my_gui(my_gui_state_t state, json message) impure{
}
</pre></div>

<p><a id="benchmark-def"></a></p>
<h3 id="benchmark-def">BENCHMARK-DEF<a class="headerlink" href="#benchmark-def" title="Permanent link"></a></h3>
<p>Defines a benchmark so it&rsquo;s available to Floyd. All benchmark-defs in your program are collected in a registry but are not automatically run. The name-string is used to reference the benchmark.</p>
<div class="codehilite"><pre>[ benchmark_result_t ]benchmark-def &quot;name&quot; { ... }
</pre></div>

<p>The benchmark registry is available to your code as a global immutable vector, like this:</p>
<div class="codehilite"><pre>struct benchmark_def {
    string name
    func [ benchmar_result_t] f()
}

let [ benchmark_def_t ] benchmark_registry
</pre></div>

<p>This means you can write code that explores the benchmark_registry vector and its contents, and even run tests. There are also standard library functions that helps you do this easily. See the standard library section. Normally you run benchmarks using the features in the floyd command line tool.</p>
<p>The return from benchmark-def is a vector of benchmark_result_t:s. One for each &ldquo;benchmark instance&rdquo;. But often you use a single benchmark_result_t.</p>
<div class="codehilite"><pre>benchmark_result_t(int dur, json more)
</pre></div>

<p>The dur (duration) is how long the benchmark took to run in nanoseconds. The second argument, <em>more</em>, is optionally more information about your benchmark. If you don&rsquo;t have more info, just pass null. See make_benchmark_report() and how it supports <em>more</em>.</p>
<p><a id="todo-switch"></a></p>
<h3 id="todo-switch">TODO: SWITCH<a class="headerlink" href="#todo-switch" title="Permanent link"></a></h3>
<p>TODO POC</p>
<p><a id="27-example-software-system-file"></a></p>
<h2 id="27-example-software-system-file">2.7 EXAMPLE SOFTWARE SYSTEM FILE<a class="headerlink" href="#27-example-software-system-file" title="Permanent link"></a></h2>
<p><div class="codehilite"><pre>software-system-def {
    &quot;name&quot;: &quot;My Arcade Game&quot;,
    &quot;desc&quot;: &quot;Space shooter for mobile devices with connection to a server.&quot;,

    &quot;people&quot;: {
        &quot;Gamer&quot;: &quot;Plays the game on one of the mobile apps&quot;,
        &quot;Curator&quot;: &quot;Updates achievements, competitions, make custom on-off maps&quot;,
        &quot;Admin&quot;: &quot;Keeps the system running&quot;
    },
    &quot;connections&quot;: [
        { &quot;source&quot;: &quot;Game&quot;, &quot;dest&quot;: &quot;iphone app&quot;, &quot;interaction&quot;: &quot;plays&quot;, &quot;tech&quot;: &quot;&quot; }
    ],
    &quot;containers&quot;: [
        &quot;gmail mail server&quot;,
        &quot;iphone app&quot;,
        &quot;Android app&quot;
    ]
}
result = 123

container-def {
    &quot;name&quot;: &quot;iphone app&quot;,
    &quot;tech&quot;: &quot;Swift, iOS, Xcode, Open GL&quot;,
    &quot;desc&quot;: &quot;Mobile shooter game for iOS.&quot;,

    &quot;clocks&quot;: {
        &quot;main&quot;: {
            &quot;a&quot;: &quot;my_gui&quot;,
            &quot;b&quot;: &quot;iphone-ux&quot;
        },

        &quot;com-clock&quot;: {
            &quot;c&quot;: &quot;server_com&quot;
        },
        &quot;opengl_feeder&quot;: {
            &quot;d&quot;: &quot;renderer&quot;
        }
    },
    &quot;connections&quot;: [
        { &quot;source&quot;: &quot;b&quot;, &quot;dest&quot;: &quot;a&quot;, &quot;interaction&quot;: &quot;b sends messages to a&quot;, &quot;tech&quot;: &quot;OS call&quot; },
        { &quot;source&quot;: &quot;b&quot;, &quot;dest&quot;: &quot;c&quot;, &quot;interaction&quot;: &quot;b also sends messages to c, which is another clock&quot;, &quot;tech&quot;: &quot;OS call&quot; }
    ],
    &quot;components&quot;: [
        &quot;My Arcade Game-iphone-app&quot;,
        &quot;My Arcade Game-logic&quot;,
        &quot;My Arcade Game-servercom&quot;,
        &quot;OpenGL-component&quot;,
        &quot;Free Game Engine-component&quot;,
        &quot;iphone-ux-component&quot;
    ]
}

func string my_gui__init() impure {
    print(&quot;HELLO\n&quot;)
    send(&quot;a&quot;, &quot;stop&quot;)
    send(&quot;b&quot;, &quot;stop&quot;)
    send(&quot;c&quot;, &quot;stop&quot;)
    send(&quot;d&quot;, &quot;stop&quot;)
    return &quot;a is done&quot;
}
</pre></div>
<a id="28-floyd-syntax"></a></p>
<h2 id="28-floyd-syntax">2.8 FLOYD SYNTAX<a class="headerlink" href="#28-floyd-syntax" title="Permanent link"></a></h2>
<p>Here is the DAG for the complete syntax of Floyd.</p>
<div class="codehilite"><pre>IDENTIFIER_CHARS: &quot;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789_&quot;
WHITESPACE: &quot; \n\t&quot;

LITERAL:
    BOOL_LITERAL: &quot;true&quot; or &quot;false&quot;
    INTEGER_LITERAL: [0123456789]
    DOUBLE_LITERAL: [0123456789.]
    STRING_LITERAL: &quot;?&quot;
IDENTIFIER: IDENTIFIER_CHARS*

TYPE:
    NULL                            &quot;null&quot;
    BOOL                            &quot;bool&quot;
    INT                         &quot;int&quot;
    DOUBLE                      &quot;double&quot;
    STRING                      &quot;string&quot;
    TYPEID                      ???
    VECTOR                      &quot;[&quot; TYPE &quot;]&quot;
    DICTIONARY                  &quot;{&quot; TYPE &quot;:&quot; TYPE&quot; &quot;}&quot;
    FUNCTION-TYPE                   TYPE &quot;(&quot; ARGUMENT &quot;,&quot;* &quot;)&quot; &quot;{&quot; BODY &quot;}&quot;
        ARGUMENT                    TYPE identifier
    STRUCT-DEF                  &quot;struct&quot; IDENTIFIER &quot;{&quot; MEMBER* &quot;}&quot;
        MEMBER                   TYPE IDENTIFIER
    UNNAMED-STRUCT              &quot;struct&quot; &quot;{&quot; TYPE* &quot;}&quot;

    UNRESOLVED-TYPE             IDENTIFIER-CHARS, like &quot;hello&quot;

EXPRESSION:
    EXPRESSION-COMMA-LIST           EXPRESSION | EXPRESSION &quot;,&quot; EXPRESSION-COMMA-LIST
    NAME-EXPRESSION             IDENTIFIER &quot;:&quot; EXPRESSION
    NAME-COLON-EXPRESSION-LIST      NAME-EXPRESSION | NAME-EXPRESSION &quot;,&quot; NAME-COLON-EXPRESSION-LIST

    TYPE-NAME                       TYPE IDENTIFIER
    TYPE-NAME-COMMA-LIST            TYPE-NAME | TYPE-NAME &quot;,&quot; TYPE-NAME-COMMA-LIST
    TYPE-NAME-SEMICOLON-LIST        TYPE-NAME &quot;;&quot; | TYPE-NAME &quot;;&quot; TYPE-NAME-SEMICOLON-LIST

    NUMERIC-LITERAL             &quot;0123456789&quot; +++
    RESOLVE-IDENTIFIER              IDENTIFIER +++

    CONSTRUCTOR-CALL                TYPE &quot;(&quot; EXPRESSION-COMMA-LIST &quot;)&quot; +++

    VECTOR-DEFINITION               &quot;[&quot; EXPRESSION-COMMA-LIST &quot;]&quot; +++
    DICT-DEFINITION             &quot;[&quot; NAME-COLON-EXPRESSION-LIST &quot;]&quot; +++
    ADD                         EXPRESSION &quot;+&quot; EXPRESSION +++
    SUB                         EXPRESSION &quot;-&quot; EXPRESSION +++
                                EXPRESSION &quot;&amp;&amp;&quot; EXPRESSION +++
    RESOLVE-MEMBER              EXPRESSION &quot;.&quot; EXPRESSION +++
    GROUP                       &quot;(&quot; EXPRESSION &quot;)&quot;&quot; +++
    LOOKUP                      EXPRESSION &quot;[&quot; EXPRESSION &quot;]&quot;&quot; +++
    CALL                            EXPRESSION &quot;(&quot; EXPRESSION-COMMA-LIST &quot;)&quot; +++
    UNARY-MINUS                 &quot;-&quot; EXPRESSION
    CONDITIONAL-OPERATOR            EXPRESSION ? EXPRESSION : EXPRESSION +++

STATEMENT:
    BODY                            &quot;{&quot; STATEMENT* &quot;}&quot;

    RETURN                      &quot;return&quot; EXPRESSION
    DEFINE-STRUCT                   &quot;struct&quot; IDENTIFIER &quot;{&quot; TYPE-NAME-SEMICOLON-LIST &quot;}&quot;
    DEFINE-FUNCTION             &quot;func&quot; TYPE IDENTIFIER &quot;(&quot; TYPE-NAME-COMMA-LIST &quot;)&quot; BODY
    DEFINE-IMPURE-FUNCTION          &quot;func&quot; TYPE IDENTIFIER &quot;(&quot; TYPE-NAME-COMMA-LIST &quot;)&quot; &quot;impure&quot; BODY
    IF                          &quot;if&quot; &quot;(&quot; EXPRESSION &quot;)&quot; BODY &quot;else&quot; BODY
    IF-ELSE                     &quot;if&quot; &quot;(&quot; EXPRESSION &quot;)&quot; BODY &quot;else&quot; &quot;if&quot;(EXPRESSION) BODY &quot;else&quot; BODY
    FOR                         &quot;for&quot; &quot;(&quot; IDENTIFIER &quot;in&quot; EXPRESSION &quot;...&quot; EXPRESSION &quot;)&quot; BODY
    FOR                         &quot;for&quot; &quot;(&quot; IDENTIFIER &quot;in&quot; EXPRESSION &quot;..&lt;&quot; EXPRESSION &quot;)&quot; BODY
    WHILE                       &quot;while&quot; &quot;(&quot; EXPRESSION &quot;)&quot; BODY

    BIND-IMMUTABLE-TYPED            &quot;let&quot; TYPE IDENTIFIER &quot;=&quot; EXPRESSION
    BIND-IMMUTABLE-INFERETYPE       &quot;let&quot; IDENTIFIER &quot;=&quot; EXPRESSION
    BIND-MUTABLE-TYPED              &quot;mutable&quot; TYPE IDENTIFIER &quot;=&quot; EXPRESSION
    BIND-MUTABLE-INFERCETYPE            &quot;mutable&quot; IDENTIFIER &quot;=&quot; EXPRESSION
    EXPRESSION-STATEMENT            EXPRESSION
    ASSIGNMENT                  IDENTIFIER &quot;=&quot; EXPRESSION
    SOFTWARE-SYSTEM-DEF             &quot;software-system-def&quot; JSON_BODY
    COMPONENT-DEF                   &quot;component-def&quot; JSON_BODY
</pre></div>


<p><a id="3-standard-library"></a></p>
<h1 id="3-standard-library">3 STANDARD LIBRARY<a class="headerlink" href="#3-standard-library" title="Permanent link"></a></h1>
<p>This is a small set of functions and types you can rely on always being available to your Floyd programs. There are features for working with benchmarks, sha1 hashes, time and the file system.
There is also a set of data types that gives code a common way to talk about dates, binary data and so forth.</p>
<p><a id="31-micro-benchmarking-features"></a></p>
<h2 id="31-micro-benchmarking-features">3.1 MICRO BENCHMARKING FEATURES<a class="headerlink" href="#31-micro-benchmarking-features" title="Permanent link"></a></h2>
<p><a id="benchmarkid_t-and-benchmark_result2t"></a></p>
<h3 id="benchmark95id95t-and-benchmark95result295t">benchmark_id_t and benchmark_result2_t<a class="headerlink" href="#benchmark95id95t-and-benchmark95result295t" title="Permanent link"></a></h3>
<p>Specifies a benchmark using the module it&rsquo;s defined in (currently always &ldquo;&rdquo;) and the name given to it using the benchmark-def statement.</p>
<div class="codehilite"><pre>struct benchmark_id_t {
    string module
    string test
}
</pre></div>

<p>Used to store benchmark results from many different benchmarks. It stores <em>which</em> benchmark and its result.</p>
<div class="codehilite"><pre>struct benchmark_result2_t {
    benchmark_id_t test_id
    benchmark_result_t result
}
</pre></div>

<p><a id="get_benchmarks"></a></p>
<h3 id="get95benchmarks">get_benchmarks()<a class="headerlink" href="#get95benchmarks" title="Permanent link"></a></h3>
<p>Get all benchmarks in the program, as defined using benchmark-def statements:</p>
<div class="codehilite"><pre>func [benchmark_id_t] get_benchmarks(){
</pre></div>

<p><a id="run_benchmarks"></a></p>
<h3 id="run95benchmarks">run_benchmarks()<a class="headerlink" href="#run95benchmarks" title="Permanent link"></a></h3>
<p>This is how you run one or many benchmarks:</p>
<div class="codehilite"><pre>func [benchmark_result2_t] run_benchmarks([benchmark_id_t] m) impure
</pre></div>

<p>It is an impure function since it gets different results each time it is run.</p>
<p><a id="makebenchmarkreport"></a></p>
<h3 id="make95benchmark95report">make_benchmark_report()<a class="headerlink" href="#make95benchmark95report" title="Permanent link"></a></h3>
<p>This function generates a nice output table from benchmark results:</p>
<div class="codehilite"><pre>func string make_benchmark_report([benchmark_result2_t] results)
</pre></div>

<div class="codehilite"><pre>print(make_benchmark_report(test_results))
</pre></div>

<p>Example print out:</p>
<div class="codehilite"><pre>|MODULE |TEST    |DUR        |       |
|-------|--------|-----------|-------|
|mod1   |my      |240 ns     |&quot;&quot;     |
|mod1   |my      |3000 ns    |&quot;&quot;     |
|mod1   |my      |100000 ns  |&quot;kb/s&quot; |
|mod1   |my      |1200000 ns |&quot;mb/s&quot; |
|mod1   |baggins |5000 ns    |&quot;mb/s&quot; |
|mod1   |baggins |7000 ns    |&quot;mb/s&quot; |
|mod1   |baggins |8000 ns    |&quot;mb/s&quot; |
|mod1   |baggins |80000 ns   |&quot;mb/s&quot; |
</pre></div>

<h4 id="more">more<a class="headerlink" href="#more" title="Permanent link"></a></h4>
<p>This is a way to record additional information about your benchmark. It can be more output values from computations, like the memory usage, the output result of the computations or it can be annotations and analysis data, like turning the dur and the amount of work into &ldquo;1100 pixels/s&rdquo; etc.</p>
<p>You can just pass a string with that information (will become a JSON string), like &ldquo;max detected&rdquo; or &ldquo;bandwidth = 120 MB/s&rdquo;</p>
<p>A more advanced technique is to pass a JSON dictionary because it lets you name properties and specify the properties using number or other JSON values - no need to make everything into strings.</p>
<div class="codehilite"><pre>benchmark_result_t(int dur, { &quot;note&quot;: &quot;max_detected&quot;, &quot;bandwidth MB/s&quot;: 120, &quot;pixels/s&quot;: 1100 })
</pre></div>

<p>They you can write your own code to make more advanced reports.</p>
<p>Floyd&rsquo;s command line supports a few useful features for using the more data:</p>
<table>
<thead>
<tr>
<th align="left">More value</th>
<th align="left">Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td align="left">null</td>
<td align="left">no additional printout</td>
</tr>
<tr>
<td align="left">string</td>
<td align="left">Show the string in the unnamed column</td>
</tr>
<tr>
<td align="left">dict</td>
<td align="left">Make a new column for each dict key. These are shared for all dicts with those keys, effectively letting you make your own columns</td>
</tr>
<tr>
<td align="left">any</td>
<td align="left">Show more value in the unnamed column, printed as compacted JSON string. A short array becomes &ldquo;[ 10, 20, 30]&rdquo; and so forth.</td>
</tr>
</tbody>
</table>
<p>Example:</p>
<div class="codehilite"><pre>&quot;pack_png()&quot;: benchmark_result_t { 1800, { &quot;kb/s&quot;: 670000, &quot;out size&quot;: 14014 } }
&quot;pack_png()&quot;: benchmark_result_t { 2023, &quot;alpha&quot; },
&quot;pack_png()&quot;: benchmark_result_t { 2980, json() } },
&quot;zip()&quot;: benchmark_result_t { 4030, { &quot;kb/s&quot;: 503000 , &quot;out size&quot;: 12030 } },
&quot;zip()&quot;: benchmark_result_t { 5113, &quot;alpha&quot; },
&quot;pack_jpeg()&quot;: benchmark_result_t { 2029, [ &quot;1024&quot;, &quot;1024&quot; ] }
</pre></div>

<p>Is printed like this:
<div class="codehilite"><pre>| MODULE  | TEST         |     DUR|                   | KB/S    | OUT SIZE  |
|---------|--------------|--------|-------------------|---------|-----------|
|         | pack_png()   | 1800 ns|                   | 670000  | 14014     |
|         | pack_png()   | 2023 ns| alpha             |         |           |
|         | pack_png()   | 2980 ns|                   |         |           |
|         | zip()        | 4030 ns|                   | 503000  | 12030     |
|         | zip()        | 5113 ns| alpha             |         |           |
|         | pack_jpeg()  | 2029 ns| [&quot;1024&quot;, &quot;1024&quot;]  |         |           |
</pre></div></p>
<p>Notice:</p>
<ul>
<li>We get a blank column where all misc printouts are shown</li>
<li>Two tests return a dictionary with a &ldquo;kb/s&rdquo; key &ndash; they create a new column and both benchmarks show there data in that column. Same for &ldquo;out size&rdquo;.</li>
<li>The pack_jpeg-line shows a compact JSON: an array with two strings.</li>
</ul>
<p><a id="32-hardware-caps"></a></p>
<h2 id="32-hardware-caps">3.2 HARDWARE CAPS<a class="headerlink" href="#32-hardware-caps" title="Permanent link"></a></h2>
<p>These built-in features lets you see what kind of CPU and memory system your program is currently running on. This is often useful when testing, optimising and debugging - both for your own computer and for a tester or user&rsquo;s computer.</p>
<p><a id="detecthardwarecaps"></a></p>
<h3 id="detect95hardware95caps">detect_hardware_caps()<a class="headerlink" href="#detect95hardware95caps" title="Permanent link"></a></h3>
<p><div class="codehilite"><pre>func [string: json] detect_hardware_caps()
</pre></div>
Output is something similar to this:</p>
<div class="codehilite"><pre>{
    &quot;availcpu&quot; : 0,
    &quot;bus_freq_hz&quot; : 100000000,
    &quot;byteorder&quot; : 1234,
    &quot;cacheline_size&quot; : 64,
    &quot;cpu_freq_hz&quot; : 4000000000,
    &quot;cpu_type&quot; : 7,
    &quot;cpu_type_subtype&quot; : 8,
    &quot;epoch&quot; : 0,
    &quot;floatingpoint&quot; : 0,
    &quot;l1_data_cache_size&quot; : 32768,
    &quot;l1_instruction_cache_size&quot; : 32768,
    &quot;l2_cache_size&quot; : 262144,
    &quot;l3_cache_size&quot; : 8388610,
    &quot;logical_processor_count&quot; : 8,
    &quot;machdep_cpu_brand_string&quot; : &quot;Intel(R) Core(TM) i7-4790K CPU @ 4.00GHz&quot;,
    &quot;machine&quot; : &quot;x86_64&quot;,
    &quot;machinearch&quot; : &quot;&quot;,
    &quot;mem_size&quot; : 17179900000,
    &quot;model&quot; : &quot;iMac15,1&quot;,
    &quot;ncpu&quot; : 8,
    &quot;packaged&quot; : 1,
    &quot;page_size&quot; : 4096,
    &quot;physical_processor_count&quot; : 4,
    &quot;physmem&quot; : 2147480000,
    &quot;scalar_align&quot; : 16,
    &quot;tbfrequency&quot; : 1000000000,
    &quot;usermem&quot; : 4214070000,
    &quot;vectorunit&quot; : 1
}
</pre></div>

<p><a id="makehardware_capsreport"></a></p>
<h3 id="make95hardware95caps95report">make_hardware_caps_report()<a class="headerlink" href="#make95hardware95caps95report" title="Permanent link"></a></h3>
<p>Generates a multi-line table (as a string) suitable to be printed to the terminal.</p>
<div class="codehilite"><pre>func string make_hardware_caps_report([string: json] caps)
</pre></div>

<p>The output will be something like this:</p>
<div class="codehilite"><pre>Intel(R) Core(TM) i7-4790K CPU @ 4.00GHz  16 GB DRAM  8 cores

PROCESSOR                                                     
--------------------------------------------------------------
Model          iMac15,1            ncpu                 8     
Machine        x86_64              Phys Processor Count 4     
CPU Freq       4 GHz                                          
CPU Type       7                   Vector unit          yes   
CPU Sub type   8                   Floatingpoint        no    

MEMORY                                                        
--------------------------------------------------------------
Bus freq       100 MHz             Page size            4 kB  
User mem       85860 kB            Scalar align         16 B  
Physical mem   2 GB                Byte order           1234  
Cacheline size 64 B                                           
L1 data        32 kB               L1 instructions      32 kB 
L2             256 kB              L3                   8 MB  
</pre></div>

<p><a id="makehardware_caps_reportbrief"></a></p>
<h3 id="make95hardware95caps95report95brief">make_hardware_caps_report_brief()<a class="headerlink" href="#make95hardware95caps95report95brief" title="Permanent link"></a></h3>
<p>Generates a short string summing up the the hardware your program is running on:</p>
<div class="codehilite"><pre>func string make_hardware_caps_report_brief([string: json] caps)
</pre></div>

<p>Example output:</p>
<div class="codehilite"><pre>&quot;Intel(R) Core(TM) i7-4790K CPU @ 4.00GHz  16 GB DRAM  8 cores&quot;
</pre></div>

<p><a id="getcurrent_date_and_timestring"></a></p>
<h3 id="get95current95date95and95time95string">get_current_date_and_time_string()<a class="headerlink" href="#get95current95date95and95time95string" title="Permanent link"></a></h3>
<p>Returns a string telling the current date and time. It is used to stamp a printout with when it was done.</p>
<div class="codehilite"><pre>func string get_current_date_and_time_string() impure
</pre></div>

<p>Example output:</p>
<div class="codehilite"><pre>Sat Aug 17 04:20:30 2019
</pre></div>

<p><a id="33-working-with-hashes---sha1"></a></p>
<h2 id="33-working-with-hashes-sha1">3.3 WORKING WITH HASHES - SHA1<a class="headerlink" href="#33-working-with-hashes-sha1" title="Permanent link"></a></h2>
<p><a id="quickhasht"></a></p>
<h3 id="quick95hash95t">quick_hash_t<a class="headerlink" href="#quick95hash95t" title="Permanent link"></a></h3>
<p>64-bit hash value used to speed up lookups and comparisons.</p>
<div class="codehilite"><pre>struct quick_hash_t {
    int hash
}
</pre></div>

<p><a id="sha1_t"></a></p>
<h3 id="sha1_t">sha1_t<a class="headerlink" href="#sha1_t" title="Permanent link"></a></h3>
<p>128-bit SHA1 hash number.</p>
<div class="codehilite"><pre>struct sha1_t {
    string ascii40
}
</pre></div>

<p><a id="calcstringsha1"></a></p>
<h3 id="calc95string95sha1">calc_string_sha1()<a class="headerlink" href="#calc95string95sha1" title="Permanent link"></a></h3>
<p>Calculates a SHA1 hash for the contents in a string.</p>
<div class="codehilite"><pre>sha1_t calc_string_sha1(string s)
</pre></div>

<p><a id="calcbinarysha1"></a></p>
<h3 id="calc95binary95sha1">calc_binary_sha1()<a class="headerlink" href="#calc95binary95sha1" title="Permanent link"></a></h3>
<p>Calculates a SHA1 hash for a block binary data.</p>
<div class="codehilite"><pre>sha1_t calc_binary_sha1(binary_t d)
</pre></div>

<p><a id="34-date-and-time"></a></p>
<h2 id="34-date-and-time">3.4 DATE AND TIME<a class="headerlink" href="#34-date-and-time" title="Permanent link"></a></h2>
<p><a id="timemst"></a></p>
<h3 id="time95ms95t">time_ms_t<a class="headerlink" href="#time95ms95t" title="Permanent link"></a></h3>
<p>64-bit integer counting miliseconds.</p>
<div class="codehilite"><pre>typedef int64_t time_ms_t
</pre></div>


<p><a id="date_t"></a></p>
<h3 id="date_t">date_t<a class="headerlink" href="#date_t" title="Permanent link"></a></h3>
<p>Stores a UDT.</p>
<div class="codehilite"><pre>struct date_t {
    string utc_date
}
</pre></div>


<p><a id="gettime_ofday"></a></p>
<h3 id="get95time95of95day">get_time_of_day()<a class="headerlink" href="#get95time95of95day" title="Permanent link"></a></h3>
<p>Returns the computer&rsquo;s realtime clock, expressed in the number of milliseconds since system start. Useful to measure program execution. Sample get_time_of_day() before and after execution and compare them to see duration.</p>
<div class="codehilite"><pre>int get_time_of_day() impure
</pre></div>


<p><a id="35-file-system-features"></a></p>
<h2 id="35-file-system-features">3.5 FILE SYSTEM FEATURES<a class="headerlink" href="#35-file-system-features" title="Permanent link"></a></h2>
<p>These functions allow you to access the OS file system. They are all impure.</p>
<p>Floyd uses unix-style paths in all its APIs. It will convert these to native paths with accessing the OS.</p>
<p>fsentry = File System Entry. This is a node in the file system&rsquo;s graph of files and directories. It can either be a file or a directory.</p>
<p><a id="readtextfile"></a></p>
<h3 id="read95text95file">read_text_file()<a class="headerlink" href="#read95text95file" title="Permanent link"></a></h3>
<p>Reads a text file from the file system and returns it as a string.</p>
<div class="codehilite"><pre>string read_text_file(string abs_path) impure
</pre></div>


<p>Throws exception if file cannot be found or read.</p>
<p><a id="writetextfile"></a></p>
<h3 id="write95text95file">write_text_file()<a class="headerlink" href="#write95text95file" title="Permanent link"></a></h3>
<p>Write a string to the file system as a text file. Will create any missing directories in the absolute path.</p>
<div class="codehilite"><pre>void write_text_file(string abs_path, string data) impure
</pre></div>


<p><a id="readlinestdin"></a></p>
<h3 id="read95line95stdin">read_line_stdin()<a class="headerlink" href="#read95line95stdin" title="Permanent link"></a></h3>
<p>Read a line of text from the program&rsquo;s operating system standard input (stdin). The stdin is usually the computers keyboard. Input ends at a &lsquo;\n&rsquo; character (aka ASCII newline, 0x0A). The &lsquo;\n&rsquo; is not included in the returned string. The encoding and format of the returned string depends on the OS and what/if redirects to stdin. </p>
<div class="codehilite"><pre>string read_line_stdin() impure
</pre></div>


<p><a id="getfsentries_shallow-and-get_fsentriesdeep"></a></p>
<h3 id="get95fsentries_shallow-and-get95fsentries95deep">get_fsentries_shallow() and get_fsentries_deep()<a class="headerlink" href="#get95fsentries_shallow-and-get95fsentries95deep" title="Permanent link"></a></h3>
<p>Returns a vector of all the files and directories found at the absolute path.</p>
<div class="codehilite"><pre>struct fsentry_t {
    string type
    string name
    string abs_parent_path
}

[fsentry_t] get_fsentries_shallow(string abs_path) impure
</pre></div>


<ul>
<li>type: either &ldquo;file&rdquo; or &ldquo;dir&rdquo;.</li>
<li>name: name of the leaf directory or file.</li>
<li>abs_parent_path: the path to the entires parent.</li>
</ul>
<p>get_fsentries_deep() works the same way, but will also traverse each found directory. Contents of sub-directories will be also be prefixed by the sub-directory names. All path names are relative to the input directory - not absolute to file system.</p>
<div class="codehilite"><pre>[fsentry_t] get_fsentries_deep(string abs_path) impure
</pre></div>


<p><a id="getfsentryinfo"></a></p>
<h3 id="get95fsentry95info">get_fsentry_info()<a class="headerlink" href="#get95fsentry95info" title="Permanent link"></a></h3>
<p>Information about an entry in the file system. Can be a file or a directory.</p>
<div class="codehilite"><pre>struct fsentry_info_t {
    string type
    string name
    string abs_parent_path

    string creation_date
    string modification_date
    int file_size
}

fsentry_info_t get_fsentry_info(string abs_path) impure
</pre></div>


<ul>
<li>type: either &ldquo;file&rdquo; or &ldquo;dir&rdquo;.</li>
<li>name: name of the leaf directory or file.</li>
<li>abs_parent_path: the path to the entires parent.</li>
<li>creation_date: creation date of the entry.</li>
<li>modification_date: latest modification date of the entry.</li>
<li>file_size: size of the file or directory.</li>
</ul>
<p><a id="getfsenvironment"></a></p>
<h3 id="get95fs95environment">get_fs_environment()<a class="headerlink" href="#get95fs95environment" title="Permanent link"></a></h3>
<p>Returns important root locations in the host computer&rsquo;s file system.</p>
<p>Notice: some of these directories can change while your program runs.</p>
<div class="codehilite"><pre>    struct fs_environment_t {
        string home_dir
        string documents_dir
        string desktop_dir

        string hidden_persistence_dir
        string preferences_dir
        string cache_dir
        string temp_dir

        string executable_dir
    }
</pre></div>

<div class="codehilite"><pre>fs_environment_t get_fs_environment() impure
</pre></div>

<h5 id="home_dir">home_dir<a class="headerlink" href="#home_dir" title="Permanent link"></a></h5>
<p>User&rsquo;s home directory. You don&rsquo;t normally store anything in this directory, but in one of the sub directories.</p>
<p>Example: &ldquo;/Users/bob&rdquo;</p>
<ul>
<li>User sees these files.</li>
</ul>
<h5 id="documents_dir">documents_dir<a class="headerlink" href="#documents_dir" title="Permanent link"></a></h5>
<p>User&rsquo;s documents directory.</p>
<p>Example: &ldquo;/Users/bob/Documents&rdquo;</p>
<ul>
<li>User sees these files.</li>
</ul>
<h5 id="desktop_dir">desktop_dir<a class="headerlink" href="#desktop_dir" title="Permanent link"></a></h5>
<p>User&rsquo;s desktop directory.</p>
<p>Example: &ldquo;/Users/bob/Desktop&rdquo;</p>
<ul>
<li>User sees these files.</li>
</ul>
<h5 id="hidden95persistence95dir">hidden_persistence_dir<a class="headerlink" href="#hidden95persistence95dir" title="Permanent link"></a></h5>
<p>Current logged-in user&rsquo;s Application Support directory.
App creates data here and manages it on behalf of the user and can include files that contain user data.</p>
<p>Example: &ldquo;/Users/marcus/Library/Application Support&rdquo;</p>
<ul>
<li>Notice that this points to a directory shared by many applications: store your data in a sub directory!</li>
<li>User don&rsquo;t see these files.</li>
</ul>
<h5 id="preferences_dir">preferences_dir<a class="headerlink" href="#preferences_dir" title="Permanent link"></a></h5>
<p>Current logged-in user&rsquo;s preference directory.</p>
<p>Example: &ldquo;/Users/marcus/Library/Preferences&rdquo;</p>
<ul>
<li>Notice that this points to a directory shared by many applications: store your data in a sub directory!</li>
<li>User don&rsquo;t see these files.</li>
</ul>
<h5 id="cache_dir">cache_dir<a class="headerlink" href="#cache_dir" title="Permanent link"></a></h5>
<p>Current logged-in user&rsquo;s cache directory.</p>
<p>Example: &ldquo;/Users/marcus/Library/Caches&rdquo;</p>
<ul>
<li>Notice that this points to a directory shared by many applications: store your data in a sub directory!</li>
<li>User don&rsquo;t see these files.</li>
</ul>
<h5 id="temp_dir">temp_dir<a class="headerlink" href="#temp_dir" title="Permanent link"></a></h5>
<p>Temporary directory. Will be erased soon. Don&rsquo;t expect to find your files here next time your program starts or in 3 minutes.</p>
<ul>
<li>Notice that this points to a directory shared by many applications: store your data in a sub directory!</li>
<li>User don&rsquo;t see these files.</li>
</ul>
<h5 id="executable_dir">executable_dir<a class="headerlink" href="#executable_dir" title="Permanent link"></a></h5>
<p>Directory where your executable or bundle lives. This is usually read-only - you can&rsquo;t modify anything in this directory. You might use this path to read resources built into your executable or Mac bundle.</p>
<p>Example: &ldquo;/Users/bob/Applications/MyApp.app/&rdquo;</p>
<p><a id="doesfsentryexist"></a></p>
<h3 id="does95fsentry95exist">does_fsentry_exist()<a class="headerlink" href="#does95fsentry95exist" title="Permanent link"></a></h3>
<p>Checks if there is a file or directory at specified path.</p>
<div class="codehilite"><pre>bool does_fsentry_exist(string abs_path) impure
</pre></div>


<p><a id="createdirectorybranch"></a></p>
<h3 id="create95directory95branch">create_directory_branch()<a class="headerlink" href="#create95directory95branch" title="Permanent link"></a></h3>
<p>Creates a directory at specified path. If the parents directories don&rsquo;t exist, then those will be created too.</p>
<div class="codehilite"><pre>void create_directory_branch(string abs_path) impure
</pre></div>


<p><a id="deletefsentrydeep"></a></p>
<h3 id="delete95fsentry95deep">delete_fsentry_deep()<a class="headerlink" href="#delete95fsentry95deep" title="Permanent link"></a></h3>
<p>Deletes a file or directory. If the entry has children those are deleted too - delete folder also deletes is contents.</p>
<div class="codehilite"><pre>void delete_fsentry_deep(string abs_path) impure
</pre></div>


<p><a id="rename_fsentry"></a></p>
<h3 id="rename95fsentry">rename_fsentry()<a class="headerlink" href="#rename95fsentry" title="Permanent link"></a></h3>
<p>Renames a file or directory. If it is a directory, its contents is unchanged.
After this call completes, abs_path no longer references an entry.</p>
<div class="codehilite"><pre>void rename_fsentry(string abs_path, string n) impure
</pre></div>


<p>Example:</p>
<p>Before:
    In the file system: &ldquo;/Users/bob/Desktop/original_name.txt&rdquo;
    abs_path: &ldquo;/Users/bob/Desktop/original_name.txt&rdquo;
    n: &ldquo;name_name.txt&rdquo;</p>
<p>After:
    world: &ldquo;/Users/bob/Desktop/name_name.txt&rdquo;</p>
<p><a id="36-standard-types"></a></p>
<h2 id="36-standard-types">3.6 STANDARD TYPES<a class="headerlink" href="#36-standard-types" title="Permanent link"></a></h2>
<p>A bunch of common data types are built into Floyd. This is to make composition easier and avoid the noise of converting all simple types between different component&rsquo;s own versions.</p>
<p><a id="uuid_t"></a></p>
<h3 id="uuid_t">uuid_t<a class="headerlink" href="#uuid_t" title="Permanent link"></a></h3>
<p>A universally unique identifier (UUID) is a 128-bit number used to identify information in computer systems. The term globaly unique identifier (GUID) is also used.</p>
<div class="codehilite"><pre>struct uuid_t {
    int high64
    int low64
}
</pre></div>


<p><a id="ipaddresst"></a></p>
<h3 id="ip95address95t">ip_address_t<a class="headerlink" href="#ip95address95t" title="Permanent link"></a></h3>
<p>Internet IP adress in using IPv6 128-bit number.</p>
<div class="codehilite"><pre>struct ip_address_t {
    int high64
    int low_64_bits
}
</pre></div>


<p><a id="url_t"></a></p>
<h3 id="url_t">url_t<a class="headerlink" href="#url_t" title="Permanent link"></a></h3>
<p>Internet URL.</p>
<div class="codehilite"><pre>struct url_t {
    string absolute_url
}
</pre></div>


<p><a id="urlpartst-"></a></p>
<h3 id="url95parts95t">url_parts_t<a class="headerlink" href="#url95parts95t" title="Permanent link"></a></h3>
<p>This struct contains an URL separate to its components.</p>
<div class="codehilite"><pre>struct url_parts_t {
    string protocol
    string domain
    string path
    [string:string] query_strings
    int port
}
</pre></div>


<p>Example 1:</p>
<div class="codehilite"><pre>url_parts_t(&quot;http&quot;, &quot;example.com&quot;, &quot;path/to/page&quot;, {&quot;name&quot;: &quot;ferret&quot;, &quot;color&quot;: &quot;purple&quot;})

Output: &quot;http://example.com/path/to/page?name=ferret&amp;color=purple&quot;
</pre></div>


<p><a id="key_t"></a></p>
<h3 id="key_t">key_t<a class="headerlink" href="#key_t" title="Permanent link"></a></h3>
<p>Efficent keying using 64-bit hash instead of a string. Hash can often be computed from string key at compile time.</p>
<div class="codehilite"><pre>struct key_t {
    quick_hash_t hash
}
</pre></div>


<p><a id="binary_t"></a></p>
<h3 id="binary_t">binary_t<a class="headerlink" href="#binary_t" title="Permanent link"></a></h3>
<p>Raw binary data, 8bit per byte.</p>
<div class="codehilite"><pre>struct binary_t {
    string bytes
}
</pre></div>


<p><a id="seq_t"></a></p>
<h3 id="seq_t">seq_t<a class="headerlink" href="#seq_t" title="Permanent link"></a></h3>
<p>This is the neatest way to parse strings without using an iterator or indexes.</p>
<div class="codehilite"><pre>struct seq_t {
    string str
    int pos
}
</pre></div>


<p>When you consume data at start of seq_t you get a <em>new</em> seq_t that holds
the rest of the string. No side effects.</p>
<p>This is a magic string were you can easily peek into the beginning and also get a new string
without the first character(s).</p>
<p>It shares the actual string data behind the curtains so is efficent.</p>
<p><a id="text_t"></a></p>
<h3 id="text_t">text_t<a class="headerlink" href="#text_t" title="Permanent link"></a></h3>
<p>Unicode text. Opaque data &ndash; only use library functions to process text_t. Think of text_t and Uncode text more like a PDF.</p>
<div class="codehilite"><pre>struct text_t {
    binary_t data
}
</pre></div>


<p><a id="textresourceid"></a></p>
<h3 id="text95resource95id">text_resource_id<a class="headerlink" href="#text95resource95id" title="Permanent link"></a></h3>
<p>How you specify text resources.</p>
<div class="codehilite"><pre>struct text_resource_id {
    quick_hash_t id
}
</pre></div>


<p><a id="imageidt"></a></p>
<h3 id="image95id95t">image_id_t<a class="headerlink" href="#image95id95t" title="Permanent link"></a></h3>
<p>How you specify image resources.</p>
<div class="codehilite"><pre>struct image_id_t {
    int id
}
</pre></div>


<p><a id="color_t"></a></p>
<h3 id="color_t">color_t<a class="headerlink" href="#color_t" title="Permanent link"></a></h3>
<p>Color. If you don&rsquo;t need alpha, set it to 1.0. Components are normally min 0.0 &ndash; max 1.0 but you can use other ranges.</p>
<div class="codehilite"><pre>struct color_t {
    float red
    float green
    float blue
    float alpha
}
</pre></div>


<p><a id="vector2_t"></a></p>
<h3 id="vector2_t">vector2_t<a class="headerlink" href="#vector2_t" title="Permanent link"></a></h3>
<p>2D position in cartesian coordinate system. Use to specify position on the screen and similar.</p>
<div class="codehilite"><pre>struct vector2_t {
    float x
    float y
}
</pre></div></article></body></html>